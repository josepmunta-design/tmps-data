<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modelos ¬∑ Biblioteca (Escuelas ‚Üí Modelos)</title>

  <!-- Montserrat (como el doc) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">

 <script defer src="https://d3js.org/d3.v7.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>

  
  <style>
    
:root{
  --bg:#0b0f14;
  --panelA: rgba(19,26,34,0.82);
  --panelB: rgba(19,26,34,0.62);
  --text:#e7edf5;
  --muted:#c7d2e1;
  --muted2:#9fb0c3;
  --accent:#D9AA3F;

  --edgePad: 14px;
  --leftPanelW: 380px;

  /* ‚úÖ nuevo: ‚Äúrespiraci√≥n‚Äù entre panel izquierdo y el derecho */
  --midGap: 14px;
    /* ===== Mapamundi tokens (solo variables, no afectan layout) ===== */
  --land: rgba(231,237,245,0.14);
  --landStroke: rgba(231,237,245,0.18);
  --graticule: rgba(231,237,245,0.10);
  --dotStroke: rgba(255,255,255,0.85);
  --dotGlow: rgba(255,255,255,0.45);
}

    *{ box-sizing:border-box; }
    html,body{
      height:100%;
      margin:0;
     background:
    radial-gradient(1400px 900px at 15% 15%, rgba(217,170,63,.12), transparent 55%),
    radial-gradient(1200px 800px at 85% 35%, rgba(78,121,167,.14), transparent 60%),
    radial-gradient(900px 600px at 50% 80%, rgba(255,255,255,.04), transparent 65%),
    linear-gradient(180deg, #0b0f14 0%, #0a0e13 100%);
      color: var(--text);
        overflow-x: hidden;
  overflow-y: auto;

      font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }

    /* ===== Layout: lienzo full-screen + paneles flotantes (glass) ===== */
    .app{
      position:relative;
      width:100vw;
      height:100vh;
    }

.panel{
  position: relative;           /* ‚úÖ para que .panel::before se ancle al panel */
  overflow: hidden;             /* ‚úÖ recorta el glow dentro del borde redondeado */
  --panelGlow: rgba(255,255,255,0.06); /* ‚úÖ valor por defecto si no hay modelo */

  background: linear-gradient(180deg, var(--panelA), var(--panelB));
  border:1px solid rgba(255,255,255,0.10);
  border-radius:16px;
  box-shadow:
    0 18px 50px rgba(0,0,0,0.45),
    inset 0 1px 0 rgba(255,255,255,0.06);
  backdrop-filter: blur(12px) saturate(115%);
  -webkit-backdrop-filter: blur(12px) saturate(115%);
}



.panel.left{
  position:fixed;
  top: var(--edgePad);
  left: var(--edgePad);
  width: var(--leftPanelW);
  max-width: calc(100vw - (var(--edgePad) * 2));
  max-height: calc(100vh - (var(--edgePad) * 2));
  overflow:auto;

  padding: 0 14px 14px 14px;   /* ‚úÖ arriba a 0 */
  z-index: 20;
}


.panel.right{
  position: fixed;
  top: var(--edgePad);
  left: calc(var(--edgePad) + var(--leftPanelW) + var(--midGap));
  right: var(--edgePad);

  /* ‚úÖ ocupa todo el alto ‚Äúusable‚Äù */
  max-height: calc(100vh - (var(--edgePad) * 2));
  overflow: auto;

  padding: 0;
  z-index: 20;

  background: linear-gradient(180deg, var(--panelA), var(--panelB));
  border:1px solid rgba(255,255,255,0.10);
  border-radius:16px;
  box-shadow: 0 18px 50px rgba(0,0,0,0.45);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.panel::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  pointer-events:none;

  /* ‚úÖ glow con color variable + un segundo glow suave */
  background:
    radial-gradient(520px 320px at 88% 12%, var(--panelGlow), transparent 62%),
    radial-gradient(700px 420px at 18% 85%, rgba(255,255,255,0.05), transparent 65%);
  opacity:.95;
  mix-blend-mode: screen;   /* hace que ‚Äúrespire‚Äù sin aclarar demasiado */
animation: panelBreath 5s ease-in-out infinite;

    }






    /* ===== T√≠tulos / cards (doc) ===== */
  .title{
  font-weight: 900;
  letter-spacing: -0.4px;
  font-size: 20px;
  line-height: 1.15;
  margin: 2px 0 10px 0;
  color: #ffffff;
}
.t-eyebrow{
  display: block;
  font-size: 11px;
  font-weight: 800;
  letter-spacing: .8px;
  text-transform: uppercase;
  color: rgba(231,237,245,.65);
  margin-bottom: 2px;
}

.t-main{
  display: block;
  font-size: 22px;
  font-weight: 900;
  letter-spacing: -0.5px;
  color: #ffffff;
}
    
.t-main::before{
  content:"¬∑";
  color: rgba(217,170,63,.85);
  margin-right:6px;
}

    .subtitle{
      color:var(--muted);
      opacity:.85;
      font-size:12.5px;
      line-height:1.35;
      margin-bottom:12px;
    }
    /* ===== L√≠nea de recuento de modelos ===== */
#countLine{
  display:flex;
  gap:6px;
  align-items:baseline;
  flex-wrap:wrap;
}

#countLine .count-n{
  font-weight:900;
  font-size:14px;
  color:#fff;
}

#countLine .count-txt{
  font-weight:600;
  opacity:.75;
}

#countLine .count-school{
  font-weight:800;
  color: var(--schoolColor, #dfe6f1);
}

    .card{
      background: rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:14px;
      padding:12px;
      margin:12px 0;
    }
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    label{font-size:12px;color:var(--muted2);}

    select{
      width: 100%;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 10px;
      font-weight: 700;
      outline: none;
    }
    select:focus{ border-color: rgba(217,170,63,.35); box-shadow: 0 0 0 4px rgba(217,170,63,.10); }

    .modelsList{
      margin-top: 8px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    /* Lista clicable (doc) */
  .mi-item{
  cursor: pointer;
  min-height: 78px; 
  border-radius: 12px;
  padding: 10px 10px;
  border: 1px solid rgba(255,255,255,0.10);

  /* üëá fondo tintado muy sutil por escuela */
  background:
    linear-gradient(
      180deg,
      color-mix(in srgb, var(--schoolColor) 8%, transparent),
      rgba(255,255,255,0.04)
    );

  transition:
    background .15s ease,
    border-color .12s ease,
    transform .12s ease;
  user-select:none;
    position: relative;

}

    .mi-item:hover{
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.16);
      transform: translateY(-1px);
    }
   .mi-item.active{
  border-color: var(--schoolColor, rgba(217,170,63,.45));
  background: linear-gradient(
    180deg,
    rgba(255,255,255,0.06),
    rgba(255,255,255,0.02)
  );
  box-shadow:
    0 0 0 3px color-mix(in srgb, var(--schoolColor) 28%, transparent),
    inset 0 1px 0 rgba(255,255,255,0.10);
}
/* ===== MARCOS: aspecto claramente distinto ===== */
.mi-item.is-marco{

  position: relative;
  border-style: solid;
  border-width: 1px;

  background:
    linear-gradient(
      180deg,
      rgba(255,255,255,0.045),
      rgba(255,255,255,0.02)
    );

  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.10);
}


/* banda vertical izquierda */
/* sin banda lateral en marcos */
.mi-item.is-marco::before{
  display: none;
}

/* ===== MODELOS: banda vertical izquierda (destacar modelos) ===== */
.mi-item:not(.is-marco)::before{
  content:'';
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  width:6px;
  border-radius: 14px 0 0 14px;
background: color-mix(in srgb, var(--schoolColor) 78%, transparent);
opacity: .75;

  pointer-events:none;
}

/* activo: doble ‚Äúborde‚Äù + glow m√°s marcado */
.mi-item.is-marco.active{
  border-color: color-mix(in srgb, var(--schoolColor) 55%, rgba(255,255,255,0.18));
  box-shadow:
    0 0 0 2px rgba(0,0,0,0.35),
    0 0 0 4px color-mix(in srgb, var(--schoolColor) 35%, transparent),
    inset 0 1px 0 rgba(255,255,255,0.12);
}

/* Etiqueta MARCO minimalista: solo texto */
.mi-marcoTag{

  position: absolute;

  right: 12px;
  bottom: 8px;

  padding: 0;              /* sin caja */
  border: none;           /* sin borde */
  background: none;       /* sin fondo */
  box-shadow: none;       /* sin sombra */
  backdrop-filter: none;

  font-size: 10px;
  font-weight: 700;
  letter-spacing: .6px;
  text-transform: uppercase;

  color: rgba(231,237,245,0.65);  /* discreto */

  pointer-events: none;
}



    .mi-top{display:flex; justify-content:space-between; gap:10px; align-items:flex-start;}
    .mi-title{font-weight:900; font-size:13px; color:#fff; line-height:1.2;}
    /* ===== T√çTULO EN MARCOS ===== */

.mi-item.is-marco .mi-title{
  font-weight: 600;     /* antes: 900 */
  letter-spacing: 0.03em;
  opacity: 0.95;
}

    .mi-year{font-weight:900; font-size:12px; color: rgba(231,237,245,.85);}
    .mi-sub{opacity:.9; font-size:12px; color:#c6d2e2; margin-top:4px; line-height:1.25;}
    .pill{
      display:inline-block;
      margin-top:6px;
      padding:2px 8px;
      border-radius:999px;
      font-size:11px;
      background: rgba(255,255,255,0.07);
      border:1px solid rgba(255,255,255,0.10);
      color:#dfe6f1;
    }

    /* ===== Panel derecho: modelPanel (doc) ===== */
    .model-panel{ padding:0; overflow:hidden; }
    .modelPanel{
      padding: 18px 16px;
      color: #e7edf5;
      font-size: 13px;
      line-height: 1.45;
    }

    .modelPanel .mp-tag{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      font-size:11px;
      font-weight:800;
      letter-spacing:.3px;
      margin-bottom:10px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
    }
.modelPanel .mp-title{
  font-size:28px;              /* ‚¨ÖÔ∏è m√°s presencia */
  font-weight:800;            /* ‚¨ÖÔ∏è menos ‚Äúbloque‚Äù, m√°s elegante */
  line-height:1.05;
  margin:6px 0 12px;
  color:#fff;

  letter-spacing:-0.02em;     /* ‚¨ÖÔ∏è look premium */
  text-shadow:
    0 1px 0 rgba(0,0,0,0.35),
    0 10px 28px rgba(0,0,0,0.35);
}

    /* ===== DIFERENCIAR VISTA ESCUELA ===== */
.modelPanel.school-view{
 
  padding-top: 16px;
}

.modelPanel.school-view .mp-title{
  display:none; /* en escuela no usamos el mp-title */
}

.school-header{
  margin: 4px 0 14px 0;
}

.school-eyebrow{
  font-size: 11px;
  font-weight: 900;
  letter-spacing: .8px;
  text-transform: uppercase;
  opacity: .65;
}

.school-title{
  font-size: 30px;
  font-weight: 950;
  line-height: 1.05;
  letter-spacing: -0.6px;
  color: var(--schoolColor, #fff);
}

    .modelPanel .mp-author{
      font-size:13px;
      font-weight:700;
      color:#cfd9e6;
      margin-bottom:10px;
    }
    .modelPanel .mp-meta{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:14px;
    }
    .modelPanel .mp-pill{
      padding:4px 10px;
      border-radius:999px;
      font-size:11px;
      font-weight:700;
      background: rgba(255,255,255,0.07);
      border: 1px solid rgba(255,255,255,0.12);
      color:#dfe6f1;
    }
    .modelPanel .mp-desc{
      margin-top:6px;
      font-size:13px;
      line-height:1.55;
      color:#e3ebf6;
      white-space: pre-wrap;
    }
    /* En vista de ESCUELA: no respetes saltos del template literal */
.modelPanel.school-view .mp-desc{
  white-space: normal;
}

    .modelPanel .mp-section{
      margin-top:16px;
      padding-top:12px;
      border-top:1px solid rgba(255,255,255,0.10);
    }
.modelPanel .mp-section h4{
  font-weight: 700;
  letter-spacing: .2px;
  opacity: .95;
}

    .mp-list{ margin:0; padding-left:18px; }
    .mp-list li{ margin: 6px 0; }
    .mp-code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 11px;
      opacity: .9;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      display:inline-block;
      margin-left:6px;
        display: none !important;
    }

    /* Estado inicial (doc) */
    .modelPanel .mp-hint{
      position:relative;
      margin:10px 0 0 0;
      padding:12px 14px 12px 40px;
      font-size:13px;
      line-height:1.35;
      font-weight:700;
      color: rgba(231,237,245,.86);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      border-radius:14px;
      box-shadow: 0 10px 26px rgba(0,0,0,.28);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      animation: hintIn .35s ease both;
    }
    .modelPanel .mp-hint::before{
      content:"‚åñ";
      position:absolute;
      left:12px;
      top:50%;
      transform:translateY(-50%);
      width:22px;
      height:22px;
      display:grid;
      place-items:center;
      font-size:14px;
      font-weight:900;
      color: var(--accent);
      background: rgba(217,170,63,.10);
      border: 1px solid rgba(217,170,63,.22);
      border-radius:10px;
      box-shadow: 0 0 0 4px rgba(217,170,63,.06);
    }
    @keyframes hintIn{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }
/* ===== Hero de entrada (panel derecho) ===== */
.modelPanel .mp-hero{
  position: relative;
  margin: 4px 0 12px 0;
  padding: 16px 16px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.10);
  background:
    radial-gradient(900px 420px at 15% 10%, rgba(255,255,255,0.10), transparent 60%),
    radial-gradient(700px 340px at 70% 30%, var(--panelGlow, rgba(217,170,63,0.10)), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.10));
  box-shadow: 0 18px 70px rgba(0,0,0,.45);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  overflow: hidden;
  animation: heroIn .45s ease both;
}

.modelPanel .mp-hero::after{
  content:"";
  position:absolute;
  inset:-40px;
  pointer-events:none;
  opacity:.35;
  background:
    radial-gradient(circle at 12px 12px, rgba(255,255,255,0.10) 1px, transparent 1.6px);
  background-size: 24px 24px;
  transform: rotate(6deg);
}

.modelPanel .mp-hero-eyebrow{
  display:block;

  padding: 0;
  border-radius: 0;
  background: none;
  border: none;

  font-size: 10.5px;
  font-weight: 700;
  letter-spacing: .6px;
  text-transform: uppercase;

  color: rgba(231,237,245,0.58);
  margin-bottom: 8px;
}

.modelPanel .mp-hero-title{
  font-size: 20px;
  font-weight: 650;
  letter-spacing: -0.15px;
  line-height: 1.25;

  color: rgba(231,237,245,0.92);
  text-shadow: none;
}



.modelPanel .mp-hero-text{
  font-size: 13.5px;
  line-height: 1.5;
  color: rgba(227,235,246,0.92);
  margin: 0 0 12px 0;
  max-width: 56ch;
}

.modelPanel .mp-hero-steps{
  display:flex;
  flex-direction: column;
  gap: 8px;
  padding-top: 10px;
  border-top: 1px solid rgba(255,255,255,0.10);
}

.modelPanel .mp-step{
  display:flex;
  align-items:center;
  gap: 10px;
  font-size: 12.5px;
  font-weight: 800;
  color: rgba(231,237,245,0.90);
}

.modelPanel .mp-step-dot{
  width: 10px;
  height: 10px;
  border-radius: 999px;
  background: rgba(217,170,63,0.22);
  border: 1px solid rgba(217,170,63,0.35);
  box-shadow: 0 0 0 6px rgba(217,170,63,0.06);
  flex: 0 0 auto;
}

@keyframes heroIn{
  from{ opacity:0; transform: translateY(8px); }
  to{ opacity:1; transform: translateY(0); }
}
@keyframes panelBreath{
  0%,100%{
    background-position: 0% 0%;
    opacity: .85;
  }
  50%{
    background-position: 100% 100%;
    opacity: 1;
  }
}

    /* Scrollbar glass (doc) */
    .panel.left, .panel.right{
      scrollbar-width: thin;
      scrollbar-color: rgba(231,237,245,0.28) rgba(255,255,255,0.06);
    }
    .panel.left::-webkit-scrollbar, .panel.right::-webkit-scrollbar{ width:10px; }
    .panel.left::-webkit-scrollbar-track, .panel.right::-webkit-scrollbar-track{
      background: rgba(255,255,255,0.05);
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.06);
    }
    .panel.left::-webkit-scrollbar-thumb, .panel.right::-webkit-scrollbar-thumb{
      background: linear-gradient(180deg, rgba(231,237,245,0.28), rgba(231,237,245,0.14));
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.10);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.10);
    }
    .panel.left::-webkit-scrollbar-thumb:hover, .panel.right::-webkit-scrollbar-thumb:hover{
      background: linear-gradient(180deg, rgba(231,237,245,0.36), rgba(231,237,245,0.18));
    }
    /* ===== Acordeones (desplegables) ===== */
.mp-acc{
  margin-top:12px;
  border-top:1px solid rgba(255,255,255,0.10);
  padding-top:12px;
}

.mp-acc details{
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  border-radius: 14px;
  margin: 10px 0;
  overflow:hidden;
}

.mp-acc summary{
  list-style: none;
  cursor: pointer;
  padding: 12px 14px;
  font-weight: 700;
  font-size: 12px;
  color: #fff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  user-select:none;
}

.mp-acc summary::-webkit-details-marker{ display:none; }

.mp-acc .sumRight{
  display:flex;
  align-items:center;
  gap:10px;
}

.mp-acc .sumCount{
  font-size: 11px;
  font-weight: 800;
  color: rgba(231,237,245,.80);
  padding: 3px 8px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(0,0,0,0.16);
}

.mp-acc .chev{
  width: 22px; height: 22px;
  display:grid; place-items:center;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  color: rgba(231,237,245,.85);
  transition: transform .15s ease;
}

.mp-acc details[open] > summary .chev{ transform: rotate(180deg); }

.mp-acc .body{
  padding: 0 14px 12px 14px;
  color:#e3ebf6;
  white-space: normal;   /* ‚úÖ evita huecos por indentaci√≥n */
  line-height: 1.55;
}


.mp-acc .body .mp-list{ margin-top: 8px; }

.mp-acc .body .mp-section{ /* neutraliza el estilo anterior si lo usabas */
  margin-top: 0;
  padding-top: 0;
  border-top: none;
}
/* ===== Sub-acordeones (procedimientos/micros) ===== */
.mp-sub details{
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(0,0,0,0.12);
  border-radius: 12px;
  margin: 8px 0;
  overflow: hidden;
}

.mp-sub summary{
  list-style:none;
  cursor:pointer;
  padding: 10px 12px;
  font-weight: 800;
  font-size: 12px;
  color: rgba(255,255,255,0.95);
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
  user-select:none;
}

.mp-sub summary::-webkit-details-marker{ display:none; }

.mp-sub .subLeft{
  display:flex;
  gap:8px;
  align-items:flex-start;
  min-width:0;
}

.mp-sub .subTitle{
  font-weight: 600;
  line-height: 1.2;
}

.mp-sub .subRight{
  display:flex;
  gap:8px;
  align-items:center;
  flex-shrink:0;
}

.mp-sub .subBody{
  padding: 0 12px 10px 12px;
  color: rgba(227,235,246,0.92);
  white-space: pre-wrap;
  line-height: 1.55;
  font-size: 13px;
}

.mp-sub details[open] .chev{ transform: rotate(180deg); }
/* =========================
   Oculta el header/menu de Teachable
   ========================= */

header,
.site-header,
.header,
.navbar,
#header{
  display: none !important;
}

/* Por si Teachable mete padding-top por header fijo */
body{
  padding-top: 0 !important;
}
/* ===== Selector de escuelas (glass premium) ===== */
select{
  width: 100%;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  background:
    linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)),
    radial-gradient(120px 60px at 90% 50%, rgba(217,170,63,.18), transparent 60%);
  
  border: 1px solid rgba(255,255,255,0.14);
  color: #ffffff;

  border-radius: 14px;
  padding: 12px 42px 12px 14px;

  font-family: inherit;
  font-size: 13px;
  font-weight: 800;
  letter-spacing: .2px;

  outline: none;
  cursor: pointer;

  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.10),
    0 10px 26px rgba(0,0,0,0.35);

  transition:
    border-color .15s ease,
    box-shadow .15s ease,
    background .15s ease;
}

/* Hover */
select:hover{
  border-color: rgba(255,255,255,0.22);
}

/* Focus */
select:focus{
  border-color: rgba(217,170,63,.55);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.12),
    0 0 0 4px rgba(217,170,63,.15),
    0 12px 30px rgba(0,0,0,.45);
}

/* Flecha custom */
select{
  background-image:
    linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04)),
    radial-gradient(120px 60px at 90% 50%, rgba(217,170,63,.18), transparent 60%),
    url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none'>\
<path d='M7 10l5 5 5-5' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>\
</svg>");
  background-repeat: no-repeat;
  background-position:
    0 0,
    0 0,
    right 14px center;
  background-size:
    cover,
    cover,
    16px;
}
label{
  font-size: 11px;
  font-weight: 800;
  letter-spacing: .4px;
  text-transform: uppercase;
  color: rgba(231,237,245,.75);
}
/* Intento m√°ximo de estilado del desplegable nativo */
select option{
  background-color: #11161d;
  color: #e7edf5;
  font-weight: 700;
}

select option:checked{
  background-color: #1e2632;
  color: #ffffff;
}
   /* =========================
   Fondo activo ‚Äúsem√°ntico‚Äù (diagrama de nodos)
   ========================= */
body::before{
  animation: none;
}


@keyframes bgDrift{
  from{ background-position: 0 0; }
  to{ background-position: -520px 260px; }
}



/* Asegura que tu app quede por encima de before/after */
.app{ position: relative; z-index: 2; }
 
body::after{
  content:"";
  position:fixed;
  inset:0;
  background-image:
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='1'/></filter><rect width='120' height='120' filter='url(%23n)' opacity='.015'/></svg>");
  pointer-events:none;
  z-index:1;
}
/* =========================
   FABs ¬∑ navegaci√≥n (abajo izquierda)
   ========================= */
/* =========================
   FAB ¬∑ navegaci√≥n (speed dial)
   ========================= */
.nav-speed{
  position: fixed;
  right: calc(var(--edgePad, 14px) + 6px);
  bottom: calc(var(--edgePad, 14px) + 6px);
  z-index: 999999;

  display: flex;
  flex-direction: column;
  align-items: flex-end;
}

/* asegura que el bot√≥n principal siempre quede clicable */
.nav-fab-main{
  position: relative;
  z-index: 2;
}
.nav-menu{
  position: relative;
  z-index: 1;
}


/* Men√∫ (los accesos) */
.nav-menu{
  display: flex;
  flex-direction: column;
  gap: 10px;

  margin-bottom: 10px;              /* separa del bot√≥n principal */
  pointer-events: none;             /* cerrado = no clicable */
  opacity: 0;
  transform: translateY(10px) scale(.98);
  filter: blur(1px);
  transition: opacity .16s ease, transform .16s ease, filter .16s ease;
}

.nav-speed.open .nav-menu{
  pointer-events: auto;
  opacity: 1;
  transform: translateY(0) scale(1);
  filter: blur(0);
}

/* Micro-anim de cada item al abrir */
.nav-menu .nav-fab{
  opacity: 0;
  transform: translateY(6px);
  transition: opacity .16s ease, transform .16s ease;
}
.nav-speed.open .nav-menu .nav-fab{
  opacity: 1;
  transform: translateY(0);
}

/* Bot√≥n principal: rota el + al abrir */
.nav-fab-main svg{
  transition: transform .18s ease;
}
.nav-speed.open .nav-fab-main svg{
  transform: rotate(45deg);
}



.nav-fab{
  width: 46px;
  height: 46px;
  border-radius: 999px;

  display: grid;
  place-items: center;

  background: rgba(15,22,32,0.62);
  border: 1px solid rgba(255,255,255,0.14);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  box-shadow: 0 16px 50px rgba(0,0,0,.45);

  color: #e7edf5;
  text-decoration: none;

  cursor: pointer;
  user-select: none;
  transition: transform .12s ease, background .12s ease, border-color .12s ease, box-shadow .12s ease;
}

.nav-fab:hover{
  transform: translateY(-1px);
  background: rgba(15,22,32,0.78);
  border-color: rgba(217,170,63,0.35);
  box-shadow: 0 18px 60px rgba(0,0,0,.55), 0 0 0 6px rgba(217,170,63,.06);
}

.nav-fab:active{
  transform: translateY(0px) scale(0.98);
}

.nav-fab svg{
  width: 22px;
  height: 22px;
  display: block;
  opacity: .95;
}

.nav-fab:focus-visible{
  outline: none;
  box-shadow: 0 0 0 3px rgba(217,170,63,.22), 0 18px 60px rgba(0,0,0,.55);
}
    /* Bot√≥n principal: m√°s transparente */
.nav-fab-main{
background: rgba(15,22,32,0.32);

  border-color: rgba(255,255,255,0.10);
}

/* Hover: sigue visible pero sin volverse opaco */
.nav-fab-main:hover{
  background: rgba(15,22,32,0.55);
  box-shadow:
    0 14px 40px rgba(0,0,0,.35),
    0 0 0 4px rgba(217,170,63,.04);
}

/* ===== Entrada suave al cargar ===== */
body:not(.loaded) .panel{
  opacity: 0;
  transform: translateY(8px);
}
body.loaded .panel{
  opacity: 1;
  transform: translateY(0);
  transition: opacity .35s ease, transform .35s ease;
}
body.loaded .panel.right{
  transition-delay: .08s;
}
/* =========================
   Micro-ritual de entrada
   ========================= */
body:not(.loaded) .panel{
  opacity: 0;
  transform: translateY(8px);
}

body.loaded .panel{
  opacity: 1;
  transform: translateY(0);
  transition: opacity .38s ease, transform .38s ease;
}

/* izquierda primero */
body.loaded .panel.left{
  transition-delay: 0ms;
}

/* derecha 100ms despu√©s */
body.loaded .panel.right{
  transition-delay: 100ms;
}

/* hero: un pel√≠n despu√©s del panel derecho */
body:not(.loaded) .mp-hero{
  opacity: 0;
  transform: translateY(6px);
}
body.loaded .mp-hero{
  opacity: 1;
  transform: translateY(0);
  transition: opacity .42s ease, transform .42s ease;
  transition-delay: 160ms;
}
/* =========================
   Jerarqu√≠a tipogr√°fica del hero
   ========================= */
.modelPanel{
  padding-top: 22px; /* m√°s aire arriba */
}



.modelPanel .mp-hero-text{
  font-size: 13.5px;
  opacity: .92;
}

.modelPanel .mp-hint{
  font-size: 12.5px;
  opacity: .72; /* claramente secundario */
}
html, body{ position: relative; }
.app{ position: relative; z-index: 2; }
/* =========================
   Fondo: blobs de color muy blur (sutiles)
   ========================= */
.bg-blobs{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;             /* detr√°s de .app (que ya est√° en z-index:2) */
  overflow: hidden;
  filter: blur(70px);
  opacity: .55;           /* controla ‚Äúcu√°nto se intuyen‚Äù */
}

/* cada blob */
.bg-blobs::before,
.bg-blobs::after{
  content:"";
  position: absolute;
  width: 520px;
  height: 520px;
  border-radius: 999px;
  will-change: transform;
  mix-blend-mode: screen; /* se integra bien con fondos oscuros */
  opacity: .22;           /* opacidad del blob individual */
}

/* blob 1 (accent) */
.bg-blobs::before{
  left: -120px;
  top: -140px;
  background: radial-gradient(circle at 30% 30%,
    rgba(217,170,63,.95),
    rgba(217,170,63,0) 62%);
  animation: blobA 28s ease-in-out infinite;
}

/* blob 2 (azul) */
.bg-blobs::after{
  right: -160px;
  top: 120px;
  background: radial-gradient(circle at 35% 35%,
    rgba(78,121,167,.95),
    rgba(78,121,167,0) 62%);
  animation: blobB 34s ease-in-out infinite;
}

/* a√±adimos 2 blobs m√°s con un pseudo-layer extra usando background m√∫ltiple */
.bg-blobs{
  background:
    radial-gradient(circle at 22% 78%, rgba(118,183,178,.18), rgba(118,183,178,0) 52%),
    radial-gradient(circle at 72% 86%, rgba(176,122,161,.16), rgba(176,122,161,0) 55%);
  animation: blobBg 40s ease-in-out infinite;
}

@keyframes blobA{
  0%   { transform: translate3d(0,0,0) scale(1); }
  35%  { transform: translate3d(260px, 220px,0) scale(1.08); }
  70%  { transform: translate3d(520px, -40px,0) scale(0.96); }
  100% { transform: translate3d(0,0,0) scale(1); }
}

@keyframes blobB{
  0%   { transform: translate3d(0,0,0) scale(1); }
  30%  { transform: translate3d(-260px, 260px,0) scale(1.06); }
  65%  { transform: translate3d(-520px, -80px,0) scale(0.94); }
  100% { transform: translate3d(0,0,0) scale(1); }
}

@keyframes blobBg{
  0%   { background-position: 0% 0%, 0% 0%; }
  50%  { background-position: 14% -10%, -10% 12%; }
  100% { background-position: 0% 0%, 0% 0%; }
}

/* Respeta accesibilidad */
@media (prefers-reduced-motion: reduce){
  .bg-blobs, .bg-blobs::before, .bg-blobs::after{
    animation: none !important;
  }
}
#modelInfo.school-view .mp-hint{
  margin-top: 12px; /* en vez de auto */
}
.mi-item.active .mi-title{
  color: var(--schoolColor, #fff);
}
/* =========================
   MINI MAP como FONDO (derecha)
   (render limpio: blur solo en land, graticule sin blur)
   ========================= */

.modelPanel{
  position: relative;     /* clave para el absoluto */
  overflow: hidden;       /* recorta el mapa dentro del panel */
}

/* contenedor del ‚Äúfondo-mapa‚Äù */
.mp-mapbg{
  position: absolute;
  right: -36px;
  top: 0px;
  width: 560px;
  height: 340px;

  pointer-events: none;
  z-index: 0;

  opacity: .55;

  /* ‚úÖ clip real + estabilidad de composici√≥n */
  border-radius: 18px;
  overflow: hidden;

  will-change: transform;
  transform: translateZ(0);
  isolation: isolate;
}

/* el SVG ocupa el contenedor */
.mp-mapbg svg{
  width: 100%;
  height: 100%;
  display: block;

  /* ‚úÖ evita artefactos de composici√≥n */
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* ===== TIERRA (continentes) =====
   ‚úÖ blur SOLO aqu√≠ para que el mapa sea reconocible sin ‚Äúbandas‚Äù raras
*/
.mp-mapbg .land{
  filter: blur(0.85px);
  opacity: 1;
  transform: translateZ(0);
}

.mp-mapbg .land path{
  fill: rgba(231,237,245,0.18);
  stroke: rgba(231,237,245,0.22);
  stroke-width: 1.1;

  /* ‚úÖ mejora bordes en algunos renders */
  shape-rendering: geometricPrecision;
}

/* ===== GRATICULE (rejilla) =====
   ‚úÖ SIN blur + muy suave para que no ‚Äúensucie‚Äù arriba
*/
.mp-mapbg .graticule{
  filter: none !important;
  opacity: .38; /* baja la presencia global */
}

.mp-mapbg .graticule path{
  fill: none;
  stroke: rgba(231,237,245,0.10);
  stroke-width: 1;

  /* ‚úÖ hace que la rejilla no se convierta en ‚Äúbarras‚Äù */
  stroke-linecap: round;
  stroke-linejoin: round;
  stroke-dasharray: 2.2 6.5;
}

/* (Opcional) punto */
.mp-mapbg .mini-dot{
  stroke: rgba(255,255,255,0.85);
  stroke-width: 2;
}

/* ===== Fade real a transparente: MASK (tu versi√≥n) ===== */
.mp-mapbg{
  -webkit-mask-image:
    linear-gradient(to left,
      rgba(0,0,0,1) 0%,
      rgba(0,0,0,1) 68%,
      rgba(0,0,0,0) 97%
    ),
    linear-gradient(to bottom,
      rgba(0,0,0,1) 0%,
      rgba(0,0,0,1) 50%,
      rgba(0,0,0,0.35) 62%,
      rgba(0,0,0,0) 78%
    );
  -webkit-mask-composite: source-in;

  mask-image:
    linear-gradient(to left,
      rgba(0,0,0,1) 0%,
      rgba(0,0,0,1) 68%,
      rgba(0,0,0,0) 97%
    ),
    linear-gradient(to bottom,
      rgba(0,0,0,1) 0%,
      rgba(0,0,0,1) 50%,
      rgba(0,0,0,0.35) 62%,
      rgba(0,0,0,0) 78%
    );
  mask-composite: intersect;
}


/* velo MUY suave */
.mp-mapbg::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background: radial-gradient(240px 160px at 70% 45%, rgba(255,255,255,0.05), transparent 65%);
}

/* sube el contenido del panel por encima del mapa */
.modelPanel > :not(.mp-mapbg){
  position: relative;
  z-index: 1;
}

/* ===== Mini-mapa: reducir presencia en smartphone ===== */
@media (max-width: 768px){
  .mp-mapbg{
    opacity: .20;        /* antes .55 */
    right: -178px;        /* ‚úÖ m√°s a la derecha en m√≥vil (ajusta -60/-90 si quieres) */
  }

  .mp-mapbg .land{
    filter: blur(1.1px);
  }
}
.mp-ideas{
  display:flex;
  flex-direction:column;
  gap:10px;
}

.mp-idea{
  border:1px solid rgba(255,255,255,.08);
  border-radius:12px;
  background:rgba(255,255,255,.02);
  overflow:hidden;
}

.mp-idea-title{
  cursor:pointer;
  padding:12px 14px;
  font-weight:600;
  list-style:none;
}

.mp-idea-title::-webkit-details-marker{ display:none; }

.mp-idea-body{
  padding:0 14px 14px 14px;
  opacity:.88;
  line-height:1.55;
  white-space:pre-wrap;
}
    /* =========================
   IDEAS PRINCIPALES ‚Äì ACORDE√ìN INTERNO
   ========================= */

.mp-ideas{
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* contenedor de cada idea */
.mp-idea{
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 10px;
  background: rgba(255,255,255,.02);
  overflow: hidden;
}

/* t√≠tulo (summary) */
.mp-idea-title{
  position: relative;
  cursor: pointer;
  padding: 12px 36px 12px 14px;
  font-size: 14px;
  font-weight: 500;
  list-style: none;
}

/* quitamos marcador nativo */
.mp-idea-title::-webkit-details-marker{
  display: none;
}

/* ‚ñ∂ TRI√ÅNGULO (cerrado) */
.mp-idea-title::after{
  content: '‚ñ∏';
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 14px;
  opacity: .55;
  transition: transform .18s ease, opacity .18s ease;
}

/* ‚ñº TRI√ÅNGULO (abierto) */
.mp-idea[open] > .mp-idea-title::after{
  transform: translateY(-50%) rotate(90deg);
  opacity: .85;
}

/* cuerpo desplegable */
.mp-idea-body{
  padding: 0 14px 14px 14px;
  font-size: 14px;
  line-height: 1.55;
  opacity: .85;
  white-space: pre-wrap;
}
    /* ‚úÖ Sticky: selector de escuela fijo dentro del panel izquierdo (todas) */
.panel.left .schoolSticky{
  position: sticky;
  top: 0;

  z-index: 30;

  background: linear-gradient(180deg, var(--panelA), var(--panelB));
  backdrop-filter: blur(12px) saturate(115%);
  -webkit-backdrop-filter: blur(12px) saturate(115%);

  border-bottom: 1px solid rgba(255,255,255,0.10);
  box-shadow: 0 10px 26px rgba(0,0,0,0.28);
}

/* ‚úÖ Sticky del selector: arriba del todo (todas, y en m√≥vil tambi√©n) */
.panel.left .schoolSticky{
  position: sticky;
  top: 0;
  z-index: 30;
  margin-top: 0 !important;
}
/* ‚úÖ Cuando el selector est√° realmente ‚Äúpegado‚Äù arriba: esquinas superiores rectas */
@media (max-width: 980px){

  /* Cuando est√° en posici√≥n sticky activa */
  .panel.left:has(.schoolSticky:is(:sticky, :not(:has(*)))) .schoolSticky{
    border-top-left-radius: 0;
    border-top-right-radius: 0;

    /* mantenemos abajo redondeado */
    border-bottom-left-radius: 14px;
    border-bottom-right-radius: 14px;
  }
}

/* ‚úÖ Aire solo para el t√≠tulo */
.panel.left .title{
  padding-top: 14px;
  margin-top: 0;
}

/* ================== M√ìVIL ================== */
@media (max-width: 980px){

  :root{
    --leftH: 300px;     /* alto fijo panel izquierdo */
    --rightGap: 20px;   /* separaci√≥n entre paneles */
  }

  .panel.left{
    width: calc(100vw - (var(--edgePad) * 2));
    height: var(--leftH);      /* ‚úÖ fijo: sin movimiento */
    transition: none;
  }

  .panel.right{
    width: calc(100vw - (var(--edgePad) * 2));
    left: var(--edgePad);
    right: var(--edgePad);

    /* ‚úÖ fijo: sin readP */
    top: calc(var(--edgePad) + var(--leftH) + var(--rightGap));
    max-height: calc(100vh - (var(--edgePad) * 2) - (var(--leftH) + var(--rightGap)));

    transition: none;

    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
    touch-action: pan-y;
  }

  /* ‚úÖ Sticky compacto en m√≥vil: solo el select */
  .panel.left .schoolSticky{
    padding: 10px 12px;          /* menos alto */
  }

  /* Oculta ‚ÄúESCUELA‚Äù (label) */
  .panel.left .schoolSticky label{
    display: none !important;
  }

  /* Oculta el contador ‚ÄúX modelos en‚Ä¶‚Äù */
  .panel.left .schoolSticky #countLine{
    display: none !important;
  }

  /* Reduce el margen de la fila del label si sigue ocupando sitio */
  .panel.left .schoolSticky .row{
    margin-bottom: 0 !important;
    padding: 0 !important;
  }

  /* Ajuste fino del select para que se vea ‚Äúbarra‚Äù */
  .panel.left .schoolSticky select{
    width: 100%;
    height: 40px;                /* compacto */
  }

  /* ‚úÖ Mant√©n contain (pero quita will-change de animaci√≥n) */
  .panel.left, .panel.right{
    contain: layout paint;
  }
}

/* ‚úÖ Bordes rectos cuando el sticky est√° pegado (tu clase .stuck) */
.panel.left .schoolSticky.stuck{
  border-top-left-radius: 0;
  border-top-right-radius: 0;

  border-bottom-left-radius: 14px;
  border-bottom-right-radius: 14px;
}
/* ===== Bot√≥n FULL (arriba derecha dentro del panel de info) ===== */
.panel.right{ position: fixed; }  /* ya lo es, pero lo dejamos expl√≠cito */


.mp-fullBtn{
  position: fixed;        /* ‚úÖ fijo en pantalla */
  top: 12px;
  right: 12px;
  z-index: 1000000;       /* ‚úÖ por encima de todo */

  width: 34px;
  height: 34px;
  border-radius: 12px;

  display: grid;
  place-items: center;

  background: rgba(0,0,0,0.22);
  border: 1px solid rgba(255,255,255,0.14);
  color: rgba(231,237,245,0.95);

  cursor: pointer;
  user-select: none;

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
/* ===== Ocultar bot√≥n FULL mientras est√° la landing ===== */
body.landing-on .mp-fullBtn{
  opacity: 0;
  pointer-events: none;
  transform: translateY(-6px);
}


.mp-fullBtn:hover{
  border-color: rgba(255,255,255,0.22);
}

.mp-fullBtn svg{
  width: 18px;
  height: 18px;
  display: block;
}

/* ===== Estado FULLSCREEN del panel derecho ===== */
body.infoFull .panel.right{
  position: fixed;
  top: var(--edgePad);
  left: var(--edgePad);
  right: var(--edgePad);
  bottom: var(--edgePad);

  max-height: none;
  overflow: auto;

  z-index: 999999;
}

/* Oculta el panel superior mientras est√°s en fullscreen */
body.infoFull .panel.left{
  display: none !important;
}
    
    
/* ===== Sticky header del modelo (overlay bonito + solo cuando toca) ===== */
#stickyModelHeader{
  position: sticky;
  top: 0;
  z-index: 999998;

  /* ‚úÖ no ocupa, no empuja, no mueve scroll */
  height: 0;
  margin: 0;
  padding: 0;
  overflow: visible;
}

/* capa visual */
#stickyModelHeader .smh-overlay{
  position: absolute;
  top: 0;
  left: 0;
  right: 0;

  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 14px;

  /* apagado por defecto */
  opacity: 0;
  transform: translateY(-6px);
  pointer-events: none;

  /* ‚úÖ fondo y est√©tica (lo que te falta ahora) */
  background: linear-gradient(
    180deg,
    color-mix(in srgb, var(--schoolColor,#1e2a38) 18%, #131a22),
    rgba(19,26,34,0.70)
  );

  border-bottom: none;

backdrop-filter: blur(38px) saturate(145%) brightness(1.08);
-webkit-backdrop-filter: blur(38px) saturate(145%) brightness(1.08);


  box-shadow:
    0 8px 26px rgba(0,0,0,0.35),
    0 0 0 1px color-mix(in srgb, var(--schoolColor,#fff) 15%, transparent);

  transition: opacity .18s ease, transform .18s ease, box-shadow .18s ease;
  will-change: opacity, transform;
}
#stickyModelHeader .smh-overlay::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;

  background:
    linear-gradient(
      180deg,
      rgba(255,255,255,0.06),
      transparent 0%
    );

  mix-blend-mode: screen;
}

#stickyModelHeader.is-on .smh-overlay{
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;

  box-shadow:
    0 12px 32px rgba(0,0,0,0.45),
    0 0 0 1px color-mix(in srgb, var(--schoolColor,#fff) 25%, transparent);
}

#stickyModelHeader .smh-dot{

  width: 10px;
  height: 10px;
  border-radius: 999px;

  background: color-mix(in srgb, var(--schoolColor,#D9AA3F) 70%, transparent);
  border: 1px solid color-mix(in srgb, var(--schoolColor,#D9AA3F) 90%, transparent);

  box-shadow:
    0 0 0 5px color-mix(in srgb, var(--schoolColor,#D9AA3F) 18%, transparent),
    0 0 12px color-mix(in srgb, var(--schoolColor,#D9AA3F) 35%, transparent);

  flex: 0 0 auto;

  /* reposo */
  animation: none;

  transform-origin: center;
  will-change: transform, box-shadow, opacity;
}
#stickyModelHeader.is-on .smh-dot{
  animation: dotBreath 3.6s ease-in-out infinite;
}

/* TEXTO */
#stickyModelHeader .smh-title{
  font-weight: 950;
  letter-spacing: -0.4px;
  line-height: 1.1;
  font-size: 14px;
  color: var(--schoolColor,#fff);
  text-shadow: 0 0 8px color-mix(in srgb, var(--schoolColor,#fff) 25%, transparent);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

#stickyModelHeader .smh-author{
  margin-top: 2px;
  font-size: 12px;
  font-weight: 700;
  color: rgba(231,237,245,0.88);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

#stickyModelHeader .smh-text{
  display: flex;
  flex-direction: column;
  min-width: 0;
}

@keyframes dotBreath{
  0%,100%{
    transform: scale(1);
    box-shadow:
      0 0 0 4px color-mix(in srgb, var(--schoolColor,#D9AA3F) 14%, transparent),
      0 0 10px color-mix(in srgb, var(--schoolColor,#D9AA3F) 28%, transparent);
    opacity: .85;
  }

  50%{
    transform: scale(1.08); /* üëà solo +8% */
    box-shadow:
      0 0 0 6px color-mix(in srgb, var(--schoolColor,#D9AA3F) 22%, transparent),
      0 0 14px color-mix(in srgb, var(--schoolColor,#D9AA3F) 40%, transparent);
    opacity: .95;
  }
}

/* ===== Foto autor ===== */

.mp-author-wrap{
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.mp-author-photo{
  width: 54px;
  height: 54px;
  border-radius: 999px;
  object-fit: cover;

  border: 1px solid rgba(255,255,255,0.18);

  box-shadow:
    0 6px 18px rgba(0,0,0,0.35),
    inset 0 1px 0 rgba(255,255,255,0.08);

  background: rgba(255,255,255,0.06);
}

.mp-author-text{
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.mp-author-name{
  font-size: 13px;
  font-weight: 800;
  color: #fff;
  line-height: 1.2;
}

.mp-author-meta{
  font-size: 12px;
  font-weight: 600;
  color: rgba(231,237,245,0.75);
}
.mp-author-photo{ display:block; }

    .author-photo img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Esto evita que la foto se deforme */
    display: block;    /* Evita espacios fantasmas debajo de la imagen */
}
/* ===== SECUENCIAS (FLOW) ‚Äî versi√≥n m√°s visual ===== */
.mp-flow{
  --seqCol: color-mix(in srgb, var(--schoolColor,#D9AA3F) 60%, rgba(255,255,255,0.20));

  /* ‚úÖ geometr√≠a del carril */
  --dot: 26px;          /* tama√±o del n√∫mero */
  --col: 28px;          /* ancho columna del dot (grid) */
  --railX: calc((var(--col) - 3px) / 2);  /* centro del carril para l√≠nea de 3px */

  position: relative;
  display: flex;
  flex-direction: column;
gap: 0;

  padding-left: 40px;
padding-right: 14px;   /* ‚úÖ aire a la derecha */

  margin-top: 12px;
  --dotRight: calc((var(--col) + var(--dot)) / 2); /* borde derecho del c√≠rculo */

}


/* l√≠nea vertical principal (m√°s visible + glow) */
.mp-flow::before{
  content:"";
  position:absolute;
 left: var(--railX);

  top: 8px;
  bottom: 8px;
  width: 3px;
  background: linear-gradient(
    180deg,
    rgba(255,255,255,0.06),
    rgba(255,255,255,0.13),
    rgba(255,255,255,0.06)
  );
  border-radius: 99px;
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.06),
    0 0 18px rgba(0,0,0,0.35);
}

/* cada item */
.mp-flowItem{
  position: relative;
  display: grid;
  grid-template-columns: 28px 1fr;  /* columna dot + columna caja */
  column-gap: 14px;
  align-items: center;             /* ‚úÖ centra verticalmente el dot */

    }


/* segmento de l√≠nea por item (da sensaci√≥n de ‚Äútramo‚Äù conectando) */
.mp-flowItem::after{
  content:"";
  position:absolute;
  left: var(--railX);
  top: calc(50% + (var(--dot) / 2));
  bottom: -34px;
  width: 3px;
  background: rgba(255,255,255,0.10);
  border-radius: 99px;
  opacity: 0.9;
}

.mp-flowItem:last-child::after{ display:none; }

/* nodo numerado (m√°s protagonista + glow con color escuela) */
.mp-flowDot{
  position: relative;
  left: 0;
  top: 0;
margin-left: calc((var(--col) - var(--dot)) / 2);

  width: var(--dot);
height: var(--dot);


  border-radius: 999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight: 900;
  font-size: 12px;

  background: radial-gradient(circle at 30% 25%, rgba(255,255,255,0.20), rgba(255,255,255,0.08));
  border: 1px solid rgba(255,255,255,0.14);
  color: rgba(231,237,245,0.96);

  box-shadow:
    0 0 0 3px color-mix(in srgb, var(--seqCol) 20%, transparent),
    0 12px 26px rgba(0,0,0,0.35),
    0 0 18px color-mix(in srgb, var(--seqCol) 30%, transparent);
}

/* conector horizontal dot ‚Üí box + flecha (esto es lo que faltaba) */
.mp-flowItem::before{
  content:"";
  position:absolute;
  left: calc(var(--dotRight) + 0px);

  top: 50%;
  transform: translateY(-50%);
  width: calc(1px + 14px); /* col-gap (14) + un poco de aire (14) */
  height: 2px;
  background: linear-gradient(90deg, rgba(255,255,255,0.18), rgba(255,255,255,0.06));
  border-radius: 99px;
}


.mp-flowBox::before{
  content:"";
  position:absolute;
  left: -8px;
 top: 50%;
transform: translateY(-50%);
  width: 0;
  height: 0;
  border-top: 6px solid transparent;
  border-bottom: 6px solid transparent;
  border-left: 8px solid rgba(255,255,255,0.16);
  filter: drop-shadow(0 6px 12px rgba(0,0,0,0.25));
  opacity: 0.9;
}

/* caja (m√°s ‚Äúcard‚Äù + acento de color) */
.mp-flowBox{
  position: relative;
  grid-column: 2;

  flex: 1;

  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 18px;

  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
  box-shadow:
    0 18px 46px rgba(0,0,0,0.26),
    0 0 0 1px rgba(0,0,0,0.14) inset;

  padding: 12px 14px;

  overflow: hidden;
}

/* barra/acento lateral con color de escuela */
.mp-flowBox::after{
  content:"";
  position:absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: linear-gradient(180deg, var(--seqCol), rgba(255,255,255,0.06));
  opacity: 0.95;
}

/* hover (si quieres que ‚Äúse sienta‚Äù interactivo) */
.mp-flowBox:hover{
  transform: translateY(-1px);
  box-shadow:
    0 22px 56px rgba(0,0,0,0.32),
    0 0 0 1px rgba(0,0,0,0.14) inset,
    0 0 22px color-mix(in srgb, var(--seqCol) 22%, transparent);
}

/* texto principal */
.mp-flowAction{
  font-weight: 650;
  font-size: 12px;
  line-height: 1.35;
  color: rgba(231,237,245,0.94);
}

/* descripci√≥n de secuencia */
.mp-seqDesc{
  margin: 6px 14px 14px 40px;   /* ‚¨ÖÔ∏è alinea con el flow */
  opacity: .86;
  line-height: 1.45;

  padding: 10px 14px;
  border-radius: 14px;

  background: linear-gradient(
    180deg,
    rgba(255,255,255,0.045),
    rgba(255,255,255,0.02)
  );

  border: 1px solid rgba(255,255,255,0.08);
}



/* ===== Pasos desplegables dentro de Secuencias ===== */
.mp-step{
  /* mantiene est√©tica de mp-flowBox */
}

.mp-stepSum{
  list-style: none;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  cursor: pointer;
  user-select: none;
}

.mp-stepSum::-webkit-details-marker{ display:none; }

.mp-stepChev{
  opacity: .75;
  font-weight: 900;
  transform: translateY(-1px);
  transition: transform .18s ease, opacity .18s ease;
}

.mp-step[open] .mp-stepChev{
  transform: rotate(180deg) translateY(1px);
  opacity: .95;
}

.mp-stepBody{
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid rgba(255,255,255,0.08);
  line-height: 1.45;
  font-size: 12px;
  font-weight: 500;             /* ‚úÖ lectura m√°s c√≥moda */
  opacity: .88;
}

 @media (max-width: 980px){

  /* El paso completo pasa a columna */
  .mp-step{
    display: flex;
    flex-direction: column;
  }

  /* Summary en columna */
  .mp-stepSum{
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
    width: 100%;
    padding-right: 34px;
  }

  /* T√≠tulo ocupa todo */
  .mp-flowAction{
    width: 100%;
    display: block;
  }

  /* Cuerpo SIEMPRE debajo */
  .mp-stepBody{
    width: 100%;
    display: block;
    margin-top: 10px;
    padding-top: 8px;
  }

  /* Chevron fijo derecha */
  .mp-stepChev{
    position: absolute;
    right: 12px;
    top: 12px;
    transform: none;
  }

  /* Rotaci√≥n al abrir */
  .mp-step[open] .mp-stepChev{
    transform: rotate(180deg);
  }

}



/* Si no hay explicaci√≥n, quita sensaci√≥n de desplegable */
.mp-step[data-noexp="1"] .mp-stepChev{
  opacity: .25;
}
.mp-step[data-noexp="1"]{
  cursor: default;
}
.mp-step[data-noexp="1"] .mp-stepSum{
  cursor: default;
}

    /* ================== LANDING (pantalla inicio) ================== */
.landingOverlay{
    --accent: rgba(217,170,63,1);

  position: fixed;
  inset: 0;
  z-index: 2147483647; /* por encima de Teachable */
  display: none;
  align-items: center;
  justify-content: center;
  padding: 18px;

  background: rgba(10,14,20,0.78);



  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);

}
@media (max-width: 760px){
  .landingOverlay{
    background: rgba(10,14,20,0.62);
  }
}


.landingOverlay.is-on{ display: flex; }
.landingCard{
  width: min(900px, 100%);

  /* Fallbacks s√≥lidos para m√≥viles */
  max-height: 80vh;
  max-height: 90svh;            /* iOS moderno */
  max-height: min(80vh, 90dvh); /* viewport real m√≥vil */

  overflow-y: auto;
  -webkit-overflow-scrolling: touch; /* ‚úÖ iOS: scroll fluido */
  overscroll-behavior: contain;      /* ‚úÖ evita ‚Äúrebote‚Äù raro */

  border-radius: 28px;
  padding: 48px 56px;

  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);

  /* ‚úÖ m√°s ligero: el blur grande en un elemento que scrollea mata el rendimiento */
backdrop-filter: blur(12px) saturate(120%);
-webkit-backdrop-filter: blur(12px) saturate(120%);

/* ‚úÖ sombra menos ‚Äúcar√≠sima‚Äù */
box-shadow: 0 18px 60px rgba(0,0,0,0.45);

/* ‚úÖ aisla repintados del resto de la p√°gina */
contain: layout paint;

}


/* =========================
   Scrollbar glass (landing) ‚Äî igual que paneles
   ========================= */

/* Firefox */
.landingCard{
  scrollbar-width: thin;
  scrollbar-color: rgba(231,237,245,0.28) rgba(255,255,255,0.06);
}

/* Chrome / Edge / Safari */
.landingCard::-webkit-scrollbar{ width:10px; }
.landingCard::-webkit-scrollbar-track{
  background: rgba(255,255,255,0.05);
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.06);
}
.landingCard::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, rgba(231,237,245,0.28), rgba(231,237,245,0.14));
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.10);
}
.landingCard::-webkit-scrollbar-thumb:hover{
  background: linear-gradient(180deg, rgba(231,237,245,0.36), rgba(231,237,245,0.18));
}
/* Si el scroll ocurre en el overlay (m√≥vil), mantenemos el mismo look */
.landingOverlay{
  scrollbar-width: thin;
  scrollbar-color: rgba(231,237,245,0.28) rgba(255,255,255,0.06);
}
.landingOverlay::-webkit-scrollbar{ width:10px; }
.landingOverlay::-webkit-scrollbar-track{
  background: rgba(255,255,255,0.05);
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.06);
}
.landingOverlay::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, rgba(231,237,245,0.28), rgba(231,237,245,0.14));
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.10);
}
.landingOverlay::-webkit-scrollbar-thumb:hover{
  background: linear-gradient(180deg, rgba(231,237,245,0.36), rgba(231,237,245,0.18));
}

/* =========================
   LANDING HERO (t√≠tulo con estilo, sutil)
   ========================= */

.landingHero{
  padding: 6px 8px 16px 8px;
  margin-bottom: 10px;
}

.landingKicker{
  display: inline-flex;
  align-items: center;
  gap: 10px;

  font-size: 12px;
  letter-spacing: .22em;
  text-transform: uppercase;
  opacity: .72;
}

.landingKicker::before{
  content:"";
  width: 10px;
  height: 10px;
  border-radius: 999px;

  background: color-mix(in srgb, var(--accent) 70%, rgba(255,255,255,0.20));
  box-shadow:
    0 0 0 4px rgba(255,255,255,0.04),
    0 0 26px color-mix(in srgb, var(--accent) 38%, transparent);
  opacity: .95;
}

.landingH1{
  margin: 8px 0 0 0;
  font-size: 40px;
  font-weight: 750;           /* menos ‚Äúbloque‚Äù */
  letter-spacing: -0.03em;
  line-height: 1.06;

  background: none;           /* fuera gradient */
  -webkit-background-clip: initial;
  background-clip: initial;
  color: rgba(231,237,245,0.94);

  text-shadow: none;          /* fuera ‚Äúprofundidad‚Äù */
}


.landingH1::after{
  content:"";
  display:block;
  height: 1px;
  width: min(420px, 100%);
  margin-top: 10px;

  background: linear-gradient(90deg,
    color-mix(in srgb, var(--accent) 48%, rgba(255,255,255,0.18)),
    transparent 75%
  );
  opacity: .55;
}

.landingLead{
  margin-top: 10px;
  opacity: .78;
  line-height: 1.45;
  max-width: 62ch;
}

/* M√≥vil: m√°s compacto, igual de fino */
@media (max-width: 768px){
  .landingH1{
    font-size: 28px;
    line-height: 1.10;
    letter-spacing: -0.03em;
  }
  .landingH1::after{
    width: min(320px, 100%);
    opacity: .50;
  }
  .landingLead{
    max-width: 48ch;
  }
}

.landingGrid{
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 12px;
  padding: 10px 6px 6px 6px;
}

@media (max-width: 980px){
  .landingGrid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
}
@media (max-width: 760px){
  .landingGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (max-width: 520px){
  .landingGrid{ grid-template-columns: 1fr; }
}


.landingSchool{
  position: relative;
  border-radius: 16px;

  /* m√°s compacta */
  padding: 12px 16px 10px 18px;

  background: rgba(255,255,255,0.055);
  border: 1px solid rgba(255,255,255,0.10);

  backdrop-filter: blur(18px) saturate(140%);
  -webkit-backdrop-filter: blur(18px) saturate(140%);

  /* sombra m√°s editorial */
  box-shadow:
    0 14px 36px rgba(0,0,0,0.42),
    inset 0 1px 0 rgba(255,255,255,0.05);

  transition: transform .16s ease, box-shadow .16s ease, border-color .16s ease, background .16s ease;
  cursor: pointer;
  overflow: hidden;
}

.landingSchool:hover{
  transform: translateY(-1px);
  border-color: rgba(255,255,255,0.16);
  background: rgba(255,255,255,0.065);
  box-shadow:
    0 20px 48px rgba(0,0,0,0.48),
    inset 0 1px 0 rgba(255,255,255,0.06);
}

.landingSchool:active{
  transform: translateY(0px);
  box-shadow:
    0 12px 30px rgba(0,0,0,0.40),
    inset 0 1px 0 rgba(255,255,255,0.05);
}



/* banda color (firma visual de la escuela) */
.landingSchool::before{
  content:"";
  position:absolute;
  left: 6px;
  top: 6px;
  bottom: 6px;
  width: 3px;

  border-radius: 6px;

  
  opacity: .85;
}



.landingSchoolName{
  font-weight: 850;
  font-size: 19px;
  line-height: 1.05;
  letter-spacing: -0.6px;

  color: var(--schoolColor, #fff);
  text-shadow: 0 0 18px rgba(0,0,0,0.28);
}



.landingSchoolMeta{
  margin-top: 0;

  display:inline-flex;
  gap: 6px;
  align-items: center;

  margin-left: 8px;
  vertical-align: middle;

  background: none !important;
  border: none !important;
  box-shadow: none !important;
  padding: 0 !important;
  border-radius: 0 !important;

  font-size: 10.5px;
  font-weight: 800;
  letter-spacing: 0.2px;
  color: rgba(231,237,245,0.62);
}

.landingSchoolMeta .landingCount{
  color: rgba(231,237,245,0.92);
  font-weight: 950;
}

.landingSchoolMeta .landingCountLabel{
  color: rgba(231,237,245,0.62);
  font-weight: 800;
}


.landingSchoolMeta .landingCount{
  color: rgba(231,237,245,0.92);
}

.landingSchoolMeta .landingCountLabel{
  color: rgba(231,237,245,0.68);
  font-weight: 700;
}



/* ================== /LANDING ================== */

    // secuencias circulares. 
  /* ===== SECUENCIAS (FLOW) ‚Äî modo CIRCULAR para protocolo_ciclico ===== */
.mp-flow.mp-flow-circ{
  position: relative;

  /* tama√±o del c√≠rculo */
  width: min(560px, 100%);
  height: 360px;

  /* anulamos el carril vertical */
  padding-left: 0;
  margin-top: 14px;

  display: block;
}

.mp-flow.mp-flow-circ::before{
  display:none; /* quita la l√≠nea vertical */
}

/* los items pasan a posici√≥n absoluta */
.mp-flow.mp-flow-circ .mp-flowItem{
  position: absolute;
  left: 50%;
  top: 50%;

  /* el item ya no necesita grid de 2 columnas */
  display: block;
  grid-template-columns: none;
  column-gap: 0;
  align-items: initial;
}

.mp-flow.mp-flow-circ .mp-flowItem::after{
  display:none; /* quita el tramo vertical por item */
}

/* dot y caja apilados */
.mp-flow.mp-flow-circ .mp-flowDot{
  margin: 0 auto 8px auto;
}

.mp-flow.mp-flow-circ .mp-flowBox{
  width: 190px;
  text-align: center;
}

/* colocaci√≥n circular usando variables CSS por item */
.mp-flow.mp-flow-circ .mp-flowItem{
  --r: 135px;  /* radio */
  transform:
    translate(-50%,-50%)
    rotate(var(--ang))
    translate(var(--r))
    rotate(calc(-1 * var(--ang)));
}

/* icono central de ciclo */
.mp-flow.mp-flow-circ::after{
  content:"‚Ü∫";
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%);
  font-size: 28px;
  font-weight: 900;
  color: color-mix(in srgb, var(--schoolColor,#D9AA3F) 70%, rgba(255,255,255,0.20));
  opacity: .85;
  text-shadow: 0 0 18px rgba(0,0,0,0.35);
}
/* ===== FLOW C√çCLICO: flecha √∫ltimo ‚Üí primero ===== */

.mp-flow.mp-flow-loop{
  position: relative;
  padding-bottom: 52px;
 /* espacio para la flecha */
}


.mp-flow.mp-flow-loop::before{
  content:"";

  position:absolute;

  left: 22px;
  top: 18px;
  bottom: 22px;

  width: 2px;

  background: linear-gradient(
    to bottom,
    transparent,
    color-mix(in srgb, var(--schoolColor,#D9AA3F) 60%, transparent),
    transparent
  );

  opacity:.5;
}
/* ===== RETORNO DESDE √öLTIMO PASO AL INICIO ===== */

.mp-flow.mp-flow-loop .mp-flowItem:last-child{
  position: relative;
}


/* ===== Teachable: permitir ancho completo ===== */
html, body{
  width: 100%;
  height: 100%;
}

body{
  margin: 0;
}

/* Si Teachable envuelve con containers t√≠picos */
.container, .container-fluid, .row, .col, .col-12, .course-mainbar, .lecture-mainbar{
  max-width: none !important;
}

/* Tu root (elige el id/clase real si lo tienes) */
#app, #root, .app, .tmpsApp{
  max-width: none !important;
  width: 100% !important;
}

/* Evita padding heredado del contenedor */
#app, #root, .app, .tmpsApp{
  margin: 0 !important;
  padding: 0 !important;
}
.landing-hero{
  text-align:center;
  margin-bottom:48px;
}

.landing-hero h1{
  font-size:44px;
  font-weight:750;
  letter-spacing:-0.028em;
  margin:0 0 12px;
}


.landing-hero p{
  font-size:17px;
  opacity:.68;
  line-height:1.6;
  margin:0;
}

/* Micro-noise ultra sutil (Apple style) */
.landingSchool::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius: inherit;
  pointer-events:none;

  background-image:
    url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120'><filter id='n'><feTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='1'/></filter><rect width='120' height='120' filter='url(%23n)' opacity='.02'/></svg>");

  mix-blend-mode: overlay;
}
.landingSchool{
  background-clip: padding-box;
}

.landingSchool::before{
  /* tu banda sigue igual */
}

.landingSchool::marker{ display:none; } /* por si acaso */
.landingSchool .spec{
  display:none;
}
/* =========================
   LANDING ¬∑ FIX SMARTPHONE
   ========================= */

@media (max-width: 768px){

  .landingOverlay{
    align-items: flex-start;   /* no centra vertical */
    padding-top: 12px;
  }

  .landingCard{
    margin-top: 12px;

    max-height: 92dvh;
    padding: 28px 22px;

    border-radius: 22px;
  }

  .landingTitle{
    font-size: 26px;
    line-height: 1.15;
  }
}
/* =========================
   SCROLL FIX LANDING (m√≥vil)
   ========================= */

/* Fondo bloqueado SOLO cuando la landing est√° activa */
body.landing-on{
  overflow: hidden !important;
  height: 100%;
}

/* El overlay es el contenedor scrolleable */
.landingOverlay{
  height: 100dvh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;
}

/* La tarjeta tambi√©n puede scrollear (doble seguridad) */
.landingCard{
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-y;
}
/* =========================
   LANDING BLOBS (1 color, sutil)
   ========================= */

.landingBlobs{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;            /* detr√°s del contenido */
  overflow: hidden;

  /* ‚Äúun solo color‚Äù (usa tu accent) */
  --blob: rgba(217,170,63,0.55);


  filter: blur(100px);
  opacity: .55;
}

/* 2 blobs grandes */
.landingBlobs::before,
.landingBlobs::after{
  content:"";
  position:absolute;
  width: 560px;
  height: 560px;
  border-radius: 999px;
  will-change: transform;
  mix-blend-mode: screen;
  opacity: .18;

  background: radial-gradient(circle at 30% 30%, var(--blob), rgba(217,170,63,0) 62%);
}

.landingBlobs::before{
  left: -180px;
  top: -220px;
  animation: landingBlobA 34s ease-in-out infinite;
}

.landingBlobs::after{
  right: -220px;
  bottom: -240px;
  animation: landingBlobB 40s ease-in-out infinite;
}

/* Asegura que la landing (contenido) quede por encima */
#landingOverlay .landingShell{
  position: relative;
  z-index: 1;
}

@keyframes landingBlobA{
  0%   { transform: translate3d(0,0,0) scale(1); }
  50%  { transform: translate3d(220px, 180px,0) scale(1.06); }
  100% { transform: translate3d(0,0,0) scale(1); }
}
@keyframes landingBlobB{
  0%   { transform: translate3d(0,0,0) scale(1); }
  50%  { transform: translate3d(-240px, -160px,0) scale(1.05); }
  100% { transform: translate3d(0,0,0) scale(1); }
}

/* En m√≥vil: que se note un pel√≠n m√°s sin volverse ‚Äúfiesta‚Äù */
@media (max-width: 760px){
  .landingBlobs{
    filter: blur(70px);
    opacity: .70;
  }
  .landingBlobs::before,
  .landingBlobs::after{
    opacity: .22;
  }
}

/* Accesibilidad */
@media (prefers-reduced-motion: reduce){
  .landingBlobs::before,
  .landingBlobs::after{
    animation: none !important;
  }
}

  </style>
</head>

<body>
   <div class="bg-blobs" aria-hidden="true"></div>
  <div class="app">
    <!-- PANEL IZQUIERDO -->
    <aside class="panel left">
    <h1 class="title">
  <span class="t-eyebrow">Buscador por</span>
  <span class="t-main">Modelos</span>
</h1>

     

     <div class="card schoolSticky">

        <div class="row" style="margin-bottom:8px">
          <label for="schoolSelect">Escuela</label>
        </div>
        <select id="schoolSelect"></select>

        <div id="countLine" class="subtitle" style="margin:10px 0 0 0; opacity:.9"></div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div style="font-weight:900; font-size:13px; color:#fff">Modelos</div>
          <div class="subtitle" style="margin:0; font-size:12px">clic para abrir ficha</div>
        </div>
        <div id="modelsList" class="modelsList"></div>
      </div>
    </aside>

    <!-- PANEL DERECHO -->
    <main class="panel right model-panel">
    <div id="modelInfo" class="modelPanel">
  <div class="mp-hero">
    <div class="mp-hero-eyebrow">Biblioteca viva</div>
    <div class="mp-hero-title">Modelos psicoterap√©uticos</div>
    <div class="mp-hero-text">
      Explora c√≥mo distintas escuelas entienden el cambio, el sufrimiento y la intervenci√≥n cl√≠nica.
    </div>

    <div class="mp-hero-steps">
      <div class="mp-step"><span class="mp-step-dot"></span>1) Elige una escuela</div>
      <div class="mp-step"><span class="mp-step-dot"></span>2) Haz clic en un modelo</div>
      <div class="mp-step"><span class="mp-step-dot"></span>3) Lee influencias, procedimientos y micros</div>
    </div>
  </div>

  <div class="mp-hint">Selecciona una escuela y luego un modelo para ver toda su informaci√≥n.</div>
</div>

    </main>
  </div>

  <script>
    // ================== √çndice de fotos de autores (ESCALABLE) ==================
window.AUTHOR_PHOTO_INDEX = null;

console.log('‚úÖ script fotos cargado', location.href);

async function loadAuthorPhotoIndex(){

  const url = 'https://josepmunta-design.github.io/tmps-data/data/Core/fotos/foto.json';

  try{
    const r = await fetch(url, { cache: 'no-store' });
    if (!r.ok) throw new Error('foto.json HTTP ' + r.status);

    const data = await r.json();
    const root = (data && typeof data === 'object') ? data : {};

    const authorsRaw = (root.authors && typeof root.authors === 'object') ? root.authors : {};
    const modelsRaw  = (root.models  && typeof root.models  === 'object') ? root.models  : {};

    const authorsNorm = {};
    for (const [k, v] of Object.entries(authorsRaw)){
      if (typeof v === 'string' && v.trim()) authorsNorm[normAuthorKey(k)] = v.trim();
    }

    const modelsNorm = {};
    for (const [k, v] of Object.entries(modelsRaw)){
      if (typeof v === 'string' && v.trim()) modelsNorm[String(k).trim()] = v.trim();
    }

    window.AUTHOR_PHOTO_INDEX = { authors: authorsNorm, models: modelsNorm };

    console.log('üì∏ Foto index cargado:', window.AUTHOR_PHOTO_INDEX);
return window.AUTHOR_PHOTO_INDEX;


  }catch(e){
    console.warn('No se pudo cargar foto.json', e);
   window.AUTHOR_PHOTO_INDEX = { authors:{}, models:{} };
return window.AUTHOR_PHOTO_INDEX;

  }
}



function normAuthorKey(s){
  return String(s ?? '')
    .trim()
    .toLowerCase()
    .normalize('NFD')                 // separa acentos
    .replace(/[\u0300-\u036f]/g,'')   // quita acentos
    .replace(/[^a-z0-9 ]+/g,' ')      // ‚úÖ quita puntos, comas, guiones, etc.
    .replace(/\s+/g,' ')             // colapsa espacios
    .trim();
}


window.getAuthorPhoto = function(authorName){

  const idx = window.AUTHOR_PHOTO_INDEX;
  const authors = idx && idx.authors ? idx.authors : null;

  if (!authors || !Object.keys(authors).length) return null;

  const key = normAuthorKey(authorName);
  const file = authors[key];

  if (!file) return null;

  return 'https://josepmunta-design.github.io/tmps-data/data/Core/fotos/' + file;
};

window.getModelPhoto = function(modelId, authorName){

  const idx = window.AUTHOR_PHOTO_INDEX;
  const models = idx && idx.models ? idx.models : null;

  // 1) Preferencia total: por ID de modelo
  if (models && modelId){
    const fileById = models[String(modelId).trim()];
    if (fileById){
      return 'https://josepmunta-design.github.io/tmps-data/data/Core/fotos/' + fileById;
    }
  }

  // 2) Fallback: por autor (por si a√∫n no has mapeado ese modelo)
  return window.getAuthorPhoto(authorName);
};



   window.addEventListener('DOMContentLoaded', async () => {

await loadAuthorPhotoIndex();
    // =========================================================
    // 1) COLORES de escuelas (puedes copiar los tuyos)
    // =========================================================
    const BG_COLS = [
      { key:'Psicoan√°lisis',    color:'#4E79A7' },
      { key:'Conductismo',     color:'#d69640' },
      { key:'Cognitivo',       color:'#E15759' },
      { key:'Humanista',       color:'#76B7B2' },
      { key:'Sist√©mico',       color:'#F1CE63' },
      { key:'Constructivista', color:'#B07AA1' },
      { key:'Integrativo',     color:'#FF9DA7' },
   { key:'Transversal', color:'#5F7F78' },



      { key:'Otros',  color:'#f2f2f2' }
    ];
    const groupColor = new Map(BG_COLS.map(d => [d.key, d.color]));
      
      
    // ===== INFO DE ESCUELAS (texto manual) =====
const SCHOOL_INFO = {
  'Psicoan√°lisis': {
    subtitle: 'Inconsciente, conflicto, defensas y desarrollo',
    desc: `La escuela psicoanal√≠tica entiende el malestar como expresi√≥n de conflictos internos, defensas y patrones relacionales
que se organizan a lo largo del desarrollo. El trabajo terap√©utico suele centrarse en insight, elaboraci√≥n emocional y cambio
de patrones (transferencia/relaci√≥n terap√©utica) con distintos grados de directividad seg√∫n el autor.`,
    keys: ['conflicto/defensas', 'transferencia', 'desarrollo', 'relaci√≥n terap√©utica', 'elaboraci√≥n']
  },

  'Conductismo': {
    subtitle: 'Aprendizaje, contingencias y exposici√≥n',
    desc: `El foco est√° en c√≥mo se adquieren y mantienen conductas y respuestas emocionales mediante aprendizaje.
La intervenci√≥n prioriza evaluaci√≥n funcional, cambio de contingencias, entrenamiento y exposici√≥n para modificar h√°bitos
y reducir evitaci√≥n.`,
    keys: ['an√°lisis funcional', 'exposici√≥n', 'refuerzo', 'habilidades', 'h√°bitos']
  },

  'Cognitivo': {
    subtitle: 'Procesamiento de la informaci√≥n, creencias y reestructuraci√≥n',
    desc: `Plantea que pensamiento, atenci√≥n y memoria influyen en emoci√≥n y conducta. Se trabaja sobre creencias,
sesgos y estrategias de afrontamiento con t√©cnicas como reestructuraci√≥n, experimentos conductuales y entrenamiento
metacognitivo seg√∫n el modelo.`,
    keys: ['creencias', 'sesgos', 'reestructuraci√≥n', 'experimentos', 'metacognici√≥n']
  },

  'Humanista': {
    subtitle: 'Experiencia, autenticidad y crecimiento',
    desc: `Enfatiza la experiencia vivida, la congruencia y el potencial de crecimiento. La relaci√≥n terap√©utica es
un agente central de cambio (presencia, aceptaci√≥n, empat√≠a) y el trabajo suele facilitar contacto emocional y
autocompasi√≥n/autenticidad.`,
    keys: ['experiencia', 'empat√≠a', 'aceptaci√≥n', 'autenticidad', 'crecimiento']
  },

  'Sist√©mico': {
    subtitle: 'Patrones relacionales, comunicaci√≥n y contexto',
    desc: `Entiende el problema en el sistema de relaciones y en los patrones de interacci√≥n. La intervenci√≥n busca
cambiar reglas, significados y secuencias comunicacionales, trabajando con familia/pareja o con el sistema ‚Äúinterno‚Äù
representado en sesi√≥n.`,
    keys: ['patrones', 'comunicaci√≥n', 'ciclo', 'contexto', 'reencuadre']
  },

  'Integrativo': {
    subtitle: 'Procesos y combinaci√≥n coherente de estrategias',
    desc: `Integra t√©cnicas y principios de distintas tradiciones buscando coherencia con el caso y con procesos de cambio.
Suele apoyarse en formulaci√≥n de caso, factores comunes y selecci√≥n estrat√©gica de intervenciones.`,
    keys: ['formulaci√≥n', 'procesos', 'factores comunes', 'selecci√≥n', 'flexibilidad']
  },
  'Constructivista': {
  subtitle: 'Significado, organizaci√≥n del self y construcci√≥n de la experiencia',
  desc: `La escuela constructivista entiende el malestar como una forma de organizaci√≥n del significado y del self,
construida a lo largo de la experiencia relacional y biogr√°fica. El cambio terap√©utico no se produce corrigiendo
contenidos, sino transformando la manera en que la persona interpreta, da sentido y se relaciona con su propia
experiencia, favoreciendo coherencia, diferenciaci√≥n e integraci√≥n.`,
  keys: ['significado', 'self', 'narrativa', 'coherencia', 'identidad']
},
  'Transversal': {
  subtitle: 'Factores comunes, procesos de cambio y coherencia terap√©utica',
  desc: `Los enfoques transversales no se definen por una teor√≠a √∫nica del problema, sino por identificar
procesos de cambio y condiciones que operan a trav√©s de distintos modelos. El √©nfasis se pone en la alianza,
las expectativas, la explicaci√≥n compartida del malestar y la activaci√≥n de procesos psicol√≥gicos relevantes,
buscando coherencia cl√≠nica m√°s que fidelidad a una escuela concreta.`,
  keys: ['factores comunes', 'alianza', 'expectativas', 'procesos de cambio', 'coherencia']
},
  'Otros': {
  subtitle: 'Tradiciones no occidentales, contemplativas y culturales',
  desc: `La categor√≠a ‚ÄúOtros‚Äù agrupa enfoques terap√©uticos que no emergen del desarrollo hist√≥rico occidental de la psicoterapia,
o que se basan en epistemolog√≠as distintas a las escuelas cl√°sicas (psicoan√°lisis, cognitivo, humanista, sist√©mico, etc.).

Incluye tradiciones orientales, modelos contemplativos, enfoques ind√≠genas y sistemas de comprensi√≥n del sufrimiento
basados en la aceptaci√≥n, la acci√≥n correcta, la disciplina vital o la relaci√≥n con la naturaleza y la comunidad.
En estos modelos, el cambio no se produce corrigiendo s√≠ntomas ni contenidos mentales, sino transformando la relaci√≥n
con la experiencia y la forma de vivirla.`,
  keys: [
    'aceptaci√≥n',
    'acci√≥n con malestar',
    'conciencia',
    'disciplina vital',
    'sabidur√≠a experiencial',
    'contexto cultural'
  ]
}



};

function hexToRgba(hex, a=0.14){
  if (!hex) return `rgba(217,170,63,${a})`;
  const h = hex.replace('#','').trim();
  const full = h.length===3 ? h.split('').map(x=>x+x).join('') : h;
  const n = parseInt(full, 16);
  const r = (n >> 16) & 255;
  const g = (n >> 8) & 255;
  const b = n & 255;
  return `rgba(${r},${g},${b},${a})`;
}
     function getAuthorPhoto(autorNombre) {
  if (!FOTOS || !FOTOS.authors) return null;
  
  // Normaliza la clave: min√∫sculas, quita espacios extra
  const key = String(autorNombre || '')
    .toLowerCase()
    .trim()
    .replace(/\s+/g, ' '); // maneja "Albert Ellis" ‚Üí "albert ellis"
  
  const fileName = FOTOS.authors[key];
  if (!fileName) return null;
  
  return `https://raw.githubusercontent.com/josepmunta-design/tmps-data/main/data/Core/fotos/${fileName}`;
}

function getModelPhoto(modelId, autorFallback) {
  if (!FOTOS || !FOTOS.models) return null;
  
  const key = String(modelId || '').toLowerCase().trim();
  const fileName = FOTOS.models[key];
  
  // Si hay foto espec√≠fica del modelo ‚Üí √∫sala
  if (fileName) {
    return `https://raw.githubusercontent.com/josepmunta-design/tmps-data/main/data/Core/fotos/${fileName}`;
  }
  
  // Sino ‚Üí fallback a foto del autor
  return getAuthorPhoto(autorFallback);
}
function tintForModel(model, selectedSchool){
  // Prioridad 1: escuela seleccionada (tu UI trabaja por escuela)
  if (selectedSchool && groupColor.has(selectedSchool)) return groupColor.get(selectedSchool);

  // Prioridad 2: inferir por texto del grupo si no coincide exacto
  const g = (model?.grupo || '').toLowerCase();
  if (g.includes('cognit')) return groupColor.get('Cognitivo') || '#E15759';
  if (g.includes('conduct')) return groupColor.get('Conductista') || '#d69640';
  if (g.includes('psicoan')) return groupColor.get('Psicoan√°lisis') || '#4E79A7';
  if (g.includes('human')) return groupColor.get('Humanista') || '#76B7B2';
  if (g.includes('sist')) return groupColor.get('Sist√©mico') || '#F1CE63';
  if (g.includes('construct')) return groupColor.get('Constructivista') || '#B07AA1';
  if (g.includes('integr')) return groupColor.get('Integrativo') || '#FF9DA7';

  // Fallback
  return '#D9AA3F';
}

    // =========================================================
    // 2) DATOS: estructura EXACTA que t√∫ importas del otro c√≥digo
    //    (nota: esta app NO muestra "procesos" ni "mjps" aunque existan)
    // =========================================================
    const LOCAL_MODELS = [
      // OTROS
    
      
      {
  id:'o2sewb2000',
  grupo:'Otros',
  label:'Social and Emotional Wellbeing (SEWB)',
  year:'2000',
  autores:'Desarrollos ind√≠genas australianos (marco SEWB)',

  universidad:'Servicios y organizaciones ind√≠genas (Central Australia)',
  ciudad:'Alice Springs',
  pais:'Australia',
  lat:-23.698041,
  lon:133.880747,

  influencias:[
    'Cosmovisiones ind√≠genas australianas',
    'Salud mental ind√≠gena',
    'Trauma hist√≥rico y transgeneracional',
    'Relaci√≥n con la tierra y la comunidad',
    'Psicoterapia comunitaria y relacional',
    'Seguridad cultural (cultural safety)'
  ],

  // =========================================================
  // ALIANZA TERAP√âUTICA EN SEWB
  // =========================================================
  alianzaModelo:{

    ALI_vinculo:`
En SEWB, el v√≠nculo se construye ante todo como seguridad cultural: respeto, humildad, permiso y confianza.
La relaci√≥n terap√©utica no se entiende solo como ‚Äúentre dos‚Äù, sino como una relaci√≥n situada en comunidad,
historia y territorio. El terapeuta (o equipo) se posiciona de forma no colonizadora: escucha, no impone
categor√≠as externas y reconoce expl√≠citamente el impacto del trauma hist√≥rico y la exclusi√≥n.
`,

    ALI_objetivos:`
Los objetivos se definen en t√©rminos de restauraci√≥n de equilibrio y continuidad identitaria: reconectar con
tierra/pa√≠s, cultura, espiritualidad, familia y comunidad; fortalecer dignidad, pertenencia y agencia; y reducir
sufrimiento asociado a rupturas relacionales y p√©rdidas. La ‚Äúmejor√≠a‚Äù no se mide solo por s√≠ntomas, sino por
reconexi√≥n, funcionamiento comunitario y sentido de continuidad.
`,

    ALI_tareas:`
Las tareas se orientan a la reconexi√≥n: narrativas y yarning (conversaci√≥n culturalmente situada), actividades
comunitarias, ceremonias/rituales cuando procede, pr√°cticas en territorio, apoyo familiar y redes de cuidado.
El plan se acuerda con el paciente y, si es apropiado, con referentes comunitarios, siempre con consentimiento.
`,

    ALI_colaboracion:`
La colaboraci√≥n es comunitaria y compartida: se trabaja con servicios ind√≠genas, mayores (Elders), familia y
redes locales cuando el caso lo permite. El paciente no se entiende como ‚Äúindividuo aislado‚Äù, sino como parte
de un tejido relacional. La intervenci√≥n se co-dise√±a para respetar cultura, idioma, tiempos y formas de ayuda.
`,

    ALI_sintonia:`
La sinton√≠a se expresa con responsividad cultural: respetar silencios, ritmos, modo narrativo, y la prioridad
de la relaci√≥n sobre la eficiencia. Se evita el interrogatorio cl√≠nico y se privilegia una presencia consistente
y respetuosa. La sinton√≠a incluye reconocer el lugar del cuerpo, la tierra, lo espiritual y lo colectivo.
`,

    ALI_rupturaReparacion:`
Las rupturas suelen aparecer cuando el paciente percibe juicio, prisa, tecnicismo o imposici√≥n de marcos
diagn√≥sticos externos. La reparaci√≥n exige volver a la seguridad cultural: nombrar el malentendido, pedir
permiso de nuevo, clarificar intenci√≥n, ofrecer opciones (incluida derivaci√≥n a servicios ind√≠genas) y ajustar
el encuadre para devolver control y dignidad.
`,

    ALI_monitorizacion:`
La monitorizaci√≥n se centra en se√±ales de reconexi√≥n y estabilidad: mayor participaci√≥n comunitaria, mejora del
sue√±o y la regulaci√≥n, reducci√≥n de aislamiento, incremento de sentido de pertenencia y esperanza, y menor
reactividad asociada al trauma. Se revisan barreras estructurales (vivienda, acceso, discriminaci√≥n) como parte
del proceso terap√©utico, no como ‚Äúfactores externos‚Äù.
`,

    ALI_contexto:`
El contexto no es un ‚Äúmodulador‚Äù: es el n√∫cleo. SEWB integra expl√≠citamente colonizaci√≥n, p√©rdidas culturales,
racismo, pobreza y desplazamiento como determinantes del sufrimiento. La intervenci√≥n busca restaurar v√≠nculos
y condiciones de vida, coordinando recursos y apoyos comunitarios.
`
  },

  descripcion:`
El marco de Social and Emotional Wellbeing (SEWB) es la referencia ind√≠gena australiana para comprender salud mental
y bienestar. La salud psicol√≥gica se entiende como equilibrio entre dimensiones interconectadas: conexi√≥n con la tierra,
la cultura, la espiritualidad, la familia, la comunidad y la identidad colectiva. El sufrimiento se conceptualiza como
ruptura de estas conexiones, frecuentemente asociada a trauma hist√≥rico, colonizaci√≥n, p√©rdida cultural y exclusi√≥n
social. La intervenci√≥n prioriza enfoques relacionales, comunitarios y culturalmente seguros: narrativas, rituales,
apoyo comunitario y pr√°cticas de reconexi√≥n cultural. El cambio se concibe como restauraci√≥n de v√≠nculos, dignidad y
continuidad identitaria, m√°s que como tratamiento individual de s√≠ntomas.
`,

  procesos:[
    'Restauraci√≥n de conexiones (tierra, cultura, espiritualidad, comunidad, familia)',
    'Seguridad cultural y dignidad',
    'Narrativa situada y continuidad identitaria',
    'Regulaci√≥n y reparaci√≥n tras trauma hist√≥rico'
  ],

  // Incluye procesos MJPS relevantes (sin forzar coherencias occidentales)
  mjps:['RF','RE','AP','RI','N','I','AG','R'],

  refs:[
    'Gee, G., Dudgeon, P., Schultz, C., Hart, A., & Kelly, K. (2014). Aboriginal and Torres Strait Islander Social and Emotional Wellbeing. Commonwealth of Australia.',
    'Dudgeon, P., Milroy, H., & Walker, R. (Eds.). (2014). Working Together: Aboriginal and Torres Strait Islander Mental Health and Wellbeing Principles and Practice.',
    'Australian Government Department of Health. (2017). National Strategic Framework for Aboriginal and Torres Strait Islander Peoples‚Äô Mental Health and Social and Emotional Wellbeing.'
  ],

  // =========================================================
  // PROCEDIMIENTOS
  // =========================================================
  procedimientos:[

    {
      nombre:'Formulaci√≥n SEWB por conexiones',
      codigo:'p_sewb_formulacionConexiones',
      procesos:['N_formulacionCaso'],
      texto:`Mapeo cl√≠nico-cultural del caso como patr√≥n de conexiones y rupturas (tierra/pa√≠s, cultura, espiritualidad,
familia, comunidad, identidad, cuerpo). Se identifica qu√© v√≠nculos est√°n da√±ados y qu√© apoyos/reconexiones son
posibles en el contexto real del paciente. No se prioriza el diagn√≥stico; se prioriza la comprensi√≥n situada.`
    },

    {
      nombre:'Yarning / narrativa situada',
      codigo:'p_sewb_yarning',
      procesos:['AP_profundizacion'],
      texto:`Conversaci√≥n narrativa culturalmente adecuada (yarning) para reconstruir historia, p√©rdidas, fortalezas y
sentido de continuidad. Se trabaja con lenguaje cotidiano, met√°foras culturales y ritmos no interrogativos.
La narrativa no es ‚Äúinsight‚Äù individual: es restauraci√≥n de identidad y significado en relaci√≥n.`
    },

    {
      nombre:'Reconexi√≥n con tierra y cultura',
      codigo:'p_sewb_reconexionCultural',
      procesos:['I_continuidadBiografica'],
      texto:`Intervenciones orientadas a reconectar con territorio (Country), pr√°cticas culturales, lengua, historias
comunitarias y pertenencia. Puede incluir actividades en tierra, participaci√≥n en eventos, rituales o pr√°cticas
apropiadas, siempre con permiso y gu√≠a cultural.`
    },

    {
      nombre:'Intervenci√≥n familiar y comunitaria',
      codigo:'p_sewb_comunitaria',
      procesos:['R_apoyoSocial'],
      texto:`Trabajo con familia, comunidad y servicios ind√≠genas (con consentimiento) para restaurar apoyo, reducir
aislamiento y reparar v√≠nculos. Incluye coordinaci√≥n de recursos, acompa√±amiento y fortalecimiento de redes.`
    },

    {
      nombre:'Abordaje del trauma hist√≥rico y transgeneracional',
      codigo:'p_sewb_traumaHistorico',
      procesos:['RI_integracionTrauma'],
      texto:`Reconocimiento expl√≠cito del trauma hist√≥rico (colonizaci√≥n, expulsi√≥n, p√©rdida cultural) y sus efectos
transgeneracionales. Se prioriza seguridad, dignidad y estabilizaci√≥n relacional; el objetivo es re-vincular,
no re-exponer por defecto.`
    }
  ],

  // =========================================================
  // MICROINTERVENCIONES
  // =========================================================
  micros:[

    {
      nombre:'Permiso y elecci√≥n expl√≠cita',
      codigo:'m_sewb_permiso',
      procesos:['R_seguridadRelacional'],
      texto:`Antes de explorar temas sensibles, el terapeuta pide permiso y ofrece opciones (parar, cambiar tema,
invitar a un referente, usar otro formato). Devuelve control y reduce riesgo de reproducci√≥n de din√°micas
colonizadoras.`
    },

    {
      nombre:'Validaci√≥n de dignidad y contexto hist√≥rico',
      codigo:'m_sewb_dignidad',
      procesos:['RI_autocompasion'],
      texto:`Nombrar con claridad c√≥mo racismo, p√©rdida cultural o trauma hist√≥rico pueden impactar el malestar,
sin reducir a la persona a ‚Äús√≠ntomas‚Äù. Refuerza dignidad y continuidad identitaria.`
    },

    {
      nombre:'Redirecci√≥n a conexiones protectoras',
      codigo:'m_sewb_conexiones',
      procesos:['N_reencuadre'],
      texto:`Cuando el relato se centra en d√©ficit individual, reorientar a recursos y conexiones: ‚Äú¬øqui√©n est√° contigo?‚Äù,
‚Äú¬øqu√© te conecta con tu cultura/pa√≠s?‚Äù, ‚Äú¬øqu√© te ha sostenido antes?‚Äù. Cambia el eje de auto-culpa a pertenencia.`
    },

    {
      nombre:'Anclaje corporal y regulaci√≥n respetuosa',
      codigo:'m_sewb_regulacion',
      procesos:['RE_modulacion'],
      texto:`Estrategias simples de regulaci√≥n (respiraci√≥n, grounding, pausa) introducidas con sensibilidad cultural
y sin imponer ‚Äút√©cnicas‚Äù como soluci√≥n universal. Se usa para estabilizar, no para invalidar la historia.`
    },

    {
      nombre:'Cierre con continuidad y tarea realista',
      codigo:'m_sewb_cierre',
      procesos:['AG_compromisoConductual'],
      texto:`Al final de sesi√≥n: resumir desde continuidad (‚Äúlo que has sostenido‚Äù, ‚Äúlo que importa‚Äù), y acordar una
acci√≥n peque√±a de reconexi√≥n (llamar a un familiar, acudir a un servicio ind√≠gena, actividad en comunidad).`
    }
  ]
},

      
      //HUMANISTA









  

 
   



     

 


  
   
  
   

   
   
 
  

          /* ====== CONSTRUCTIVISTA (A√ëADIDO) ====== */

      /* ====== CONSTRUCTIVISTA ‚Äî TEOR√çA DE LOS CONSTRUCTOS PERSONALES (PCP) ====== */


   


      

 



   





   

      

      

    

   

     

     

          /* ====== COGNITIVO ====== */

    /* ====== COGNITIVO ====== */

    







   
  
   
 
 

  
  
  
 
     {
  id:'c1nutritional',
  grupo:'Transversal',
  label:'Psiquiatr√≠a nutricional (Nutritional Psychiatry)',
  year:'2010‚Äìactualidad',
  autores:'Felice Jacka; Jerome Sarris; Michael Berk',

  influencias:[
    'Psiquiatr√≠a basada en la evidencia',
    'Medicina del estilo de vida',
    'Psiconeuroinmunolog√≠a',
    'Modelo biopsicosocial'
  ],

  descripcion:`La psiquiatr√≠a nutricional estudia la relaci√≥n entre patrones alimentarios y salud mental, especialmente en depresi√≥n y vulnerabilidad al estr√©s. No propone ‚Äúcurar‚Äù problemas psicol√≥gicos con dieta ni reemplaza la psicoterapia: su aportaci√≥n cl√≠nica es identificar y reducir factores alimentarios que pueden amplificar fatiga, irritabilidad, niebla mental y reactividad, interfiriendo con la participaci√≥n del paciente y la estabilidad del trabajo terap√©utico. En VB, la alimentaci√≥n se formula como condici√≥n de viabilidad: reducir ruido fisiol√≥gico y estabilizar energ√≠a para que los procesos psicoterap√©uticos (RF/RE/N/RI‚Ä¶) puedan desplegarse con mayor eficacia (Sarris et al., 2015; Jacka et al., 2017).`,

  mjps:['VB'],

  refs:[
    'Jacka, F. N., O‚ÄôNeil, A., Opie, R., et al. (2017). A randomised controlled trial of dietary improvement for adults with major depression (the ‚ÄúSMILES‚Äù trial). BMC Medicine, 15(1), 23. doi:10.1186/s12916-017-0791-y.',
    'Sarris, J., Logan, A. C., Akbaraly, T. N., et al. (2015). Nutritional medicine as mainstream in psychiatry. The Lancet Psychiatry, 2(3), 271‚Äì274. doi:10.1016/S2215-0366(14)00051-0.'
  ],

  // =========================================================
  // PROCEDIMIENTOS (VB ‚Üí Alimentaci√≥n)
  // =========================================================
  procedimientos:[

    {
      nombre:'Regularidad alimentaria b√°sica',
      codigo:'p_np_regularidad',
      procesos:['VB_alimentacion'],
      texto:`Establecer una pauta m√≠nima de regularidad (horarios estables y evitar ayunos prolongados no planificados) para reducir fluctuaciones de energ√≠a, irritabilidad y dificultades atencionales que interfieren con el trabajo psicoterap√©utico. En VB, la regularidad suele ser m√°s importante que ‚Äúla dieta perfecta‚Äù: cuando el patr√≥n es ca√≥tico, el paciente puede vivir picos de activaci√≥n, hambre intensa o fatiga que contaminan la lectura cl√≠nica (parece ‚Äúresistencia‚Äù, ‚Äúapat√≠a‚Äù o ‚Äúdesregulaci√≥n emocional‚Äù cuando hay desorden basal). Este enfoque se alinea con la l√≥gica de intervenci√≥n diet√©tica estructurada usada en ensayos y revisiones de psiquiatr√≠a nutricional (Jacka et al., 2017; Sarris et al., 2015).

‚Ä¢ Objetivo cl√≠nico: estabilizar energ√≠a y disponibilidad psicol√≥gica para el proceso
‚Ä¢ Se observa: menos picos de irritabilidad, menos ‚Äúbajones‚Äù y mejor concentraci√≥n
‚Ä¢ Funciona cuando: el paciente deja de compensar con cafe√≠na/az√∫car y reporta mayor estabilidad
‚Ä¢ Error frecuente: saltar a dietas complejas antes de asegurar regularidad`,
    },

    {
      nombre:'Reducci√≥n gradual de ultraprocesados',
      codigo:'p_np_ultraprocesados',
      procesos:['VB_alimentacion'],
      texto:`Intervenci√≥n psicoeducativa y de ajuste ambiental para reducir el consumo habitual de alimentos ultraprocesados (altos en az√∫cares refinados, grasas refinadas y densidad energ√©tica baja en micronutrientes). La evidencia en psiquiatr√≠a nutricional se apoya especialmente en mejorar patrones diet√©ticos globales (m√°s ‚Äúwhole foods‚Äù) en personas con depresi√≥n, con resultados cl√≠nicos relevantes en ensayos como SMILES (Jacka et al., 2017). En VB se formula sin moralizar: no se trata de ‚Äúcomer limpio‚Äù, sino de disminuir un factor de vulnerabilidad que puede amplificar fatiga, anhedonia y reactividad al estr√©s (Sarris et al., 2015; Jacka et al., 2017).

‚Ä¢ Objetivo cl√≠nico: reducir vulnerabilidad biol√≥gica (fatiga/√°nimo) que interfiere en terapia
‚Ä¢ Se observa: menor somnolencia postprandial, menos ‚Äúcrashes‚Äù de energ√≠a, mejor √°nimo basal
‚Ä¢ Funciona cuando: el cambio es gradual y sostenible (no prohibicionista)
‚Ä¢ Error frecuente: convertirlo en control r√≠gido o culpa`,
    },

    {
      nombre:'Asegurar aporte energ√©tico suficiente',
      codigo:'p_np_energia',
      procesos:['VB_alimentacion'],
      texto:`Evaluar si el paciente est√° comiendo por debajo de sus necesidades energ√©ticas reales (p. ej., por estr√©s, depresi√≥n, turnos, autoexigencia o apat√≠a). Un d√©ficit sostenido puede generar s√≠ntomas que interfieren directamente con psicoterapia: cansancio, irritabilidad, baja motivaci√≥n, dificultades atencionales y tolerancia al malestar reducida. En VB esto se aborda como condici√≥n fisiol√≥gica (no como ‚Äúfuerza de voluntad‚Äù). En estudios y marcos de psiquiatr√≠a nutricional, el foco suele ser el patr√≥n global y su impacto funcional, no la perfecci√≥n diet√©tica; por eso, asegurar suficiencia y regularidad suele ser el primer escal√≥n cl√≠nico (Sarris et al., 2015; Jacka et al., 2017).

‚Ä¢ Objetivo cl√≠nico: evitar s√≠ntomas derivados de infranutrici√≥n funcional
‚Ä¢ Se observa: mejora de energ√≠a, atenci√≥n y estabilidad emocional basal
‚Ä¢ Funciona cuando: el paciente normaliza comer como requisito del proceso, no como premio
‚Ä¢ Error frecuente: confundir restricci√≥n con autocontrol o ‚Äúdisciplina‚Äù`,
    },

    {
      nombre:'Psicoeducaci√≥n comida‚Äìestado de √°nimo',
      codigo:'p_np_psicoeducacion',
      procesos:['VB_alimentacion'],
      texto:`Explicaci√≥n breve, clara y no alarmista de la relaci√≥n entre patr√≥n alimentario y salud mental: estabilidad energ√©tica, micronutrici√≥n, inflamaci√≥n y h√°bitos. El objetivo no es medicalizar ni ‚Äúpsicologizar‚Äù la comida, sino dar un marco funcional para entender por qu√© ciertos patrones alimentarios pueden amplificar malestar o dificultar regulaci√≥n emocional. En VB, esto suele mejorar adherencia y reduce atribuciones err√≥neas (‚Äúsoy d√©bil‚Äù, ‚Äúno sirvo para la terapia‚Äù). La literatura de psiquiatr√≠a nutricional insiste en integrar estas consideraciones de forma realista y como complemento del tratamiento, no como sustituto (Sarris et al., 2015; Jacka et al., 2017).

‚Ä¢ Objetivo cl√≠nico: aumentar comprensi√≥n funcional sin generar obsesi√≥n
‚Ä¢ Se observa: decisiones m√°s consistentes y menos culpa
‚Ä¢ Funciona cuando: se adapta al lenguaje del paciente y al contexto socioecon√≥mico
‚Ä¢ Error frecuente: sobrecargar con tecnicismos o mensajes ‚Äúsaludistas‚Äù`,
    }

  ],

  // =========================================================
  // MICROINTERVENCIONES (VB ‚Üí Alimentaci√≥n)
  // =========================================================
  micros:[

    {
      nombre:'Evitar ayunos prolongados no intencionados',
      codigo:'m_np_ayuno',
      procesos:['VB_alimentacion'],
      texto:`Detectar y corregir periodos largos sin ingesta que el paciente normaliza (‚Äúse me pasa comer‚Äù). Estos ayunos suelen asociarse a irritabilidad, mareo, ansiedad som√°tica y dificultades atencionales que luego se interpretan psicol√≥gicamente. En VB se formula como reducci√≥n de ruido corporal para mejorar la lectura cl√≠nica y la capacidad de autorregulaci√≥n durante el d√≠a. En el marco de intervenciones diet√©ticas para depresi√≥n, la regularidad y estructura del patr√≥n son componentes habituales del cambio de h√°bitos (Jacka et al., 2017; Sarris et al., 2015).

‚Ä¢ Objetivo cl√≠nico: prevenir desregulaci√≥n por hambre/hipoglucemia funcional
‚Ä¢ Se observa: menos ansiedad som√°tica y reactividad
‚Ä¢ Funciona cuando: se pactan soluciones simples (planificaci√≥n m√≠nima)
‚Ä¢ Error frecuente: ignorarlo por ‚Äúno ser un TCA‚Äù`,
    },

    {
      nombre:'No sustituir comida por estimulantes',
      codigo:'m_np_estimulantes',
      procesos:['VB_alimentacion'],
      texto:`Explorar el uso de caf√©, bebidas energ√©ticas o nicotina como sustituto de comida o como compensaci√≥n de cansancio cr√≥nico. Este patr√≥n puede sostener el d√≠a a costa de aumentar ansiedad, alterar apetito y empeorar el descanso, generando un bucle VB (fatiga‚Äìestimulante‚Äìpeor sue√±o‚Äìpeor energ√≠a). En psiquiatr√≠a nutricional se enfatiza la coherencia del estilo de vida y el patr√≥n global (no ‚Äúsolo dieta‚Äù), por lo que ajustar estos h√°bitos tiene sentido como soporte basal del tratamiento (Sarris et al., 2015).

‚Ä¢ Objetivo cl√≠nico: reducir ciclos de activaci√≥n artificial que empeoran regulaci√≥n
‚Ä¢ Se observa: menos ansiedad y mejor descanso
‚Ä¢ Funciona cuando: se ofrece alternativa realista (hidrataci√≥n, snack planificado, pausa)
‚Ä¢ Error frecuente: retirada brusca sin plan y sin entender la funci√≥n`,
    },

    {
      nombre:'Estructura m√≠nima de comidas',
      codigo:'m_np_estructura',
      procesos:['VB_alimentacion'],
      texto:`Introducir una estructura m√≠nima (p. ej., tres momentos b√°sicos de ingesta) sin entrar en control cal√≥rico ni rigidez diet√©tica. La estructura reduce caos fisiol√≥gico y fatiga decisional, especialmente en depresi√≥n o estr√©s cr√≥nico, y facilita adherencia. En VB, estructura ‚â† control: es soporte para poder pensar y regularse mejor. Los ensayos diet√©ticos en depresi√≥n suelen incluir componentes de planificaci√≥n y adherencia realista, no perfeccionismo (Jacka et al., 2017).

‚Ä¢ Objetivo cl√≠nico: reducir caos y facilitar consistencia
‚Ä¢ Se observa: energ√≠a m√°s estable y menos ‚Äúatracones‚Äù por desorganizaci√≥n
‚Ä¢ Funciona cuando: se adapta a vida real y recursos del paciente
‚Ä¢ Error frecuente: convertirlo en norma r√≠gida`,
    },

    {
      nombre:'Diferenciar hambre fisiol√≥gica de hambre emocional',
      codigo:'m_np_diferenciacion',
      procesos:['VB_alimentacion'],
      texto:`Psicoeducaci√≥n b√°sica para distinguir se√±ales corporales de hambre real de la b√∫squeda de regulaci√≥n emocional mediante comida. En VB no se aborda el significado profundo del comer (eso pertenece a otros procesos), sino evitar confusiones que empujan a restricci√≥n, culpa o desorganizaci√≥n. La psiquiatr√≠a nutricional se centra en patr√≥n y funcionamiento; esta diferenciaci√≥n ayuda a mantener el foco funcional sin moralizar (Sarris et al., 2015).

‚Ä¢ Objetivo cl√≠nico: reducir confusi√≥n cuerpo‚Äìemoci√≥n sin psicologizar de m√°s
‚Ä¢ Se observa: menos culpa y mayor claridad en decisiones b√°sicas
‚Ä¢ Funciona cuando: se explica con neutralidad (‚Äúfunci√≥n‚Äù, no ‚Äúfallo‚Äù)
‚Ä¢ Error frecuente: interpretar todo comer emocional como ‚Äúproblema de fondo‚Äù`,
    }

  ]
},





{
  id:'c1ttm',
  grupo:'Transversal',
  label:'Modelo Transte√≥rico del Cambio (TTM)',
  year:'1983‚Äìactualidad',
  autores:'James O. Prochaska; Carlo C. DiClemente',

  influencias:[
    'Psicolog√≠a del cambio conductual',
    'Motivational Interviewing',
    'Modelo biopsicosocial',
    'Prevenci√≥n de reca√≠das'
  ],

  descripcion:`El Modelo Transte√≥rico del Cambio (TTM) es un modelo transversal que describe c√≥mo las personas modifican conductas relevantes para su salud y funcionamiento psicol√≥gico. Propone que el cambio no ocurre de forma lineal ni por simple insight, sino a trav√©s de estadios reconocibles (precontemplaci√≥n, contemplaci√≥n, preparaci√≥n, acci√≥n, mantenimiento y reca√≠da/reciclaje), movilizados por procesos de cambio espec√≠ficos.

El TTM se aplica a una amplia gama de conductas: consumo de sustancias, adherencia terap√©utica, h√°bitos de sue√±o, ejercicio, alimentaci√≥n, autocuidado y cumplimiento de acuerdos cl√≠nicos. En psicoterapia, el modelo permite ajustar la intervenci√≥n al momento real del paciente, evitando exigir acciones para las que a√∫n no hay decisi√≥n ni recursos, y protegiendo la alianza mediante un encuadre realista del cambio.

En tu arquitectura, el TTM act√∫a como modelo meta‚Äìdecisional: organiza cu√°ndo profundizar, cu√°ndo estabilizar condiciones basales (VB) y cu√°ndo trabajar motivaci√≥n, compromiso o prevenci√≥n de reca√≠das.`,

  mjps:['VB','N','AG','RE','RF','R'],

  refs:[
    // N√∫cleo TTM
    'Prochaska, J. O., & DiClemente, C. C. (1983). Stages and processes of self-change of smoking. Journal of Consulting and Clinical Psychology.',
    'Prochaska, J. O., & DiClemente, C. C. (1992). Stages of change in the modification of problem behaviors. Progress in Behavior Modification.',
    'Prochaska, J. O., Norcross, J. C., & DiClemente, C. C. (1994). Changing for Good. William Morrow.',
    'DiClemente, C. C. (2003). Addiction and Change. Guilford Press.',
    // Integraci√≥n habitual con MI y reca√≠das
    'Miller, W. R., & Rollnick, S. (2013). Motivational Interviewing (3rd ed.). Guilford Press.',
    'Marlatt, G. A., & Gordon, J. R. (1985). Relapse Prevention. Guilford Press.',
    // T√©cnicas transversales √∫tiles en TTM/VB
    'Gollwitzer, P. M. (1999). Implementation intentions. American Psychologist.',
    'Kazdin, A. E. (2001). Behavior Modification in Applied Settings (6th ed.). Waveland Press.'
  ],

  // =========================================================
  // PROCEDIMIENTOS (TRANSVERSALES) ‚Äî con refs por t√©cnica
  // =========================================================
  procedimientos:[

    {
      nombre:'Ubicar estadio de cambio',
      codigo:'p_ttm_estadio',
      procesos:['N_metacognicion','AG_tomaDecisiones'],
      texto:`Identificar el estadio de cambio respecto a una conducta concreta (precontemplaci√≥n, contemplaci√≥n, preparaci√≥n, acci√≥n, mantenimiento o reca√≠da). Evita intervenciones desajustadas y protege la alianza al respetar el momento real del paciente.

‚Ä¢ Objetivo cl√≠nico: alinear intervenci√≥n y expectativas con el estadio
‚Ä¢ Se observa: menos confrontaci√≥n improductiva
‚Ä¢ Funciona cuando: el estadio se revisa peri√≥dicamente
‚Ä¢ Error frecuente: asumir ‚Äúmotivaci√≥n‚Äù donde hay ambivalencia`,
      refs:[
        'Prochaska & DiClemente (1983).',
        'Prochaska & DiClemente (1992).',
        'Prochaska, Norcross, & DiClemente (1994).',
        'DiClemente (2003).'
      ]
    },

    {
      nombre:'Psychoeducaci√≥n de estadios y normalizaci√≥n del ‚Äúreciclaje‚Äù',
      codigo:'p_ttm_psicoeducacion_estadios',
      procesos:['N_reformulacion','R_acuerdoTerapia'],
      texto:`Explicar al paciente la l√≥gica de estadios (incluida reca√≠da/reciclaje) como mapa pr√°ctico. Reduce verg√ºenza, aumenta colaboraci√≥n y permite acordar objetivos realistas sin forzar acci√≥n prematura.`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'DiClemente (2003).'
      ]
    },

    {
      nombre:'Activar procesos de cambio adecuados al estadio',
      codigo:'p_ttm_procesosCambio',
      procesos:['N_reformulacion','RE_modulacion','R_coregulacion','AG_compromisoConductual'],
      texto:`Seleccionar procesos de cambio seg√∫n el estadio: aumentar conciencia y reevaluaci√≥n en estadios tempranos; compromiso, sustituci√≥n conductual y control de est√≠mulos en acci√≥n; refuerzo y prevenci√≥n de reca√≠das en mantenimiento. Aporta una l√≥gica clara de ‚Äúqu√© toca ahora‚Äù.`,
      refs:[
        'Prochaska & DiClemente (1983).',
        'Prochaska & DiClemente (1992).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    },

    {
      nombre:'Balance decisional (pros y contras)',
      codigo:'p_ttm_balance',
      procesos:['N_metacognicion','AG_tomaDecisiones'],
      texto:`Explorar beneficios y costes de mantener la conducta y de cambiarla. Hace visible la ambivalencia y facilita una decisi√≥n apropiada del paciente, no inducida por presi√≥n externa.`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'DiClemente (2003).',
        'Miller & Rollnick (2013).'
      ]
    },

    {
      nombre:'Elicitar ‚Äúchange talk‚Äù y resolver ambivalencia (integraci√≥n MI)',
      codigo:'p_ttm_mi_changeTalk',
      procesos:['AG_tomaDecisiones','R_coregulacion','N_reformulacion'],
      texto:`Usar preguntas evocadoras, reflejo y res√∫menes estrat√©gicos para aumentar lenguaje de cambio y disminuir lenguaje de mantenimiento. Especialmente √∫til en contemplaci√≥n/preparaci√≥n.`,
      refs:[
        'Miller & Rollnick (2013).',
        'DiClemente (2003).'
      ]
    },

    {
      nombre:'Regla de ‚Äúmeta m√≠nima‚Äù y escalado de objetivos',
      codigo:'p_ttm_meta_minima',
      procesos:['AG_compromisoConductual','RE_modulacion'],
      texto:`Definir una meta m√≠nima viable (MMV) en preparaci√≥n: lo suficientemente peque√±a para ser cumplible, pero cl√≠nicamente significativa. Se escala tras evidencia de cumplimiento (acci√≥n ‚Üí mantenimiento).`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'Kazdin (2001).'
      ]
    },

    {
      nombre:'Contratos de cambio y auto-liberaci√≥n (compromiso expl√≠cito)',
      codigo:'p_ttm_contrato_cambio',
      procesos:['AG_compromisoConductual','R_acuerdoTerapia'],
      texto:`Formalizar compromiso: qu√© se cambia, desde cu√°ndo, con qu√© apoyos y qu√© se har√° ante tentaci√≥n. Refuerza ‚Äúself-liberation‚Äù (decisi√≥n activa) y reduce el ‚Äúya ver√©‚Äù.`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'DiClemente (2003).'
      ]
    },

    {
      nombre:'Autoobservaci√≥n y registro breve (self-monitoring)',
      codigo:'p_ttm_registro',
      procesos:['N_metacognicion','AG_autoriaResponsabilidad'],
      texto:`Registro simple de episodios (antecedentes, emoci√≥n, conducta, consecuencia). Aumenta conciencia, detecta patrones y ofrece datos para decisiones realistas (especialmente en VB).`,
      refs:[
        'Kazdin (2001).',
        'DiClemente (2003).'
      ]
    },

    {
      nombre:'Control de est√≠mulos (dise√±o del entorno)',
      codigo:'p_ttm_control_estimulos',
      procesos:['AG_compromisoConductual','VB_sustancias','VB_sueno'],
      texto:`Modificar se√±ales ambientales que disparan la conducta (sustancias, pantallas, horarios, lugares, compa√±√≠as). Es un puente directo de preparaci√≥n‚Üíacci√≥n y reduce carga de ‚Äúfuerza de voluntad‚Äù.`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'Kazdin (2001).'
      ]
    },

    {
      nombre:'Manejo de reforzadores (refuerzo y recompensas)',
      codigo:'p_ttm_refuerzo',
      procesos:['AG_compromisoConductual','RE_modulacion'],
      texto:`Planificar refuerzos inmediatos por conducta objetivo (o por abstinencia/reducci√≥n) y retirar refuerzos inadvertidos de la conducta problema. √ötil en acci√≥n/mantenimiento.`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'Kazdin (2001).'
      ]
    },

    {
      nombre:'Implementaci√≥n ‚Äúsi‚Äìentonces‚Äù (intenciones de implementaci√≥n)',
      codigo:'p_ttm_si_entonces',
      procesos:['AG_compromisoConductual','RE_modulacion'],
      texto:`Convertir intenci√≥n en plan ejecutable: ‚ÄúSi ocurre X (disparador), entonces har√© Y (respuesta alternativa)‚Äù. Reduce la brecha entre decisi√≥n y acci√≥n.`,
      refs:[
        'Gollwitzer (1999).'
      ]
    },

    {
      nombre:'Entrenar autoeficacia y manejar tentaci√≥n',
      codigo:'p_ttm_autoeficacia',
      procesos:['RE_modulacion','AG_autoriaResponsabilidad'],
      texto:`Fortalecer capacidad percibida para sostener el cambio y anticipar situaciones de tentaci√≥n/reca√≠da. Incluye respuestas alternativas, apoyos y planes de contingencia.`,
      refs:[
        'DiClemente (2003).',
        'Marlatt & Gordon (1985).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    },

    {
      nombre:'Prevenci√≥n de reca√≠das y reciclaje',
      codigo:'p_ttm_recaidas',
      procesos:['N_metacognicion','RE_modulacion','RF_crisis','AG_tomaDecisiones'],
      texto:`Entender la reca√≠da como parte del proceso, no como fracaso. Analizar vulnerabilidades, disparadores y ‚Äúdecisiones aparentemente irrelevantes‚Äù, ajustando plan y estadio.`,
      refs:[
        'Marlatt & Gordon (1985).',
        'DiClemente (2003).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    },

    {
      nombre:'Activar apoyo social (helping relationships)',
      codigo:'p_ttm_apoyo_social',
      procesos:['R_coregulacion','AG_compromisoConductual'],
      texto:`Dise√±ar red de apoyo realista (una persona concreta + un contexto concreto + una conducta concreta). Reduce reca√≠da, aumenta adherencia y sostiene mantenimiento.`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'DiClemente (2003).'
      ]
    }

  ],

  // =========================================================
  // MICROS ‚Äî APLICACI√ìN A VB (DESARROLLO EXTENDIDO) con refs
  // =========================================================
  micros:[

    // ---------- VB general ----------
    {
      nombre:'Evaluar estadio por conducta VB (no ‚Äúmotivaci√≥n general‚Äù)',
      codigo:'m_ttm_vb_estadio',
      procesos:['VB_sueno','VB_alimentacion','VB_movimiento','VB_sustancias','N_metacognicion'],
      texto:`Evaluaci√≥n espec√≠fica del estadio aplicado a cada condici√≥n basal relevante. Permite intervenciones finas: acci√≥n en sue√±o, contemplaci√≥n en alcohol, precontemplaci√≥n en cannabis, etc.`,
      refs:[
        'Prochaska & DiClemente (1992).',
        'Prochaska, Norcross, & DiClemente (1994).',
        'DiClemente (2003).'
      ]
    },

    {
      nombre:'VB ‚Äî Meta m√≠nima viable (MMV) como criterio de ‚Äúviabilidad terap√©utica‚Äù',
      codigo:'m_ttm_vb_mmv',
      procesos:['VB_sueno','VB_sustancias','AG_compromisoConductual','R_acuerdoTerapia'],
      texto:`Definir una MMV que no sea ‚Äúvida ideal‚Äù, sino m√≠nimo suficiente para que la terapia funcione: sue√±o suficiente para no estar disociado/irritable, reducci√≥n o no consumo para poder mentalizar, etc.`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'Kazdin (2001).',
        'DiClemente (2003).'
      ]
    },

    // ---------- VB: sustancias (m√°s completo) ----------
    {
      nombre:'VB ‚Äì Sustancias: conciencia funcional sin confrontaci√≥n (precontemplaci√≥n)',
      codigo:'m_ttm_vb_sustancias_conciencia',
      procesos:['VB_sustancias','N_reformulacion','RE_modulacion'],
      texto:`Conciencia basada en funcionamiento: efectos en sue√±o, regulaci√≥n, memoria, impulsividad, adherencia y capacidad reflexiva. Sin moralizar ni discutir etiquetas diagn√≥sticas.`,
      refs:[
        'DiClemente (2003).',
        'Prochaska, Norcross, & DiClemente (1994).',
        'Miller & Rollnick (2013).'
      ]
    },

    {
      nombre:'VB ‚Äì Sustancias: feedback de patr√≥n (registro breve + mapa de disparadores)',
      codigo:'m_ttm_vb_sustancias_registro',
      procesos:['VB_sustancias','N_metacognicion','AG_autoriaResponsabilidad'],
      texto:`Registrar episodios (disparadores, emoci√≥n, contexto, consecuencia) para convertir el ‚Äúconsumo‚Äù en patr√≥n observable. Base para decisiones realistas y para prevenci√≥n de reca√≠das.`,
      refs:[
        'Kazdin (2001).',
        'DiClemente (2003).',
        'Marlatt & Gordon (1985).'
      ]
    },

    {
      nombre:'VB ‚Äì Sustancias: ambivalencia y balance decisional (con ganancias del consumo)',
      codigo:'m_ttm_vb_sustancias_balance',
      procesos:['VB_sustancias','N_metacognicion','AG_tomaDecisiones'],
      texto:`Balance pros/contras incorporando beneficios percibidos (alivio, pertenencia, anestesia emocional) y costes cl√≠nicos (bloqueo emocional, inestabilidad, reca√≠das sintom√°ticas).`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'DiClemente (2003).',
        'Miller & Rollnick (2013).'
      ]
    },

    {
      nombre:'VB ‚Äì Sustancias: ‚Äúsi‚Äìentonces‚Äù para momentos de riesgo',
      codigo:'m_ttm_vb_sustancias_si_entonces',
      procesos:['VB_sustancias','AG_compromisoConductual','RE_modulacion'],
      texto:`Plan espec√≠fico: ‚ÄúSi aparece X (ansiedad, fin de semana, llamada de tal persona), entonces har√© Y (conducta alternativa + apoyo)‚Äù. Reduce reca√≠da impulsiva.`,
      refs:[
        'Gollwitzer (1999).',
        'Marlatt & Gordon (1985).'
      ]
    },

    {
      nombre:'VB ‚Äì Sustancias: control de est√≠mulos (entorno y compa√±√≠a)',
      codigo:'m_ttm_vb_sustancias_estimulos',
      procesos:['VB_sustancias','AG_compromisoConductual'],
      texto:`Modificar se√±ales: lugares, rutinas, acceso, dinero, compa√±√≠a, horarios. Reduce tentaci√≥n sin exigir control interno m√°ximo desde el d√≠a 1.`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'Kazdin (2001).',
        'DiClemente (2003).'
      ]
    },

    {
      nombre:'VB ‚Äì Sustancias: reducci√≥n de da√±o como puente (preparaci√≥n‚Üíacci√≥n)',
      codigo:'m_ttm_vb_sustancias_reduccion',
      procesos:['VB_sustancias','AG_compromisoConductual','RE_modulacion'],
      texto:`Cuando abstinencia no es viable: reducir dosis/frecuencia/contextos de riesgo y evitar combinaciones peligrosas. Se define como avance (no como ‚Äúfracaso moral‚Äù).`,
      refs:[
        'DiClemente (2003).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    },

    {
      nombre:'VB ‚Äì Sustancias: no consumo como condici√≥n funcional de la terapia',
      codigo:'m_ttm_vb_sustancias_noConsumo',
      procesos:['VB_sustancias','AG_compromisoConductual','R_acuerdoTerapia'],
      texto:`Cuando el consumo bloquea procesos nucleares (regulaci√≥n, mentalizaci√≥n, adherencia), se formula el no consumo como condici√≥n terap√©utica funcional, negociada y expl√≠cita.`,
      refs:[
        'DiClemente (2003).',
        'Miller & Rollnick (2013).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    },

    {
      nombre:'VB ‚Äì Sustancias: manejo de reforzadores (sustituir refuerzos)',
      codigo:'m_ttm_vb_sustancias_refuerzo',
      procesos:['VB_sustancias','AG_compromisoConductual','RE_modulacion'],
      texto:`Sustituir el refuerzo del consumo por refuerzos alternativos inmediatos (placer, conexi√≥n, calma) y planificar recompensas por pasos de cambio. Evita depender solo de motivaci√≥n.`,
      refs:[
        'Kazdin (2001).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    },

    {
      nombre:'VB ‚Äì Sustancias: reca√≠da/reciclaje sin ruptura (an√°lisis + ajuste de plan)',
      codigo:'m_ttm_vb_sustancias_recaida',
      procesos:['VB_sustancias','N_metacognicion','RF_crisis','AG_tomaDecisiones'],
      texto:`Reca√≠da como informaci√≥n: disparadores, vulnerabilidades y decisiones previas. Se ajusta el plan y el estadio sin castigo ni banalizaci√≥n, cuidando continuidad y alianza.`,
      refs:[
        'Marlatt & Gordon (1985).',
        'DiClemente (2003).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    },

    {
      nombre:'VB ‚Äì Sustancias: consolidaci√≥n identitaria (mantenimiento profundo)',
      codigo:'m_ttm_vb_sustancias_narrativa',
      procesos:['VB_sustancias','N_identidad','R_coregulacion'],
      texto:`Integrar el cambio en identidad narrativa: qui√©n soy sin consumir, qu√© regula ahora, qu√© valores sostienen el cambio. Disminuye el ‚Äúcontrol forzado‚Äù y sostiene mantenimiento.`,
      refs:[
        'DiClemente (2003).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    },

    // ---------- VB: sue√±o / alimentaci√≥n / movimiento (m√≠nimo √∫til) ----------
    {
      nombre:'VB ‚Äì Sue√±o: estadio + dise√±o de entorno (pantallas, horarios, activaci√≥n)',
      codigo:'m_ttm_vb_sueno_estimulos',
      procesos:['VB_sueno','AG_compromisoConductual','RE_modulacion'],
      texto:`Aplicar estadio al sue√±o y usar control de est√≠mulos (horario, luz, pantallas, rutina) con metas m√≠nimas viables antes de pedir trabajo emocional profundo.`,
      refs:[
        'Prochaska, Norcross, & DiClemente (1994).',
        'Kazdin (2001).'
      ]
    },

    {
      nombre:'VB ‚Äì Movimiento: intenci√≥n‚Üíplan ‚Äúsi‚Äìentonces‚Äù + refuerzo',
      codigo:'m_ttm_vb_movimiento_plan',
      procesos:['VB_movimiento','AG_compromisoConductual','RE_modulacion'],
      texto:`Convertir ‚Äútengo que moverme‚Äù en plan ejecutable (si‚Äìentonces) y reforzar cumplimiento. Ideal en preparaci√≥n/acci√≥n para aumentar autoeficacia.`,
      refs:[
        'Gollwitzer (1999).',
        'Kazdin (2001).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    },

    {
      nombre:'VB ‚Äì Alimentaci√≥n: registro breve + metas m√≠nimas (sin perfeccionismo)',
      codigo:'m_ttm_vb_alimentacion_registro',
      procesos:['VB_alimentacion','N_metacognicion','AG_compromisoConductual'],
      texto:`Registro m√≠nimo (patr√≥n real) + meta m√≠nima viable para estabilizar energ√≠a/irritabilidad. Se evita exigir ‚Äúdieta ideal‚Äù al inicio del proceso.`,
      refs:[
        'Kazdin (2001).',
        'Prochaska, Norcross, & DiClemente (1994).'
      ]
    }

  ]
},

{
  id:'c1smcv',
  grupo:'Transversal',
  label:'Modelo de Estabilizaci√≥n del Entorno Vital',
  year:'1990‚Äìactualidad',
  autores:'Judith Herman; desarrollos en trauma-informed care y salud mental comunitaria',

  influencias:[
    'Trauma-informed care',
    'Case management cl√≠nico',
    'Modelo biopsicosocial',
    'Psicoterapia contextual',
    'Prevenci√≥n de reca√≠das (contexto)'
  ],

  descripcion:`El Modelo de Estabilizaci√≥n del Entorno Vital sostiene que la psicoterapia solo puede desplegar procesos profundos de cambio cuando existe un umbral m√≠nimo de estabilidad externa. En contextos de amenaza persistente ‚Äîviolencia, precariedad extrema, inestabilidad habitacional, crisis econ√≥micas repetidas o ausencia total de red‚Äî el sistema psicol√≥gico del paciente permanece orientado a la supervivencia inmediata. En estas condiciones, la terapia tiende a convertirse en una intervenci√≥n reactiva y de contenci√≥n, con escasa capacidad para promover simbolizaci√≥n, elaboraci√≥n emocional o reorganizaci√≥n narrativa sostenida (Herman, 1992; SAMHSA, 2014).

El objetivo del modelo no es ‚Äúmejorar la vida‚Äù ni alcanzar bienestar subjetivo, sino establecer una Estabilidad M√≠nima Suficiente (EMS): un conjunto acotado de condiciones externas que permita continuidad terap√©utica, reducci√≥n de amenazas inmediatas y un m√≠nimo de previsibilidad cotidiana. Esta EMS no se define en t√©rminos ideales ni estructurales, sino como un umbral funcional que haga posible la regulaci√≥n emocional, el compromiso con tareas terap√©uticas y la toma de decisiones no reactivas (Herman, 2015; Rapp & Goscha, 2012).

Dentro de la arquitectura MJPS, este modelo fundamenta el subproceso VB_entorno como condici√≥n de viabilidad cl√≠nica. VB_entorno no es un objetivo terap√©utico en s√≠ mismo, sino un criterio de decisi√≥n que orienta cu√°ndo es cl√≠nicamente responsable profundizar y cu√°ndo conviene estabilizar, coordinar apoyos y reducir demandas. Su funci√≥n principal es proteger tanto al paciente como al proceso terap√©utico de intervenciones prematuras que aumenten desorganizaci√≥n, riesgo de abandono o retraumatizaci√≥n (Herman, 1992; SAMHSA, 2014).`,

  mjps:['VB','RE','AG','R','RF'],

  refs:[
    'Herman, J. L. (1992). Trauma and Recovery. Basic Books.',
    'Herman, J. L. (2015). Trauma and Recovery (2nd ed.). Basic Books.',
    'SAMHSA (2014). Trauma-Informed Care in Behavioral Health Services.',
    'Rapp, C. A., & Goscha, R. J. (2012). The Strengths Model. Oxford University Press.',
    'Marlatt, G. A., & Gordon, J. R. (1985). Relapse Prevention. Guilford Press.'
  ],

  // =========================================================
  // PROCEDIMIENTOS (TRANSVERSALES)
  // =========================================================
  procedimientos:[

    {
      nombre:'Evaluar VB_entorno (umbral de estabilidad)',
      codigo:'p_vb_entorno_evaluacion',
      procesos:['VB_entorno','N_metacognicion'],
      texto:`Procedimiento de evaluaci√≥n sistem√°tica del entorno vital que analiza hasta qu√© punto las condiciones externas interfieren con la regulaci√≥n, la continuidad y la capacidad de aprovechamiento de la psicoterapia. Se exploran de forma expl√≠cita la seguridad f√≠sica, la estabilidad habitacional, los ingresos m√≠nimos, la disponibilidad de red de apoyo y las demandas externas que colapsan la asistencia o la atenci√≥n psicol√≥gica. Esta evaluaci√≥n permite decidir si el contexto permite profundizaci√≥n o si la terapia debe orientarse temporalmente a estabilizaci√≥n y contenci√≥n funcional (Herman, 1992; SAMHSA, 2014).`,
      refs:[
        'Herman, J. L. (1992).',
        'SAMHSA (2014).'
      ]
    },

    {
      nombre:'Definir Estabilidad M√≠nima Suficiente (EMS) y acordarla',
      codigo:'p_vb_entorno_ems',
      procesos:['VB_entorno','AG_tomaDecisiones','R_acuerdoTerapia'],
      texto:`Intervenci√≥n colaborativa orientada a definir qu√© condiciones m√≠nimas deben cumplirse para que la terapia sea viable y √∫til en el momento actual. La EMS se formula como un umbral funcional ‚Äîno como un ideal vital‚Äî que puede incluir techo temporal, reducci√≥n de amenazas activas, previsibilidad m√≠nima de horarios o un plan b√°sico de apoyo. Acordarla expl√≠citamente reduce frustraci√≥n, clarifica prioridades y transforma l√≠mites contextuales en criterios cl√≠nicos compartidos (Herman, 2015; Rapp & Goscha, 2012).`,
      refs:[
        'Herman, J. L. (2015).',
        'Rapp, C. A., & Goscha, R. J. (2012).'
      ]
    },

    {
      nombre:'Triage cl√≠nico: estabilizaci√≥n antes que profundizaci√≥n',
      codigo:'p_vb_entorno_triage',
      procesos:['VB_entorno','AG_tomaDecisiones','RF_crisis'],
      texto:`Procedimiento decisional mediante el cual el terapeuta modula expl√≠citamente el tipo de intervenci√≥n seg√∫n el nivel de estabilidad del entorno. Cuando la EMS no est√° garantizada, se priorizan contenci√≥n, orientaci√≥n pr√°ctica y regulaci√≥n, y se posponen t√©cnicas de alta activaci√≥n emocional o exploraci√≥n identitaria. Este triage protege al paciente de crisis inducidas por la terapia y preserva la alianza terap√©utica en contextos de vulnerabilidad elevada (Herman, 1992; SAMHSA, 2014).`,
      refs:[
        'Herman, J. L. (1992).',
        'SAMHSA (2014).'
      ]
    },

    {
      nombre:'Activar apoyos y coordinar recursos',
      codigo:'p_vb_entorno_recursos',
      procesos:['VB_entorno','R_coregulacion','AG_compromisoConductual'],
      texto:`Intervenci√≥n orientada a identificar, activar y coordinar apoyos externos ‚Äîformales e informales‚Äî que incrementen la estabilidad del entorno sin convertir al terapeuta en gestor omnipotente. El foco est√° en acompa√±ar al paciente en la activaci√≥n de recursos reales, distribuyendo la carga y reduciendo el aislamiento, mientras se preserva el rol cl√≠nico y la autonom√≠a del sistema de apoyo (Rapp & Goscha, 2012; SAMHSA, 2014).`,
      refs:[
        'Rapp, C. A., & Goscha, R. J. (2012).',
        'SAMHSA (2014).'
      ]
    },

    {
      nombre:'Plan ‚Äúsi‚Äìentonces‚Äù para crisis de entorno',
      codigo:'p_vb_entorno_si_entonces',
      procesos:['VB_entorno','AG_compromisoConductual','RE_modulacion'],
      texto:`Procedimiento de planificaci√≥n anticipatoria que traduce riesgos contextuales previsibles en respuestas concretas y ejecutables. Formular planes breves del tipo ‚Äúsi ocurre X, entonces har√© Y‚Äù reduce la par√°lisis, limita la impulsividad y aumenta la percepci√≥n de control en contextos ca√≥ticos. Esta l√≥gica conecta estabilizaci√≥n del entorno con prevenci√≥n de reca√≠das y autorregulaci√≥n conductual (SAMHSA, 2014; Marlatt & Gordon, 1985).`,
      refs:[
        'SAMHSA (2014).',
        'Marlatt, G. A., & Gordon, J. R. (1985).'
      ]
    },

    {
      nombre:'Revisi√≥n peri√≥dica de VB_entorno',
      codigo:'p_vb_entorno_reevaluacion',
      procesos:['VB_entorno','N_metacognicion','AG_tomaDecisiones'],
      texto:`Procedimiento de seguimiento que reconoce que la estabilidad del entorno es din√°mica y fluctuante. Revisar peri√≥dicamente la EMS permite ajustar ritmo, objetivos y foco terap√©utico al momento real del paciente, evitando rupturas del proceso por supuestos impl√≠citos de estabilidad que ya no se sostienen (Herman, 2015; SAMHSA, 2014).`,
      refs:[
        'Herman, J. L. (2015).',
        'SAMHSA (2014).'
      ]
    }

  ],

  // =========================================================
  // MICROS ‚Äî VB_entorno
  // =========================================================
  micros:[

    {
      nombre:'Mapa r√°pido de estabilidad del entorno (5 dominios)',
      codigo:'m_vb_entorno_mapa5',
      procesos:['VB_entorno','N_metacognicion'],
      texto:`Microintervenci√≥n de cribado que eval√∫a de forma r√°pida y repetible cinco dominios clave del entorno vital: seguridad, vivienda, ingresos, red de apoyo y previsibilidad de rutina. Funciona como ‚Äúsem√°foro cl√≠nico‚Äù para decidir exigencia terap√©utica y foco del trabajo en cada momento (SAMHSA, 2014; Herman, 1992).`,
      refs:[
        'SAMHSA (2014).',
        'Herman, J. L. (1992).'
      ]
    },

    {
      nombre:'Reducir demanda terap√©utica cuando EMS no se cumple',
      codigo:'m_vb_entorno_bajarDemanda',
      procesos:['VB_entorno','R_acuerdoTerapia'],
      texto:`Ajuste microestrat√©gico que reduce tareas, exposici√≥n emocional y objetivos cuando el entorno no sostiene el proceso. Comunicado adecuadamente, no se vive como retroceso, sino como una decisi√≥n cl√≠nica protectora que preserva la alianza y previene desorganizaci√≥n (Herman, 2015; SAMHSA, 2014).`,
      refs:[
        'Herman, J. L. (2015).',
        'SAMHSA (2014).'
      ]
    },

    {
      nombre:'Microestabilidades',
      codigo:'m_vb_entorno_microestabilidades',
      procesos:['VB_entorno','AG_compromisoConductual'],
      texto:`Creaci√≥n deliberada de peque√±as islas de predictibilidad ‚Äîhorarios fijos, lugares seguros, rutinas m√≠nimas o apoyos concretos‚Äî que no resuelven el entorno, pero reducen suficiente desorganizaci√≥n como para sostener el trabajo terap√©utico (Rapp & Goscha, 2012; SAMHSA, 2014).`,
      refs:[
        'Rapp, C. A., & Goscha, R. J. (2012).',
        'SAMHSA (2014).'
      ]
    },

    {
      nombre:'Control de est√≠mulos del entorno',
      codigo:'m_vb_entorno_controlEstimulos',
      procesos:['VB_entorno','AG_compromisoConductual','RE_modulacion'],
      texto:`Microintervenci√≥n orientada a reducir la exposici√≥n a contextos, personas o situaciones que disparan crisis, consumo o desregulaci√≥n intensa. Se implementa mediante cambios peque√±os y acumulativos, conectando estabilidad contextual con autorregulaci√≥n emocional y prevenci√≥n de reca√≠das (Marlatt & Gordon, 1985; SAMHSA, 2014).`,
      refs:[
        'Marlatt, G. A., & Gordon, J. R. (1985).',
        'SAMHSA (2014).'
      ]
    },

    {
      nombre:'Plan de continuidad terap√©utica en caos',
      codigo:'m_vb_entorno_continuidad',
      procesos:['VB_entorno','AG_compromisoConductual','R_acuerdoTerapia'],
      texto:`Definici√≥n expl√≠cita de c√≥mo se sostendr√° la terapia cuando el entorno se desorganice: m√≠nimos de asistencia, prioridades de sesi√≥n y criterios de pausa. Protege la alianza y evita abandonos derivados de expectativas impl√≠citas irreales (Herman, 1992; SAMHSA, 2014).`,
      refs:[
        'Herman, J. L. (1992).',
        'SAMHSA (2014).'
      ]
    },

    {
      nombre:'Validaci√≥n estructural de l√≠mites',
      codigo:'m_vb_entorno_validacionLimites',
      procesos:['VB_entorno','R_coregulacion'],
      texto:`Intervenci√≥n de validaci√≥n que nombra expl√≠citamente los l√≠mites de la psicoterapia frente a condiciones estructurales adversas. Reduce culpa, autoataque y expectativas m√°gicas, y facilita una lectura contextual del sufrimiento que abre la puerta a apoyos externos (Herman, 1992; SAMHSA, 2014).`,
      refs:[
        'Herman, J. L. (1992).',
        'SAMHSA (2014).'
      ]
    }

  ]
},




{
  id:'c_kahneman_biases',
  grupo:'Cognitivo',
  label:'Sesgos cognitivos (Kahneman y Tversky)',
  year:'1974',
  autores:'Daniel Kahneman; Amos Tversky',
 "isMarco": true,
  descripcion:`Conjunto de heur√≠sticos, falacias y sesgos sistem√°ticos del juicio humano descritos en el programa Heuristics & Biases y en la obra posterior de Kahneman (Prospect Theory y Thinking, Fast and Slow). Estos fen√≥menos muestran c√≥mo, bajo incertidumbre, la mente prioriza atajos autom√°ticos (Sistema 1) para producir impresiones r√°pidas y coherentes, mientras el razonamiento deliberativo (Sistema 2) entra tarde, con esfuerzo y a menudo solo para justificar decisiones ya tomadas. En cl√≠nica, estos sesgos ayudan a entender por qu√© pacientes inteligentes sostienen conclusiones r√≠gidas, magnifican riesgos o leen intenciones hostiles sin evidencia suficiente: no es falta de voluntad, sino arquitectura cognitiva predecible. El trabajo terap√©utico los usa para aumentar metacognici√≥n, abrir alternativas, introducir datos base y desmontar narrativas defensivas que mantienen sufrimiento.`,

  influencias:[
    'Heuristics & Biases (Tversky & Kahneman)',
    'Prospect Theory',
    'Econom√≠a conductual',
    'Psicolog√≠a cognitiva del juicio'
  ],

  procesos:[
    'Heur√≠sticos de juicio bajo incertidumbre',
    'Sesgos de probabilidad y estad√≠stica intuitiva',
    'Sesgos de decisi√≥n y valoraci√≥n',
    'Errores de atribuci√≥n y explicaci√≥n',
    'Sesgos de memoria y reconstrucci√≥n'
  ],

  mjps:['N'],

  refs:[
    'Tversky, A., & Kahneman, D. (1974). Judgment under uncertainty: Heuristics and biases. Science.',
    'Kahneman, D., & Tversky, A. (1979). Prospect Theory: An analysis of decision under risk. Econometrica.',
    'Kahneman, D. (2011). Thinking, Fast and Slow.'
  ],

  procedimientos:[
    {
      nombre:'Psicoeducaci√≥n en heur√≠sticos y sesgos',
      codigo:'p_kah_psicoeducacion',
      procesos:['N_metacognicion'],
      texto:`Procedimiento did√°ctico que ense√±a al paciente a reconocer errores de juicio como productos normales del Sistema 1. Se presentan sesgos concretos con ejemplos pr√≥ximos a su vida (relaciones, trabajo, salud), se muestran sus costes funcionales y se entrenan se√±ales de alerta internas (‚Äúesto suena demasiado r√°pido/seguro‚Äù). El objetivo no es eliminar el Sistema 1, sino aprender cu√°ndo distorsiona la realidad y c√≥mo activar pausas deliberativas m√°s √∫tiles.`
    },

    {
      nombre:'Chequeos de debiasing (pausas de Sistema 2)',
      codigo:'p_kah_debiasing',
      procesos:['N_metacognicion'],
      texto:`Secuencia breve de verificaci√≥n antes de concluir o decidir: pedir datos base, estimar rangos en lugar de puntos, buscar activamente contraejemplos, hacer la pregunta alternativa (‚Äú¬øqu√© evidencia me har√≠a cambiar?‚Äù), y revisar costes hundidos/encuadres. En pr√°ctica cl√≠nica se usa como micro‚Äëritual metacognitivo en momentos de activaci√≥n emocional, para que la persona no confunda sensaci√≥n de certeza con evidencia suficiente.`
    }

  ],

  micros:[
    {
      nombre:'Heur√≠stico de disponibilidad',
      codigo:'m_kah_disponibilidad',
      procesos:['N_metacognicion'],
      texto:`Tendencia a estimar frecuencias y riesgos seg√∫n lo f√°cil que vienen a la mente ejemplos, de modo que eventos recientes, v√≠vidos o emocionalmente cargados parecen m√°s probables de lo que son. En psicoterapia explica miedos sobredimensionados tras noticias o experiencias puntuales, y tambi√©n la infraestimaci√≥n de riesgos poco visibles. Intervenir implica introducir datos base, ampliar el muestreo de recuerdos y diferenciar viveza subjetiva de probabilidad real.`
    },

    {
      nombre:'Heur√≠stico de representatividad',
      codigo:'m_kah_representatividad',
      procesos:['N_metacognicion'],
      texto:`Sesgo por el que juzgamos la probabilidad de algo por su parecido con un prototipo, ignorando estad√≠sticas previas y variabilidad. Lleva a conclusiones r√°pidas tipo ‚Äúesto es como X, por tanto acabar√° igual‚Äù, muy t√≠picas en ansiedad y depresi√≥n. Cl√≠nicamente se trabaja confrontando tasas base, explorando excepciones y haciendo expl√≠cito el salto autom√°tico de similitud a certeza.`
    },

    {
      nombre:'Heur√≠stico de anclaje y ajuste',
      codigo:'m_kah_anclaje',
      procesos:['N_metacognicion'],
      texto:`La mente se fija en un valor inicial ‚Äîaunque sea arbitrario‚Äî y ajusta insuficientemente a partir de √©l, arrastrando estimaciones y decisiones posteriores. En cl√≠nica aparece cuando una primera impresi√≥n (‚Äúsoy un desastre‚Äù, ‚Äúesto ir√° mal‚Äù) condiciona todo el razonamiento posterior. La intervenci√≥n busca detectar el ancla, generar anclas alternativas y recalibrar con informaci√≥n nueva.`
    },

    {
      nombre:'Heur√≠stico afectivo',
      codigo:'m_kah_afectivo',
      procesos:['N_metacognicion'],
      texto:`Evaluaci√≥n de riesgos y beneficios guiada por la valencia emocional inmediata: lo que gusta parece seguro y lo que asusta parece peligroso. Sustituye an√°lisis por sensaci√≥n, amplificando evitaci√≥n experiencial. En terapia se trabaja distinguiendo emoci√≥n de evidencia, tolerando afecto sin concluir de inmediato y usando exposici√≥n emocional para verificar hip√≥tesis.`
    },

    {
      nombre:'Negligencia de tasas base',
      codigo:'m_kah_tasasBase',
      procesos:['N_metacognicion'],
      texto:`Ignorar probabilidades previas y datos poblacionales a favor de informaci√≥n concreta o narrativa. Hace que historias individuales dominen el juicio y se subestime lo estad√≠sticamente probable. En psicoterapia se ve en decisiones impulsivas o creencias r√≠gidas sobre los dem√°s. Se corrige introduciendo tasas base, preguntando ‚Äú¬øqu√© suele pasar en general?‚Äù y comparando con el caso propio.`
    },

    {
      nombre:'Ley de los peque√±os n√∫meros',
      codigo:'m_kah_pequenosNumeros',
      procesos:['N_metacognicion'],
      texto:`Creer que muestras peque√±as reflejan fielmente una poblaci√≥n, lo que lleva a sobreinterpretar rachas y patrones en eventos aleatorios. Es clave en pensamiento paranoide o m√°gico cotidiano (‚Äúsi pas√≥ dos veces, siempre pasa‚Äù). La intervenci√≥n enfatiza tama√±o muestral, azar, y busca ampliar experiencia observada.`
    },

    {
      nombre:'Insensibilidad al tama√±o muestral',
      codigo:'m_kah_tamMuestra',
      procesos:['N_metacognicion'],
      texto:`No ajustar el nivel de confianza seg√∫n cu√°ntos casos hay detr√°s de una impresi√≥n; una an√©cdota pesa como una serie robusta. En cl√≠nica alimenta generalizaciones excesivas y autoetiquetas (‚Äúsoy as√≠‚Äù). Se trabaja cuantificando experiencia, diferenciando an√©cdota de patr√≥n y entrenando lenguaje probabil√≠stico.`
    },

    {
      nombre:'Falacia de la conjunci√≥n',
      codigo:'m_kah_conjuncion',
      procesos:['N_metacognicion'],
      texto:`Asignar mayor probabilidad a una historia espec√≠fica y coherente que a uno de sus componentes simples, porque la coherencia narrativa enga√±a al Sistema 1. En psicoterapia sostiene explicaciones cerradas y culpabilizantes. Se desarma separando hechos de a√±adidos interpretativos y estimando probabilidades por partes.`
    },

    {
      nombre:'Falacia del jugador',
      codigo:'m_kah_jugador',
      procesos:['N_metacognicion'],
      texto:`Esperar que la aleatoriedad ‚Äúcompense‚Äù a corto plazo (tras varias p√©rdidas, ‚Äútoca‚Äù ganar). Genera falsas expectativas y lecturas err√≥neas de coincidencias. Se ve en decisiones de riesgo, relaciones repetitivas o reca√≠das. Intervenir implica psicoeducaci√≥n sobre azar y reformular rachas sin moralizarlas.`
    },

    {
      nombre:'Ilusi√≥n de validez',
      codigo:'m_kah_ilusionValidez',
      procesos:['N_metacognicion'],
      texto:`Exceso de confianza en predicciones basadas en pocos datos pero narrativamente coherentes. ‚ÄúSuena bien, por tanto es verdad‚Äù. En cl√≠nica impulsa certezas diagn√≥sticas sobre uno mismo o los otros. Se trabaja aumentando tolerancia a la incertidumbre y buscando evidencia externa y longitudinal.`
    },

    {
      nombre:'Regresi√≥n a la media ignorada',
      codigo:'m_kah_regresionMedia',
      procesos:['N_metacognicion'],
      texto:`Atribuir cambios posteriores a causas personales sin considerar que los extremos tienden estad√≠sticamente a volver al promedio. Favorece explicaciones m√°gicas o culpabilizaci√≥n. En terapia ayuda a normalizar oscilaciones emocionales y a no sacar conclusiones globales de picos o bajones.`
    },

    {
      nombre:'Efecto de encuadre (framing)',
      codigo:'m_kah_framing',
      procesos:['N_metacognicion'],
      texto:`La decisi√≥n cambia seg√∫n se presente como ganancia o p√©rdida aunque el resultado sea equivalente. El encuadre activa circuitos emocionales distintos y gu√≠a la elecci√≥n. En cl√≠nica, cambiar el framing (‚Äúfracaso‚Äù vs ‚Äúaprendizaje‚Äù) altera motivaci√≥n y evitaci√≥n. Se trabaja reencuadrando y comparando opciones en formatos alternativos.`
    },

    {
      nombre:'Aversi√≥n a la p√©rdida',
      codigo:'m_kah_aversPerdida',
      procesos:['N_metacognicion'],
      texto:`Las p√©rdidas pesan m√°s que las ganancias equivalentes; por eso se evita cambiar incluso cuando el cambio es beneficioso. Mantiene conductas disfuncionales por miedo a perder seguridad aparente. En terapia se aborda exponiendo a p√©rdidas peque√±as, clarificando valores y calculando costes de no cambiar.`
    },

    {
      nombre:'Efecto dotaci√≥n',
      codigo:'m_kah_dotacion',
      procesos:['N_metacognicion'],
      texto:`Valorar m√°s lo que ya se posee solo por poseerlo, elevando el coste subjetivo de renunciar. En psicoterapia explica apego a identidades dolorosas, relaciones t√≥xicas o h√°bitos. Se trabaja aumentando perspectiva temporal y ensayando micro‚Äërenuncias para recalibrar valor real.`
    },

    {
      nombre:'Sesgo de statu quo',
      codigo:'m_kah_statusQuo',
      procesos:['N_metacognicion'],
      texto:`Preferir que nada cambie, sobreestimando riesgos del cambio y minimizando costes de mantener el estado actual. Fuerte en depresi√≥n y ansiedad social. La intervenci√≥n clarifica costes ocultos del statu quo y estructura cambios graduados hacia valores.`
    },

    {
      nombre:'Costes hundidos (sunk cost)',
      codigo:'m_kah_costesHundidos',
      procesos:['N_metacognicion'],
      texto:`Persistir en una decisi√≥n por inversi√≥n previa (tiempo, dinero, esfuerzo) aunque continuar empeore la situaci√≥n. En cl√≠nica aparece en relaciones prolongadas o carreras vitales no elegidas. Se trabaja distinguiendo pasado irrecuperable de opciones presentes y autorizando a ‚Äúdejar de cavar‚Äù.`
    },

    {
      nombre:'Contabilidad mental',
      codigo:'m_kah_contabilidadMental',
      procesos:['N_metacognicion'],
      texto:`Asignar recursos a ‚Äúcuentas‚Äù psicol√≥gicas separadas (dinero, tiempo, energ√≠a) y tomar decisiones incoherentes con el valor global. En terapia se ve en auto‚Äëpermisos o auto‚Äëcastigos. Se corrige recombinando cuentas y evaluando objetivos a nivel de vida completa.`
    },

    {
      nombre:'Efecto certeza',
      codigo:'m_kah_certeza',
      procesos:['N_metacognicion'],
      texto:`Sobrevalorar resultados seguros frente a probabil√≠sticos, eligiendo opciones con menor valor esperado porque dan sensaci√≥n de control. Alimenta evitaci√≥n de riesgo saludable. En cl√≠nica se trabaja tolerancia a incertidumbre y pensamiento por rangos.`
    },

    {
      nombre:'Efecto posibilidad',
      codigo:'m_kah_posibilidad',
      procesos:['N_metacognicion'],
      texto:`Sobreponderar cambios desde 0% a ‚Äúalgo‚Äù m√°s que cambios equivalentes en probabilidades medias, lo que explica fascinaci√≥n por apuestas peque√±as o esperanzas m√≠nimas. En terapia se usa para entender enganches a ‚Äúquiz√° cambie‚Äù en v√≠nculos da√±inos y recalibrar expectativas.`
    },

    {
      nombre:'Negligencia de probabilidad',
      codigo:'m_kah_negligProb',
      procesos:['N_metacognicion'],
      texto:`Reaccionar al resultado posible ignorando su probabilidad real, generando miedos intensos a eventos raros o expectativas desmedidas. En ansiedad ayuda a entender por qu√© lo improbable gobierna conducta. Se corrige con estimaciones expl√≠citas y exposici√≥n a incertidumbre.`
    },

    {
      nombre:'Sesgo del resultado',
      codigo:'m_kah_resultado',
      procesos:['N_metacognicion'],
      texto:`Valorar una decisi√≥n por su desenlace final y no por la calidad del proceso con la informaci√≥n disponible en el momento. Genera auto‚Äëculpa retrospectiva y perfeccionismo. En terapia se revisa la decisi√≥n ‚Äúen su contexto‚Äù y se refuerza aprendizaje del proceso.`
    },

    {
      nombre:'Sesgo retrospectivo (hindsight)',
      codigo:'m_kah_hindsight',
      procesos:['N_metacognicion'],
      texto:`Una vez ocurrido algo, se percibe como obvio y predecible (‚Äúya lo sab√≠a‚Äù), distorsionando memoria y aumentando culpa. En cl√≠nica aparece tras rupturas o reca√≠das. Se trabaja reconstruyendo incertidumbre original y normalizando l√≠mites de predicci√≥n.`
    },

    {
      nombre:'Error fundamental de atribuci√≥n',
      codigo:'m_kah_atribFundamental',
      procesos:['N_metacognicion'],
      texto:`Explicar la conducta ajena por rasgos internos y subestimar factores situacionales. Mantiene resentimiento y rigidez moral. En terapia se entrena perspectiva contextual, mentalizaci√≥n y b√∫squeda de variables externas.`
    },

    {
      nombre:'Ilusi√≥n de comprensi√≥n',
      codigo:'m_kah_ilusionComprension',
      procesos:['N_metacognicion'],
      texto:`Construir explicaciones coherentes post hoc que dan falsa sensaci√≥n de entender causas, aunque la realidad sea m√°s compleja. En psicoterapia alimenta narrativas cerradas de identidad. Se trabaja introduciendo pluralidad causal y humildad epist√©mica.`
    },

    {
      nombre:'Falacia narrativa',
      codigo:'m_kah_falaciaNarrativa',
      procesos:['N_metacognicion'],
      texto:`Preferir historias causales simples que encajan bien a explicaciones probabil√≠sticas complejas, lo cual reduce ansiedad a costa de distorsionar la realidad. En cl√≠nica refuerza culpabilizaci√≥n o victimismo. Se corrige separando hechos de relato y aceptando complejidad.`
    },

    {
      nombre:'Sesgo de optimismo',
      codigo:'m_kah_optimismo',
      procesos:['N_metacognicion'],
      texto:`Sobreestimar el √©xito propio e infravalorar riesgos, √∫til para emprender pero peligroso en decisiones impulsivas. En terapia puede sostener reca√≠das o negaci√≥n. Se trabaja calibrando riesgos sin destruir esperanza.`
    },

    {
      nombre:'Ilusi√≥n de control',
      codigo:'m_kah_ilusionControl',
      procesos:['N_metacognicion'],
      texto:`Creer que uno controla lo que depende en gran parte del azar o de variables externas, generando culpa cuando no sale y falsa seguridad cuando sale. En cl√≠nica aparece en ansiedad generalizada y TOC. Se interviene distinguiendo control real vs deseado.`
    },

    {
      nombre:'Falacia de planificaci√≥n',
      codigo:'m_kah_planificacion',
      procesos:['N_metacognicion'],
      texto:`Subestimar tiempo, coste y dificultad de proyectos futuros y sobreestimar beneficios, incluso con experiencia previa que contradice la estimaci√≥n. Mantiene procrastinaci√≥n y frustraci√≥n cr√≥nica. Se trabaja usando datos de proyectos anteriores y planificando con m√°rgenes.`
    },

    {
      nombre:'Efecto halo',
      codigo:'m_kah_halo',
      procesos:['N_metacognicion'],
      texto:`Una impresi√≥n global positiva o negativa contamina juicios sobre rasgos espec√≠ficos, haciendo que la mente rellene huecos con coherencia. En terapia explica idealizaci√≥n/devaluaci√≥n r√°pida en v√≠nculos. Se corrige desglosando dimensiones y verificando evidencia por rasgo.`
    },

    {
      nombre:'Sustituci√≥n de preguntas',
      codigo:'m_kah_sustitucion',
      procesos:['N_metacognicion'],
      texto:`Responder una pregunta dif√≠cil con otra f√°cil sin darse cuenta (core del Sistema 1), por ejemplo sustituir ‚Äú¬øqu√© vida quiero?‚Äù por ‚Äú¬øqu√© me apetece ahora?‚Äù. En cl√≠nica sostiene decisiones de corto plazo contra valores. Se trabaja devolviendo la pregunta original.`
    },

    {
      nombre:'Sesgo de confirmaci√≥n',
      codigo:'m_kah_confirmacion',
      procesos:['N_metacognicion'],
      texto:`Buscar, interpretar y recordar informaci√≥n que confirma creencias previas, evitando la que las contradice. Central en ansiedad, depresi√≥n y conflicto de pareja. Se trabaja con experimentos conductuales, b√∫squeda activa de contra‚Äëevidencia y exposici√≥n a disconfirmaci√≥n.`
    },

    {
      nombre:'Regla pico-final',
      codigo:'m_kah_picoFinal',
      procesos:['N_metacognicion'],
      texto:`Recordar una experiencia por su pico emocional y su final, ignorando la duraci√≥n total; gu√≠a decisiones futuras m√°s que la vivencia real. En terapia es clave en trauma y relaciones: una escena final contamina todo. Se trabaja revisando la curva completa de experiencia.`
    },

    {
      nombre:'Negligencia de duraci√≥n',
      codigo:'m_kah_duracion',
      procesos:['N_metacognicion'],
      texto:`La duraci√≥n de una experiencia pesa poco en su evaluaci√≥n retrospectiva; importa m√°s c√≥mo termin√≥. Esto distorsiona decisiones (p. ej., soportar mal un proceso breve si finaliza mal). En cl√≠nica se usa para re‚Äëevaluar historias vitales con m√°s precisi√≥n temporal.`
    },

    {
      nombre:'Yo que experimenta vs. yo que recuerda',
      codigo:'m_kah_dosYos',
      procesos:['N_metacognicion'],
      texto:`Distinci√≥n entre el ‚Äòyo que vive‚Äô el momento y el ‚Äòyo que recuerda‚Äô despu√©s, siendo este √∫ltimo quien decide. Explica por qu√© alguien repite experiencias que fueron malas pero acabaron bien. En terapia se exploran ambas voces para tomar decisiones m√°s ajustadas.`
    },

    {
      nombre:'Exceso de confianza',
      codigo:'m_kah_excesoConfianza',
      procesos:['N_metacognicion'],
      texto:`Sobreestimar la exactitud del propio juicio, especialmente en predicci√≥n, porque la coherencia interna se confunde con verdad. En cl√≠nica alimenta rigidez, discusiones y mala estimaci√≥n de riesgos. Se trabaja con calibraci√≥n probabil√≠stica y feedback realista.`
    },

    {
      nombre:'Efecto de primac√≠a',
      codigo:'m_kah_primacia',
      procesos:['N_metacognicion'],
      texto:`La informaci√≥n inicial pesa m√°s que la posterior al formar una impresi√≥n; primeras escenas de una relaci√≥n o terapia marcan evaluaci√≥n global. En cl√≠nica explica ‚Äúprimeros golpes‚Äù de trauma relacional. Se interviene revisando datos posteriores y re‚Äëequilibrando el relato.`
    },

    {
      nombre:'Efecto de recencia',
      codigo:'m_kah_recencia',
      procesos:['N_metacognicion'],
      texto:`La informaci√≥n m√°s reciente domina el juicio sobre una secuencia, de manera que un evento final colorea todo lo anterior. En terapia aparece en evaluaci√≥n de progresos (‚Äúesta semana fatal, entonces todo va mal‚Äù). Se corrige volviendo a la serie completa.`
    }

  ]
},






 
  
  
   
  


     
{
  id:'c1cbti',
  grupo:'Conductismo',
  label:'Terapia cognitivo-conductual para el insomnio (CBT-I)',
  year:'1970',
  autores:'Richard Bootzin; Arthur Spielman; Charles Morin; Colin Espie; Jack Edinger; Michael Perlis; Allison Harvey; Peter Hauri; Buysse; Lichstein',

  influencias:[
    'Medicina del sue√±o (regulaci√≥n homeost√°tica y circadiana)',
    'Modelo 3P del insomnio (predisponentes‚Äìprecipitantes‚Äìperpetuantes)',
    'Conductismo aplicado al sue√±o (control de est√≠mulos y aprendizaje asociativo)',
    'Restricci√≥n/compresi√≥n del sue√±o y principios de consolidaci√≥n',
    'Modelos cognitivos del insomnio (hipervigilancia, creencias, esfuerzo por dormir)',
    'Psicoeducaci√≥n, autorregistro y toma de decisiones guiada por datos'
  ],

  descripcion:`La CBT-I es el tratamiento psicol√≥gico de primera l√≠nea para el insomnio cr√≥nico porque aborda directamente los mecanismos que lo mantienen: la asociaci√≥n condicionada cama‚Äìvigilia, la p√©rdida de presi√≥n de sue√±o por ‚Äúcompensaciones‚Äù (siestas, acostarse demasiado pronto, permanecer en cama despierto) y la activaci√≥n cognitiva/afectiva ligada al esfuerzo por dormir. Su centro operativo es conductual (sleep scheduling, restricci√≥n/compresi√≥n y control de est√≠mulos), y se potencia con componentes cognitivos espec√≠ficos (creencias, catastrofizaci√≥n, vigilancia del sue√±o, ansiedad de rendimiento) y con medidas de soporte (higiene del sue√±o, relajaci√≥n, manejo de sustancias y entorno). El encuadre cl√≠nico es importante: CBT-I no pretende ‚Äúresolver la vida‚Äù ni sustituir una psicoterapia orientada a conflictos, trauma o dilemas vitales; su funci√≥n es reorganizar el sistema sue√±o-vigilia para reducir ruido fisiol√≥gico, mejorar energ√≠a y estabilidad diurna, y hacer m√°s viable un trabajo psicoterap√©utico posterior cuando hay comorbilidad o contenido psicol√≥gico dominante (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù, cap. 6 ‚ÄúCognitive Therapy‚Äù, cap. 8 ‚ÄúClinical and Treatment Implementation Issues‚Äù).`,

  neimeyer: {

    epistemologico: `
Concepci√≥n de la realidad psicol√≥gica
El insomnio se entiende, ante todo, como un problema biopsicoconductual observable y medible: patrones de sue√±o-vigilia, conductas y condiciones que mantienen la vigilia, y procesos cognitivos/afectivos que elevan la activaci√≥n. La ‚Äúrealidad cl√≠nica‚Äù relevante no es la narrativa del paciente por s√≠ sola, sino la combinaci√≥n de (a) indicadores medibles (diario de sue√±o, latencia, despertares, eficiencia), (b) regularidades funcionales (qu√© lo empeora o lo mejora) y (c) mecanismos plausibles (hiperactivaci√≥n, condicionamiento, desincronizaci√≥n, presi√≥n homeost√°tica insuficiente). Se asume que la experiencia subjetiva importa, pero se contrasta con datos y con el patr√≥n conductual real.

Concepci√≥n del conocimiento terap√©utico
El conocimiento terap√©utico es emp√≠rico, pragm√°tico y orientado a resultados: se trabaja con hip√≥tesis operativas que se ponen a prueba semana a semana (p. ej., ‚Äúdemasiado tiempo en cama est√° entrenando vigilia‚Äù, ‚Äúla siesta est√° reduciendo la presi√≥n de sue√±o‚Äù). La intervenci√≥n se gu√≠a por autorregistro y por reglas cl√≠nicas derivadas de evidencia, y se ajusta en funci√≥n de la respuesta del paciente. No se busca ‚Äúverdad psicol√≥gica profunda‚Äù, sino construir un plan eficaz basado en mecanismos conocidos y datos del caso.

Concepci√≥n del ser humano y del cambio
El ser humano se concibe como un organismo autorregulado en el que el sue√±o es un proceso biol√≥gico que emerge mejor cuando se alinean ritmos, presi√≥n homeost√°tica y se√±ales ambientales/conductuales. El cambio se produce principalmente por aprendizaje y reorganizaci√≥n de h√°bitos (condicionamiento y control de est√≠mulos), por ajuste del timing (restricci√≥n/compresi√≥n, regularidad circadiana) y por reducci√≥n de procesos cognitivos que disparan hiperactivaci√≥n (creencias disfuncionales, esfuerzo por dormir, vigilancia del reloj). La voluntad o el insight pueden ayudar, pero no son el motor central: el motor es la implementaci√≥n consistente.

Rol de la relaci√≥n terap√©utica
La relaci√≥n terap√©utica es un facilitador t√©cnico: mejora adherencia, motivaci√≥n y tolerancia a la incomodidad inicial (somnolencia, frustraci√≥n, miedo a ‚Äúdormir menos‚Äù), y permite negociar barreras reales de implementaci√≥n. La alianza importa porque CBT-I exige conductas concretas y consistentes; sin colaboraci√≥n y confianza, el paciente abandona, flexibiliza demasiado las reglas o las aplica de forma r√≠gida y ansiosa, perdiendo eficacia.`,

    teoriaFormal: `
Qu√© es el problema (modelo explicativo general)
El insomnio cr√≥nico se explica como un trastorno mantenido por tres grandes ejes: (1) condicionamiento: la cama/dormitorio se asocia a alerta, rumiaci√≥n y lucha; (2) desregulaci√≥n de la ‚Äúeconom√≠a del sue√±o‚Äù: el paciente reduce la presi√≥n homeost√°tica al ampliar tiempo en cama, hacer siestas o irregular horarios; (3) hiperactivaci√≥n cognitiva/afectiva: preocupaci√≥n por dormir, catastrofizaci√≥n de consecuencias, vigilancia del sue√±o y esfuerzo por controlar el inicio del sue√±o, que elevan arousal y perpet√∫an el problema. Estos ejes pueden coexistir con factores circadianos y comorbilidades, pero el mantenimiento suele estar en las rutinas y respuestas aprendidas.

C√≥mo se explica el cambio
El cambio ocurre al invertir sistem√°ticamente los mantenedores: se reentrena la asociaci√≥n cama‚Üísue√±o (control de est√≠mulos), se compacta el sue√±o y aumenta eficiencia mediante restricci√≥n/compresi√≥n (m√°s presi√≥n homeost√°tica, menos vigilia en cama), se estabiliza el ritmo con un ancla de levantarse y exposici√≥n adecuada a se√±ales temporales, y se reduce el ‚Äúesfuerzo por dormir‚Äù mediante intervenci√≥n cognitiva espec√≠fica y estrategias de manejo de mente acelerada. El √©xito se entiende como consolidaci√≥n progresiva: menos tiempo despierto en cama, sue√±o m√°s continuo, menor ansiedad anticipatoria y mayor automatismo del dormir.

Qu√© mantiene el sufrimiento
Lo mantiene un c√≠rculo de retroalimentaci√≥n: malas noches ‚Üí miedo a otra mala noche ‚Üí m√°s tiempo en cama / m√°s intentos de control / m√°s siestas ‚Üí menos presi√≥n de sue√±o + m√°s condicionamiento de vigilia ‚Üí peor noche. A nivel cognitivo, lo mantiene el sesgo atencional (monitorizaci√≥n del reloj y del cuerpo), la interpretaci√≥n amenazante (‚Äúma√±ana estar√© fatal‚Äù), y reglas r√≠gidas (‚Äúnecesito X horas s√≠ o s√≠‚Äù) que convierten el dormir en una tarea de rendimiento. A nivel conductual, lo mantiene la inconsistencia y las ‚Äúexcepciones‚Äù frecuentes (fines de semana, siestas, acostarse antes por miedo), que impiden que el aprendizaje se consolide.`,

    teoriaClinica: `
C√≥mo se conceptualiza un caso
El caso se conceptualiza a partir de (a) fenotipo principal (dificultad de inicio, mantenimiento, despertar precoz o mixto), (b) patr√≥n del diario (regularidad, eficiencia, variabilidad), (c) conductas perpetuantes (tiempo en cama excesivo, siestas, uso de cama para actividades, uso de alcohol/hipn√≥ticos como ‚Äúsoluci√≥n‚Äù), (d) procesos cognitivos clave (preocupaci√≥n, esfuerzo por dormir, vigilancia del reloj, creencias disfuncionales), y (e) moduladores contextuales (turnos, ni√±os, dolor, ansiedad/depresi√≥n, medicaci√≥n). Se formula qu√© est√° manteniendo el problema hoy, m√°s que qu√© lo origin√≥ hist√≥ricamente, porque el plan de CBT-I act√∫a sobre mantenedores.

Qu√© procesos terap√©uticos se priorizan
Se prioriza el n√∫cleo conductual cuando hay mucha vigilia en cama y baja eficiencia: control de est√≠mulos + restricci√≥n/compresi√≥n + regularidad de levantarse (y luego ajustes semanales). Se introduce el componente cognitivo cuando la ansiedad de rendimiento, la catastrofizaci√≥n o la mente acelerada est√°n bloqueando la aplicaci√≥n o elevando el arousal. Higiene del sue√±o se usa selectivamente para eliminar inhibidores relevantes (no como lista exhaustiva). La relajaci√≥n se usa como habilidad de desactivaci√≥n y como parte del wind-down, cuidando que no se convierta en ‚Äút√©cnica para dormirse ya‚Äù. Si hay hipn√≥ticos, se planifica coordinaci√≥n y retirada gradual cuando corresponda.

C√≥mo se eval√∫a el progreso terap√©utico
Se eval√∫a con m√©tricas del diario: eficiencia del sue√±o, tiempo despierto tras inicio del sue√±o, latencia, variabilidad de horarios, consistencia 7/7, y necesidad de siestas. Tambi√©n con indicadores cl√≠nicos: reducci√≥n de ansiedad anticipatoria, menos monitorizaci√≥n del reloj, menos tiempo en cama despierto, mayor sensaci√≥n de control conductual (no control del sue√±o), y estabilidad diurna (energ√≠a/funcionamiento). El progreso se interpreta por tendencia semanal y consolidaci√≥n, no por noches sueltas, y se prepara prevenci√≥n de reca√≠das como parte del cierre.`
  },

  procesos:[
    'Evaluaci√≥n y autorregistro (diario de sue√±o + formulaci√≥n)',
    'Sleep scheduling (n√∫cleo conductual integrador)',
    'Control de est√≠mulos (cama = dormir)',
    'Restricci√≥n/compresi√≥n del tiempo en cama (con ajustes semanales)',
    'Intervenci√≥n cognitiva espec√≠fica del sue√±o (creencias, esfuerzo, catastrofizaci√≥n, hipervigilancia)',
    'Relajaci√≥n y rutina de wind-down (habilidad entrenable)',
    'Higiene del sue√±o (soporte: reducir inhibidores)',
    'Manejo de medicaci√≥n hipn√≥tica (si aplica) y prevenci√≥n de reca√≠das',
    'Adherencia y resoluci√≥n de barreras (implementaci√≥n cl√≠nica)'
  ],

  mjps:['VB','RF','RE','AG'],

  refs:[
    'Morin, C. M., & Espie, C. A. (2004). Insomnia: A Clinical Guide to Assessment and Treatment. Springer.',
    'Bootzin, R. R. (1972). Stimulus control treatment for insomnia. (Trabajo seminal; m√∫ltiples reediciones/cap√≠tulos posteriores).',
    'Spielman, A. J., Caruso, L. S., & Glovinsky, P. B. (1987). A behavioral perspective on insomnia treatment. (Modelo 3P y mantenimiento conductual).',
    'Edinger, J. D., & Means, M. K. (2005). Cognitive‚Äìbehavioral therapy for primary insomnia. Clinical Psychology Review, 25, 539‚Äì558.',
    'Morin, C. M., Bootzin, R. R., Buysse, D. J., Edinger, J. D., Espie, C. A., & Lichstein, K. L. (2006). Psychological and behavioral treatment of insomnia: update of the recent evidence (1998‚Äì2004). Sleep, 29(11), 1398‚Äì1414.',
    'Harvey, A. G. (2002). A cognitive model of insomnia. Behaviour Research and Therapy, 40(8), 869‚Äì893.',
    'Perlis, M. L., Jungquist, C., Smith, M. T., & Posner, D. (2005). Cognitive Behavioral Treatment of Insomnia: A Session-by-Session Guide. Springer.'
  ],

  // =========================================================
  // PROCEDIMIENTOS
  // =========================================================
  procedimientos:[

    {
      nombre:'Evaluaci√≥n y diario de sue√±o (y lectura guiada del diario)',
      codigo:'p_cbti_diarioSueno',
      procesos:['VB_sueno'],
      texto:`El diario de sue√±o es el instrumento que convierte el insomnio en un fen√≥meno medible y modificable, y por eso no se usa como ‚Äúpapel administrativo‚Äù, sino como palanca cl√≠nica. Se registra durante al menos 1‚Äì2 semanas la hora de acostarse y levantarse, latencia de inicio, despertares, tiempo total de sue√±o estimado, eficiencia del sue√±o, siestas, consumo de cafe√≠na/alcohol/nicotina, medicaci√≥n y calidad subjetiva, y en sesi√≥n se hace una lectura guiada: el paciente aprende a interpretar patrones, a distinguir somnolencia de cansancio, y a detectar qu√© conductas perpet√∫an el problema. Esto reduce sesgos t√≠picos de percepci√≥n (‚Äúno he dormido nada‚Äù), mejora la adherencia porque el plan se apoya en datos del propio paciente y permite decidir con precisi√≥n la ventana inicial, los ajustes semanales y las barreras reales de implementaci√≥n. En la tradici√≥n CBT-I, esta fase se vincula a la formulaci√≥n de mantenimiento (modelo 3P) para identificar perpetuantes concretos que sostienen la cronificaci√≥n (Morin & Espie, 2004, cap. 3 ‚ÄúAssessment and Differential Diagnosis of Insomnia‚Äù y cap. 5 ‚ÄúSleep Scheduling‚Äù; Spielman et al., 1987).`
    },

    {
      nombre:'Formulaci√≥n del insomnio (modelo 3P y mapa de perpetuantes)',
      codigo:'p_cbti_formulacion3P',
      procesos:['VB_sueno','RF_intero'],
      texto:`La formulaci√≥n sirve para que el paciente entienda por qu√© su insomnio no se mantiene ‚Äúpor falta de fuerza de voluntad‚Äù, sino por un conjunto de perpetuantes muy espec√≠ficos que se han vuelto autom√°ticos: ampliar tiempo en cama, siestas compensatorias, quedarse en la cama despierto, monitorizar el reloj, luchar por dormir, usar alcohol como ‚Äúsedante‚Äù, rumiar en el dormitorio o asociar la cama a amenaza/fracaso. Con el modelo 3P se diferencian factores predisponentes (rasgos, historia, vulnerabilidad), precipitantes (evento de inicio) y, sobre todo, perpetuantes (lo que lo cronifica). Este mapa gu√≠a el orden de intervenci√≥n y reduce el error cl√≠nico de aplicar higiene del sue√±o como si fuera el n√∫cleo, o de discutir cogniciones sin tocar primero los h√°bitos que alimentan la vigilia condicionada. Tambi√©n ayuda a alinear expectativas: el objetivo es consolidar y estabilizar, no lograr ‚Äúnocturnas perfectas‚Äù (Morin & Espie, 2004, cap. 3 ‚ÄúAssessment‚Ä¶‚Äù, cap. 5 ‚ÄúSleep Scheduling‚Äù; Spielman et al., 1987).`
    },

    {
      nombre:'Sleep scheduling (n√∫cleo conductual integrador)',
      codigo:'p_cbti_sleepScheduling',
      procesos:['VB_sueno'],
      texto:`El sleep scheduling organiza el cambio como un programa conductual estable que integra control de est√≠mulos y restricci√≥n/compresi√≥n del sue√±o en una rutina repetible. A partir del diario, se calcula el sue√±o medio real y se define una ventana inicial realista; se fija una hora de levantarse como ancla circadiana y se establece una hora m√°s temprana para acostarse (‚Äúthreshold time‚Äù), evitando acostarse por miedo o por cansancio sin somnolencia. El paciente aprende consistencia 7/7, reducci√≥n de conductas que erosionan presi√≥n de sue√±o (siestas, acostarse antes ‚Äúpor si acaso‚Äù) y normas claras ante la vigilia nocturna para romper el emparejamiento cama-activaci√≥n. La l√≥gica no es ‚Äúdisciplinar‚Äù, sino reentrenar predicci√≥n: cama‚Üísue√±o, no cama‚Üílucha. Este bloque suele ser el motor del cambio porque compacta el sue√±o, reduce el tiempo despierto en cama y baja la ansiedad anticipatoria al devolverle al cuerpo su automatismo (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù; Bootzin, 1972; Edinger & Means, 2005).`
    },

    {
      nombre:'Control de est√≠mulos',
      codigo:'p_cbti_controlEstimulos',
      procesos:['VB_sueno'],
      texto:`El control de est√≠mulos aborda el componente aprendido del insomnio: con el tiempo, la cama y el dormitorio se convierten en se√±ales de alerta (rumiaci√≥n, frustraci√≥n, pantallas, planificaci√≥n, miedo a no dormir), y el cuerpo responde con activaci√≥n autom√°tica. El procedimiento restablece la funci√≥n discriminativa de la cama como contexto de dormir (y sexualidad) y elimina ‚Äúentrenamientos‚Äù de vigilia en ese lugar: no leer/trabajar/pantallas en la cama, acostarse solo con somnolencia, salir de la cama cuando la vigilia se prolonga y volver cuando reaparece somnolencia, mantener hora fija de levantarse y evitar siestas. Esto reduce la hipervigilancia y debilita la asociaci√≥n cama-fracaso, que es uno de los perpetuantes m√°s resistentes. La t√©cnica es simple, pero su eficacia depende de consistencia y de anticipar barreras (pareja, hijos, vivienda peque√±a, ansiedad) (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù; Bootzin, 1972).`
    },

    {
      nombre:'Restricci√≥n/compresi√≥n del tiempo en cama y expansi√≥n gradual',
      codigo:'p_cbti_restriccionCama',
      procesos:['VB_sueno'],
      texto:`La restricci√≥n (o compresi√≥n) del sue√±o corrige el perpetuante m√°s com√∫n: ampliar tiempo en cama para ‚Äúcompensar‚Äù, lo que produce m√°s tiempo despierto en el lugar de dormir y entrena vigilia. La intervenci√≥n ajusta el tiempo permitido en cama al sue√±o real medio, incrementando presi√≥n homeost√°tica y eficiencia del sue√±o; al inicio puede aumentar somnolencia diurna, y por eso se planifica seguridad y se monitoriza. A medida que el sue√±o se consolida, se ampl√≠a gradualmente la ventana en peque√±os incrementos semanales, guiados por eficiencia y por tolerancia diurna, hasta encontrar el punto estable del paciente. Esta t√©cnica suele ser decisiva en insomnio de mantenimiento y en patrones fragmentados, y se combina con control de est√≠mulos para evitar que la ventana m√°s estrecha se convierta en ‚Äútiempo de lucha‚Äù (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù; Morin et al., 2006; Edinger & Means, 2005).`
    },

    {
      nombre:'Higiene del sue√±o como soporte (reducir inhibidores)',
      codigo:'p_cbti_higieneSuenoSoporte',
      procesos:['VB_sueno'],
      texto:`La higiene del sue√±o se usa como ‚Äúhigiene de interferencias‚Äù: no cura por s√≠ sola el insomnio cr√≥nico, pero elimina fricciones que pueden sabotear el n√∫cleo conductual. Se revisan cafe√≠na (incluidas fuentes ocultas), nicotina, alcohol, horario de ejercicio, alimentaci√≥n, siestas, luz/pantallas, ruido, temperatura y comodidad, siempre con mentalidad funcional: qu√© sube activaci√≥n, qu√© fragmenta, qu√© retrasa somnolencia. El encuadre importa: no se plantea como lista moral (‚Äúhazlo bien‚Äù) sino como ajustes elegidos estrat√©gicamente para que el sleep scheduling y el control de est√≠mulos funcionen con menos resistencia. Tambi√©n se identifican ‚Äúfalsos amigos‚Äù (p. ej., alcohol como sedante) y se dise√±an sustitutos realistas (Morin & Espie, 2004, cap. 4 ‚ÄúSleep Hygiene and Relaxation Therapy‚Äù).`
    },

    {
      nombre:'Relajaci√≥n y rutina de wind-down (habilidad entrenable)',
      codigo:'p_cbti_relajacionWindDown',
      procesos:['VB_sueno','RF_relax','RE_modulacion'],
      texto:`La relajaci√≥n en CBT-I se ense√±a como habilidad que reduce activaci√≥n fisiol√≥gica y facilita la transici√≥n al sue√±o, pero evitando el error cl√°sico de convertirla en una t√©cnica ‚Äúpara dormirse ya‚Äù. Se prescribe una rutina de wind-down (60‚Äì90 minutos antes de acostarse) con reducci√≥n progresiva de demandas cognitivas y emocionales, y se entrenan ejercicios de relajaci√≥n (muscular, respiratoria, imaginativa) tambi√©n durante el d√≠a para automatizar la respuesta de desactivaci√≥n. La clave cl√≠nica es el objetivo: relajaci√≥n, no control del sue√±o; cuando el paciente deja de usar la t√©cnica como examen, disminuye la ansiedad de rendimiento y el sue√±o aparece como consecuencia. Se adapta seg√∫n el perfil del paciente (hiperarousal som√°tico vs cognitivo) y se integra con el resto del paquete (Morin & Espie, 2004, cap. 4 ‚ÄúSleep Hygiene and Relaxation Therapy‚Äù).`
    },

    {
      nombre:'Intervenci√≥n cognitiva espec√≠fica del sue√±o',
      codigo:'p_cbti_cognitivaSueno',
      procesos:['VB_sueno','RF_intero','RE_reapreciacion'],
      texto:`La intervenci√≥n cognitiva de CBT-I no es una TCC gen√©rica, sino un trabajo focal sobre creencias y procesos que disparan hiperarousal: expectativas r√≠gidas (‚Äúnecesito 8 horas‚Äù), catastrofizaci√≥n (‚Äúsi no duermo, ma√±ana ser√° un desastre‚Äù), atribuciones err√≥neas (‚Äútodo lo malo es por no dormir‚Äù), monitorizaci√≥n del reloj y, sobre todo, esfuerzo por dormir (‚Äútengo que dormirme ya‚Äù). Se usan reformulaciones realistas, experimentos conductuales y psicoeducaci√≥n precisa para reducir vigilancia y presi√≥n; el objetivo no es ‚Äúpensar positivo‚Äù, sino desmontar el bucle de amenaza-control que mantiene la vigilia. Este componente tambi√©n se alinea con modelos cognitivos contempor√°neos del insomnio que destacan la hipervigilancia y la interpretaci√≥n amenazante de la vigilia nocturna (Morin & Espie, 2004, cap. 6 ‚ÄúCognitive Therapy‚Äù; Harvey, 2002).`
    },

    {
      nombre:'Cognitive control (poner el d√≠a a descansar)',
      codigo:'p_cbti_cognitiveControl',
      procesos:['VB_sueno','RF_ground','RE_prevEvitacion'],
      texto:`El cognitive control saca del dormitorio el ‚Äútrabajo mental‚Äù que suele colonizar la cama: repaso del d√≠a, planificaci√≥n, preocupaci√≥n y resoluci√≥n de problemas. Se reserva un bloque breve por la tarde para listar tareas pendientes, definir pasos concretos y cerrar el proceso; al acostarse, el paciente se recuerda que eso ya est√° atendido y, si aparece una preocupaci√≥n nueva, la anota para el d√≠a siguiente. Esta t√©cnica reduce intrusiones sin recurrir a supresi√≥n forzada (que a menudo rebota) y protege el aprendizaje asociativo: la cama deja de ser un despacho y vuelve a ser un contexto de descanso. Es especialmente √∫til en insomnio con mente acelerada y en perfiles con alto sentido de responsabilidad/rumiaci√≥n (Morin & Espie, 2004, cap. 6 ‚ÄúCognitive Therapy‚Äù).`
    },

    {
      nombre:'Paradoxical intention (reducir ansiedad de rendimiento)',
      codigo:'p_cbti_paradoxicalIntention',
      procesos:['VB_sueno','RE_aceptacion'],
      texto:`La intenci√≥n parad√≥jica se aplica cuando el insomnio est√° claramente mantenido por el esfuerzo por dormir y la ansiedad de rendimiento: cuanto m√°s intenta el paciente dormirse, m√°s se activa. La t√©cnica cambia la meta: se instruye al paciente para permanecer despierto de forma pasiva y relajada, abandonando el intento directo de conciliar; al reducir presi√≥n y vigilancia, baja el arousal y el sue√±o puede emerger espont√°neamente. Requiere un encuadre claro para evitar malentendidos (‚Äúno es resignaci√≥n, es cortar el bucle esfuerzo-activaci√≥n‚Äù) y se integra con el paquete conductual para que no se convierta en una estrategia aislada (Morin & Espie, 2004, cap. 6 ‚ÄúCognitive Therapy‚Äù).`
    },

    {
      nombre:'Articulatory suppression (interrupci√≥n verbal de rumiaci√≥n)',
      codigo:'p_cbti_articulatorySuppression',
      procesos:['VB_sueno','RE_modulacion'],
      texto:`La articulatory suppression es una t√©cnica espec√≠fica para rumiaci√≥n nocturna predominantemente verbal: en lugar de ‚Äúpelear‚Äù con pensamientos, se ocupa de forma neutra el canal verbal de la memoria de trabajo mediante repetici√≥n mental de un est√≠mulo simple (por ejemlo repitiendo "the" cada segundo), reduciendo la entrada de material rumiativo. Se utiliza sobre todo en despertares nocturnos y se presenta como estrategia limitada y concreta (no como supresi√≥n general del pensamiento, que puede intensificar la vigilancia). Su utilidad cl√≠nica es disminuir la activaci√≥n cognitiva sin aumentar el esfuerzo consciente, y por tanto sin alimentar la ansiedad de rendimiento (Morin & Espie, 2004, cap. 6 ‚ÄúCognitive Therapy‚Äù).`
    },

    {
      nombre:'Manejo de medicaci√≥n hipn√≥tica y retirada gradual (si aplica)',
      codigo:'p_cbti_medicacionRetirada',
      procesos:['VB_sueno','AG_compromisoConductual'],
      texto:`En pacientes que usan hipn√≥ticos de forma cr√≥nica, la CBT-I puede incluir coordinaci√≥n y planificaci√≥n para retirada gradual cuando sea cl√≠nicamente apropiado, evitando retiradas bruscas que incrementen rebote de insomnio y ansiedad. El trabajo combina psicoeducaci√≥n (tolerancia, dependencia, expectativas), planificaci√≥n escalonada, monitorizaci√≥n con diario y apoyo cognitivo para manejar el miedo a dormir sin medicaci√≥n, integr√°ndolo con el n√∫cleo conductual para que el paciente disponga de habilidades alternativas. Este componente no es imprescindible en todos los casos, pero cuando existe uso mantenido puede ser decisivo para consolidar el cambio y reducir reca√≠das (Morin & Espie, 2004, cap. 7 ‚ÄúPharmacological Treatment and Medication Withdrawal‚Äù y cap. 8 ‚ÄúClinical and Treatment Implementation Issues‚Äù).`
    },

    {
      nombre:'Implementaci√≥n cl√≠nica: adherencia, barreras y prevenci√≥n de reca√≠das',
      codigo:'p_cbti_implementacion',
      procesos:['VB_sueno','AG_compromisoConductual','ALI_tareas','ALI_colaboracion'],
      texto:`La eficacia real de CBT-I depende tanto de ‚Äúqu√©‚Äù se prescribe como de ‚Äúc√≥mo‚Äù se implementa: cada sesi√≥n revisa el diario, el cumplimiento de pautas (algunas visibles en el diario, otras no), las barreras concretas (contexto familiar, vivienda, turnos, comorbilidad, motivaci√≥n), y se hace resoluci√≥n de problemas muy pr√°ctica. Se ajustan objetivos sin desactivar el n√∫cleo, se refuerza la racionalidad del plan y se prepara al paciente para lapsos: una mala noche no invalida el tratamiento; lo importante es volver al programa sin dramatizar. Este bloque incluye tambi√©n la decisi√≥n cl√≠nica de individualizar (cu√°ndo introducir cognici√≥n, cu√°ndo insistir en scheduling, cu√°ndo priorizar seguridad por somnolencia diurna) y de mantener un encuadre emp√°tico y firme (Morin & Espie, 2004, cap. 8 ‚ÄúClinical and Treatment Implementation Issues‚Äù).`
    }

  ],

  // =========================================================
  // MICROINTERVENCIONES
  // =========================================================
  micros:[

    {
      nombre:'Diferenciar somnolencia vs cansancio (se√±al discriminativa)',
      codigo:'m_cbti_somnolenciaVsCansancio',
      procesos:['VB_sueno'],
      texto:`Micropsicoeducaci√≥n para entrenar una distinci√≥n que cambia la adherencia: cansancio puede ser agotamiento, √°nimo bajo o fatiga, pero la somnolencia es la se√±al fisiol√≥gica de propensi√≥n a dormir; acostarse ‚Äúpor cansancio‚Äù sin somnolencia suele aumentar tiempo despierto en cama y reforzar el bucle de vigilancia. El paciente aprende a identificar se√±ales corporales simples (bostezos, pesadez ocular, cabeceo) y a usarlas como criterio pr√°ctico, reduciendo el h√°bito de ir a la cama como estrategia de afrontamiento emocional. Esta diferenciaci√≥n suele bajar la frustraci√≥n porque el paciente deja de evaluar el d√≠a en t√©rminos de ‚Äúme toca dormir ya‚Äù y empieza a seguir se√±ales del sistema (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù).`
    },

    {
      nombre:'Hora fija de levantarse (ancla circadiana 7/7)',
      codigo:'m_cbti_horaFija',
      procesos:['VB_sueno'],
      texto:`Se acuerda una hora estable de levantarse todos los d√≠as, incluidos fines de semana, porque el sistema circadiano aprende sobre todo desde el despertar: la regularidad estabiliza la presi√≥n de sue√±o y reduce variabilidad, que es gasolina para el insomnio cr√≥nico. Esta microintervenci√≥n se presenta como medida de alto impacto y baja complejidad, y se acompa√±a de planificaci√≥n realista (alarma, exposici√≥n a luz, ritual breve) para que el paciente no lo viva como castigo sino como palanca biol√≥gica. Es especialmente importante en pacientes que intentan ‚Äúarreglar‚Äù el insomnio acost√°ndose antes, lo que suele empeorarlo (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù).`
    },

    {
      nombre:'Threshold time (hora m√°s temprana para acostarse)',
      codigo:'m_cbti_thresholdTime',
      procesos:['VB_sueno'],
      texto:`Se define una hora m√°s temprana para acostarse a partir del sue√±o medio real y la hora fija de levantarse, creando una ventana de sue√±o realista que compacta el dormir y reduce el tiempo de vigilia en cama. Se formula como experimento: no se busca ‚Äúdormir perfecto‚Äù, sino consolidar, y por eso el criterio es funcional, no ideal. Esta microintervenci√≥n da estructura al programa, reduce la negociaci√≥n nocturna (‚Äú¬øme acuesto ya?‚Äù) y baja el esfuerzo por dormir porque el paciente entiende que su tarea no es forzar, sino respetar el contenedor temporal que favorece el automatismo (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù).`
    },

    {
      nombre:'Regla cama = dormir (y sexualidad) + ‚Äúcama no es oficina‚Äù',
      codigo:'m_cbti_camaDormir',
      procesos:['VB_sueno'],
      texto:`Se explicita que la cama debe predecir sue√±o, no alerta: se retiran actividades que entrenan vigilia (m√≥vil, redes, trabajo, conversaciones tensas, rumiaci√≥n deliberada) y se protege el dormitorio como contexto de descanso. Se presenta como aprendizaje asociativo: si cada noche el cerebro ‚Äúpractica‚Äù estar despierto en la cama, esa respuesta se automatiza. Aplicada con consistencia, esta regla reduce ansiedad anticipatoria y facilita que otras t√©cnicas (restricci√≥n, salida de cama) funcionen con menos fricci√≥n (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù; Bootzin, 1972).`
    },

    {
      nombre:'Salir de la cama ante vigilia prolongada (romper el bucle)',
      codigo:'m_cbti_salirCama',
      procesos:['VB_sueno'],
      texto:`Cuando aparece vigilia prolongada o rumiaci√≥n intensa, se aplica una respuesta conductual breve: salir de la cama, luz baja, actividad neutra y repetible, y volver solo cuando reaparece somnolencia; el objetivo no es ‚Äúmatar el tiempo‚Äù, sino evitar que la cama se asocie a lucha y frustraci√≥n. Esta microintervenci√≥n reduce impotencia aprendida (‚Äúno puedo hacer nada‚Äù) porque devuelve una acci√≥n eficaz y coherente con el aprendizaje, y protege el principio central del control de est√≠mulos: cama‚Üídormir, no cama‚Üípelear (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù; Bootzin, 1972).`
    },

    {
      nombre:'Evitar siestas (o limitar micro-siestas)',
      codigo:'m_cbti_siestas',
      procesos:['VB_sueno'],
      texto:`Se revisa el patr√≥n de siestas porque suelen funcionar como perpetuante: alivian a corto plazo, pero reducen presi√≥n de sue√±o nocturna y empeoran mantenimiento. La intervenci√≥n se negocia de forma realista: idealmente evitarlas, y si no es posible, limitarlas en duraci√≥n y horario para minimizar da√±o circadiano y homeost√°tico. Se explica como econom√≠a del sue√±o: el sue√±o diurno se ‚Äúcobra‚Äù parte del sue√±o nocturno y dificulta la consolidaci√≥n (Morin & Espie, 2004, cap. 5 ‚ÄúSleep Scheduling‚Äù).`
    },

    {
      nombre:'Descatastrofizaci√≥n del ‚Äúno dormir‚Äù (bajar amenaza)',
      codigo:'m_cbti_descatastro',
      procesos:['VB_sueno','RE_reapreciacion'],
      texto:`Se hace una intervenci√≥n cognitiva breve para desinflar la amenaza: separar cansancio de desastre, reducir la idea de que ‚Äútodo ir√° mal‚Äù, y romper el c√≠rculo vigilancia‚Üímiedo‚Üíactivaci√≥n. Se construyen predicciones alternativas basadas en evidencia personal (‚Äúhe funcionado suficientemente con menos horas‚Äù) y se corrige la atribuci√≥n global (‚Äútodo problema es por no dormir‚Äù). Esto reduce monitorizaci√≥n del reloj y presi√≥n de rendimiento, dos de los combustibles m√°s potentes del insomnio cr√≥nico (Morin & Espie, 2004, cap. 6 ‚ÄúCognitive Therapy‚Äù; Harvey, 2002).`
    },

    {
      nombre:'Cognitive control en 2 pasos (tarde + anotaci√≥n nocturna)',
      codigo:'m_cbti_cognitiveControl',
      procesos:['VB_sueno','RF_ground','RE_prevEvitacion'],
      texto:`Se pauta un ‚Äúcierre del d√≠a‚Äù breve por la tarde para listar pendientes y definir pasos concretos, y se a√±ade una regla nocturna: si surge una preocupaci√≥n en la cama, se anota y se deja para ma√±ana. La l√≥gica es simple: pensar no es el enemigo, el enemigo es pensar en el lugar y momento que entrena vigilia. Esta microintervenci√≥n es especialmente √∫til en insomnio con rumiaci√≥n y responsabilidad elevada, porque ofrece un canal leg√≠timo para la mente sin regalarle el dormitorio (Morin & Espie, 2004, cap. 6 ‚ÄúCognitive Therapy‚Äù).`
    },

    {
      nombre:'Paradoxical intention (si hay esfuerzo por dormir)',
      codigo:'m_cbti_PI',
      procesos:['VB_sueno','RE_aceptacion'],
      texto:`Cuando el paciente ‚Äúse examina‚Äù para dormirse, se prescribe un cambio de meta: permanecer despierto pero relajado, sin intentar conciliar. El mensaje cl√≠nico es claro: el sue√±o no se produce por orden; aparece cuando la amenaza baja. Esta microintervenci√≥n corta el bucle esfuerzo‚Üíactivaci√≥n y suele reducir la ansiedad anticipatoria de forma r√°pida si se explica bien y se integra con el resto del programa (Morin & Espie, 2004, cap. 6 ‚ÄúCognitive Therapy‚Äù).`
    },

    {
      nombre:'Higiene m√≠nima de alto impacto (cafe√≠na, alcohol, luz)',
      codigo:'m_cbti_higieneMinima',
      procesos:['VB_sueno'],
      texto:`En vez de una lista infinita, se seleccionan 2‚Äì3 inhibidores de alto impacto seg√∫n el caso: cafe√≠na (horario y fuentes ocultas), alcohol (sedante falso que fragmenta) y luz/pantallas por la noche (activaci√≥n y desplazamiento de somnolencia). Se negocia con realismo para mejorar adherencia: la meta no es ‚Äúpureza‚Äù, sino reducir interferencias que sabotean el n√∫cleo conductual. Este enfoque evita que el paciente convierta la higiene del sue√±o en un perfeccionismo m√°s (Morin & Espie, 2004, cap. 4 ‚ÄúSleep Hygiene and Relaxation Therapy‚Äù).`
    },

    {
      nombre:'Wind-down 60‚Äì90 min (ritual de transici√≥n)',
      codigo:'m_cbti_windDown',
      procesos:['VB_sueno','RE_modulacion'],
      texto:`Se dise√±a un tramo previo al sue√±o con reducci√≥n progresiva de exigencia mental y emocional, creando un ritual repetible que le dice al sistema ‚Äúya no toca rendimiento‚Äù. No es una rutina r√≠gida: es una se√±al estable de cierre del d√≠a que baja activaci√≥n y mejora consistencia del programa. Se adapta al contexto real (familia, trabajo, turnos) para que no se viva como una imposici√≥n imposible (Morin & Espie, 2004, cap. 4 ‚ÄúSleep Hygiene and Relaxation Therapy‚Äù).`
    }

  ]
},


      
      
       // =========================================================
  // INTEGRATIVO
  // =========================================================
      





{
  id:'k_worden_duelo',
  grupo:'Integrativo',
  label:'Tareas del duelo',
  year:'1982',
  autores:'J. William Worden',
  descripcion:`El modelo de Worden conceptualiza el duelo como un proceso activo de adaptaci√≥n psicol√≥gica ante una p√©rdida irreversible. El sufrimiento no se entiende como un estado pasivo que ‚Äúse atraviesa‚Äù, sino como un conjunto de tareas psicol√≥gicas que la persona necesita elaborar para integrar la p√©rdida y poder seguir viviendo de forma significativa. Estas tareas no son fases secuenciales ni universales: pueden solaparse, reactivarse y presentar bloqueos espec√≠ficos. El trabajo cl√≠nico consiste en identificar qu√© tarea est√° comprometida en cada momento y facilitar su elaboraci√≥n respetando el ritmo, las condiciones contextuales y la singularidad del v√≠nculo perdido.`,

  // =========================================================
  // MAPEO MJPS
  // =========================================================
  mjps:['ED'],

  subprocesos:[
    'ED_reconocimiento',
    'ED_oscilacionTolerancia',
    'ED_expresionVinculada',
    'ED_ajusteMundoPerdidasSec',
    'ED_vinculoContinuo',
    'ED_identidadReinversion'
  ],

  // =========================================================
  // PROCEDIMIENTOS ‚Äî WORDEN (DESARROLLADOS)
  // =========================================================
  procedimientos:[
    {
      nombre:'Narrativa de la p√©rdida',
      codigo:'p_worden_narrativa',
      procesos:['ED_reconocimiento'],
      texto:`Procedimiento cl√≠nico central en el modelo de Worden. Consiste en facilitar la construcci√≥n de una narrativa coherente sobre la p√©rdida que permita integrar el acontecimiento a nivel cognitivo y emocional. El terapeuta invita a relatar qu√© ocurri√≥, c√≥mo se supo, qu√© pas√≥ antes y despu√©s, y c√≥mo se fue comprendiendo la p√©rdida con el paso del tiempo.

El foco no est√° en provocar una descarga emocional intensa ni en repetir el relato como exposici√≥n, sino en observar c√≥mo se cuenta la historia: vac√≠os narrativos, saltos temporales, uso persistente del condicional, tono excesivamente intelectualizado o minimizador. Estos indicadores permiten detectar negaci√≥n encubierta, duelos no autorizados o dificultades para reconocer la irreversibilidad. A medida que la narrativa se vuelve m√°s concreta y afectivamente conectada, el reconocimiento de la p√©rdida se consolida sin forzarlo.` 
    },

    {
      nombre:'Expresi√≥n emocional dirigida',
      codigo:'p_worden_expresion',
      procesos:['ED_expresionVinculada'],
      texto:`Procedimiento orientado a facilitar la expresi√≥n de emociones complejas y ambivalentes dirigidas espec√≠ficamente hacia la figura, relaci√≥n o proyecto perdido. A diferencia de la expresi√≥n emocional general, aqu√≠ el √©nfasis est√° en el destinatario de la emoci√≥n. Se trabaja con cartas no enviadas, di√°logos imaginarios, imaginer√≠a relacional o verbalizaci√≥n directa en sesi√≥n.

Este procedimiento permite que emociones moralizadas o inhibidas ‚Äîrabia, reproche, alivio, culpa, decepci√≥n‚Äî encuentren un canal leg√≠timo de expresi√≥n. Al clarificar a qui√©n va dirigida la emoci√≥n, se reduce la somatizaci√≥n, la irritabilidad difusa y el desplazamiento afectivo. El objetivo no es resolver el v√≠nculo, sino permitir que la ambivalencia se exprese sin autocensura ni culpa.` 
    },

    {
      nombre:'Identificaci√≥n de p√©rdidas secundarias',
      codigo:'p_worden_perdidas_sec',
      procesos:['ED_ajusteMundoPerdidasSec'],
      texto:`Procedimiento destinado a hacer expl√≠citas las p√©rdidas derivadas de la p√©rdida principal, que a menudo quedan invisibilizadas pero sostienen gran parte del malestar. Incluye la exploraci√≥n de cambios en roles, rutinas, estatus social, seguridad econ√≥mica, proyectos de futuro, red de apoyo y sentido de pertenencia.

El terapeuta ayuda a diferenciar entre el dolor por la p√©rdida primaria y el sufrimiento asociado a estas p√©rdidas secundarias, evitando que se mezclen de forma confusa. Este trabajo permite intervenir sobre ajustes pr√°cticos y relacionales sin patologizar el duelo, y previene que la persona se culpe por ‚Äúno avanzar‚Äù cuando en realidad est√° afrontando m√∫ltiples p√©rdidas simult√°neas.` 
    },

    {
      nombre:'Reorganizaci√≥n del v√≠nculo interno',
      codigo:'p_worden_vinculo',
      procesos:['ED_vinculoContinuo'],
      texto:`Procedimiento orientado a transformar el v√≠nculo con lo perdido de una relaci√≥n basada en presencia externa o b√∫squeda compulsiva a una relaci√≥n interna flexible e integrada. El trabajo no consiste en ‚Äúsoltar‚Äù o ‚Äúcerrar‚Äù, sino en recolocar el v√≠nculo de modo que pueda mantenerse sin bloquear la vida actual.

Incluye la elaboraci√≥n de recuerdos significativos, la construcci√≥n de rituales simb√≥licos, la identificaci√≥n del legado relacional y el desarrollo de un di√°logo interno regulado. El terapeuta ayuda a diferenciar entre recordar y quedar atrapado, entre mantener un v√≠nculo y vivir en funci√≥n de la ausencia. El objetivo es que el v√≠nculo contin√∫e sin dominar ni desaparecer.` 
    },

    {
      nombre:'Reinversi√≥n vital progresiva',
      codigo:'p_worden_reinversion',
      procesos:['ED_identidadReinversion'],
      texto:`Procedimiento centrado en facilitar el retorno gradual al deseo, al placer y al compromiso con la vida tras la p√©rdida. Se trabaja la culpa asociada al bienestar, la vivencia de traici√≥n al v√≠nculo perdido y el miedo a ‚Äúolvidar‚Äù o sustituir.

La reinversi√≥n no se plantea como un salto abrupto ni como una exigencia de crecimiento, sino como un proceso progresivo y coherente con la continuidad biogr√°fica. El terapeuta acompa√±a la exploraci√≥n de nuevos intereses, v√≠nculos y proyectos, ayudando a integrar el pasado con el presente sin renunciar a ninguno.` 
    }
  ],

  // =========================================================
  // MICROINTERVENCIONES ‚Äî WORDEN (DESARROLLADAS)
  // =========================================================
  micros:[
    {
      nombre:'Nombrar la irreversibilidad',
      codigo:'m_worden_irreversibilidad',
      procesos:['ED_reconocimiento'],
      texto:`Intervenci√≥n breve y focal que consiste en poner palabras claras y concretas a la irreversibilidad de la p√©rdida. El terapeuta ayuda a diferenciar entre esperanza funcional (c√≥mo vivir ahora) y fantas√≠as defensivas de reversi√≥n. Se utiliza con especial cuidado para evitar confrontaciones prematuras.` 
    },

    {
      nombre:'Detectar condicionales de negaci√≥n',
      codigo:'m_worden_condicionales',
      procesos:['ED_reconocimiento'],
      texto:`Se√±alamiento suave del uso reiterado del condicional (‚Äúsi volviera‚Ä¶‚Äù, ‚Äúcuando pase‚Ä¶‚Äù) como indicador de dificultad para reconocer la p√©rdida. Se introduce como observaci√≥n cl√≠nica, no como correcci√≥n, favoreciendo la toma de conciencia sin ruptura de la alianza.` 
    },

    {
      nombre:'Validar ambivalencia afectiva',
      codigo:'m_worden_ambivalencia',
      procesos:['ED_expresionVinculada'],
      texto:`Microintervenci√≥n destinada a legitimar la coexistencia de emociones contradictorias hacia lo perdido. Reduce la autocensura moral y permite que rabia, alivio o cansancio se expresen sin vivirse como se√±ales de desamor o deslealtad.` 
    },

    {
      nombre:'Dosificar contacto con el dolor',
      codigo:'m_worden_dosificacion',
      procesos:['ED_oscilacionTolerancia'],
      texto:`Intervenci√≥n reguladora que ayuda a calibrar el ritmo de contacto con el dolor del duelo, facilitando entradas y salidas seguras. Previene tanto la evitaci√≥n cr√≥nica como la inundaci√≥n emocional, sosteniendo el proceso en el tiempo.` 
    },

    {
      nombre:'Mapear p√©rdidas secundarias',
      codigo:'m_worden_mapear_sec',
      procesos:['ED_ajusteMundoPerdidasSec'],
      texto:`Intervenci√≥n breve para enumerar y diferenciar las p√©rdidas secundarias asociadas a la p√©rdida principal. Ayuda a clarificar fuentes adicionales de sufrimiento y a orientar intervenciones pr√°cticas y relacionales espec√≠ficas.` 
    },

    {
      nombre:'Autorizar bienestar sin traici√≥n',
      codigo:'m_worden_autorizar',
      procesos:['ED_identidadReinversion'],
      texto:`Microintervenci√≥n dirigida a legitimar experiencias de bienestar, placer y compromiso vital sin vivirse como traici√≥n al v√≠nculo perdido. Facilita la reinversi√≥n vital y la continuidad identitaria.` 
    }
  ],

  refs:[
    'Worden, J. W. (2009). Grief Counseling and Grief Therapy (4th ed.).',
    'Worden, J. W. (2018). Grief Counseling and Grief Therapy (5th ed.).'
  ]
},
{
  id:'k_stroebe_schut_dpm',
  grupo:'Integrativo',
  label:'Dual Process Model of Coping with Bereavement',
  year:'1999',
  autores:'Margaret Stroebe & Henk Schut',
  descripcion:`El Dual Process Model (DPM) concibe el duelo como un proceso din√°mico de afrontamiento que oscila entre dos orientaciones fundamentales: la orientaci√≥n hacia la p√©rdida y la orientaci√≥n hacia la restauraci√≥n. A diferencia de los modelos centrados en tareas o contenidos espec√≠ficos, el DPM introduce como n√∫cleo cl√≠nico el ritmo del proceso. El duelo saludable no implica permanecer en el dolor ni evitarlo, sino alternar de forma flexible entre el contacto con la ausencia y el compromiso con la vida cotidiana.

El sufrimiento se cronifica cuando esta oscilaci√≥n se rigidiza: ya sea por evitaci√≥n persistente del dolor (hiperorientaci√≥n a la restauraci√≥n) o por inmersi√≥n prolongada en la p√©rdida (hiperorientaci√≥n a la p√©rdida). El objetivo terap√©utico no es elegir un polo, sino restaurar la capacidad de oscilar, ajustando el ritmo, la duraci√≥n y el contexto de cada orientaci√≥n.`,

  // =========================================================
  // MAPEO MJPS
  // =========================================================
  mjps:['ED'],

  subprocesos:[
    'ED_oscilacionTolerancia',
    'ED_expresionVinculada',
    'ED_ajusteMundoPerdidasSec'
  ],

  // =========================================================
  // CONCEPTOS CLAVE DEL MODELO
  // =========================================================
  conceptos:[
    {
      nombre:'Orientaci√≥n hacia la p√©rdida',
      descripcion:`Conjunto de experiencias centradas en el dolor de la ausencia: tristeza, a√±oranza, rabia, culpa, recuerdos, confrontaci√≥n con la realidad de la p√©rdida y con el v√≠nculo roto. Incluye tanto el contacto emocional como la evitaci√≥n defensiva de estos contenidos.`
    },
    {
      nombre:'Orientaci√≥n hacia la restauraci√≥n',
      descripcion:`Conjunto de actividades y procesos dirigidos a reorganizar la vida cotidiana: asumir nuevos roles, resolver problemas pr√°cticos, distraerse, comprometerse con tareas, relaciones y proyectos, y construir una vida funcional sin lo perdido.`
    },
    {
      nombre:'Oscilaci√≥n',
      descripcion:`Movimiento flexible y autorregulado entre orientaci√≥n a la p√©rdida y orientaci√≥n a la restauraci√≥n. La oscilaci√≥n permite dosificar el dolor y prevenir tanto la sobrecarga emocional como la desconexi√≥n afectiva.`
    }
  ],

  // =========================================================
  // PROCEDIMIENTOS ‚Äî DUAL PROCESS MODEL (DESARROLLADOS)
  // =========================================================
  procedimientos:[
    {
      nombre:'Psicoeducaci√≥n sobre oscilaci√≥n',
      codigo:'p_dpm_psicoeducacion',
      procesos:['ED_oscilacionTolerancia'],
      texto:`Procedimiento psicoeducativo destinado a normalizar la alternancia entre momentos de contacto con el dolor y momentos de implicaci√≥n en la vida cotidiana. El terapeuta explica expl√≠citamente que no es necesario ni saludable ‚Äúestar siempre mal‚Äù ni ‚Äúestar siempre ocupado‚Äù, y que ambos polos cumplen una funci√≥n reguladora.

Esta psicoeducaci√≥n reduce culpa (‚Äúsi me distraigo, traiciono‚Äù) y miedo (‚Äúsi entro en el dolor, no saldr√©‚Äù), y proporciona un marco comprensible que legitima el ritmo natural del duelo.`
    },

    {
      nombre:'Mapeo de patrones de oscilaci√≥n',
      codigo:'p_dpm_mapeo',
      procesos:['ED_oscilacionTolerancia'],
      texto:`Exploraci√≥n conjunta de c√≥mo oscila actualmente la persona entre p√©rdida y restauraci√≥n. Se identifican momentos, contextos y se√±ales corporales que indican entrada o salida de cada orientaci√≥n, as√≠ como rigideces (evitaci√≥n cr√≥nica o inmersi√≥n prolongada).

El mapeo permite transformar vivencias ca√≥ticas en un patr√≥n observable y modulable, facilitando intervenciones ajustadas al ritmo real del sistema.`
    },

    {
      nombre:'Facilitaci√≥n de entrada al polo de p√©rdida',
      codigo:'p_dpm_entrada_perdida',
      procesos:['ED_expresionVinculada'],
      texto:`Procedimiento destinado a facilitar un contacto dosificado con el dolor cuando existe evitaci√≥n persistente. Incluye focalizaci√≥n emocional, evocaci√≥n de recuerdos, expresi√≥n dirigida y trabajo con la ausencia, siempre dentro de la ventana de tolerancia.

El objetivo no es intensificar el sufrimiento, sino permitir que el dolor tenga un espacio leg√≠timo y limitado, evitando su cronificaci√≥n por evitaci√≥n.`
    },

    {
      nombre:'Facilitaci√≥n de salida hacia restauraci√≥n',
      codigo:'p_dpm_salida_restauracion',
      procesos:['ED_ajusteMundoPerdidasSec'],
      texto:`Procedimiento que ayuda a la persona a reorientarse hacia actividades de la vida cotidiana cuando existe inmersi√≥n prolongada en la p√©rdida. Se trabaja la legitimaci√≥n del descanso emocional, la distracci√≥n funcional y la resoluci√≥n de tareas pr√°cticas.

No se trata de huir del duelo, sino de permitir pausas reguladoras que previenen el colapso emocional y sostienen el proceso a largo plazo.`
    }
  ],

  // =========================================================
  // MICROINTERVENCIONES ‚Äî DPM (DESARROLLADAS)
  // =========================================================
  micros:[
    {
      nombre:'Normalizar la alternancia',
      codigo:'m_dpm_normalizar',
      procesos:['ED_oscilacionTolerancia'],
      texto:`Intervenci√≥n breve que valida expl√≠citamente el ir y venir entre dolor y funcionalidad como se√±al de regulaci√≥n, no de incoherencia. Reduce autojuicio y expectativas irreales de duelo continuo.`
    },

    {
      nombre:'Detectar rigidez de polo',
      codigo:'m_dpm_rigidez',
      procesos:['ED_oscilacionTolerancia'],
      texto:`Se√±alamiento cl√≠nico de patrones de fijaci√≥n en uno de los polos (solo dolor o solo actividad), introducido como observaci√≥n descriptiva y no como cr√≠tica.`
    },

    {
      nombre:'Autorizar pausas del duelo',
      codigo:'m_dpm_pausas',
      procesos:['ED_ajusteMundoPerdidasSec'],
      texto:`Intervenci√≥n que legitima momentos de descanso emocional, distracci√≥n o disfrute sin vivirse como evitaci√≥n patol√≥gica ni traici√≥n al v√≠nculo.`
    },

    {
      nombre:'Dosificar contacto emocional',
      codigo:'m_dpm_dosificar',
      procesos:['ED_oscilacionTolerancia'],
      texto:`Ayuda a ajustar duraci√≥n e intensidad del contacto con el dolor, favoreciendo entradas breves y salidas seguras. Se usa especialmente en pacientes con tendencia a la inundaci√≥n emocional.`
    }
  ],

  refs:[
    'Stroebe, M. & Schut, H. (1999). The dual process model of coping with bereavement.',
    'Stroebe, M. & Schut, H. (2010). The dual process model of coping with bereavement: A decade on.'
  ]
},
{
  id:'k_klass_silverman_nickman_cb',
  grupo:'Integrativo',
  label:'Continuing Bonds (V√≠nculo continuo)',
  year:'1996',
  autores:'Dennis Klass, Phyllis Silverman & Steven Nickman',
  descripcion:`El modelo de Continuing Bonds propone que el duelo saludable no implica necesariamente desligarse emocionalmente de la persona perdida, sino transformar la relaci√≥n con ella. Frente a los modelos cl√°sicos que entend√≠an la resoluci√≥n del duelo como desapego, esta perspectiva sostiene que muchas personas mantienen v√≠nculos internos duraderos con quienes han perdido, y que dichos v√≠nculos pueden ser adaptativos o desadaptativos seg√∫n su forma.

El n√∫cleo cl√≠nico del modelo no es la presencia o ausencia del v√≠nculo, sino su reorganizaci√≥n. El sufrimiento se mantiene cuando el v√≠nculo permanece fijado a la ausencia externa (b√∫squeda, evitaci√≥n extrema o congelaci√≥n), mientras que la adaptaci√≥n se produce cuando el v√≠nculo se integra de forma flexible en la vida ps√≠quica, permitiendo recordar, dialogar simb√≥licamente y mantener un sentido de continuidad sin quedar atrapado en la p√©rdida.`,

  // =========================================================
  // MAPEO MJPS
  // =========================================================
  mjps:['ED'],

  subprocesos:[
    'ED_vinculoContinuo',
    'ED_expresionVinculada',
    'ED_identidadReinversion'
  ],

  // =========================================================
  // CONCEPTOS CLAVE DEL MODELO
  // =========================================================
  conceptos:[
    {
      nombre:'V√≠nculo continuo',
      descripcion:`Relaci√≥n interna y simb√≥lica con la persona perdida que puede mantenerse a lo largo del tiempo. El v√≠nculo no desaparece, sino que cambia de forma y funci√≥n dentro del sistema ps√≠quico.`
    },
    {
      nombre:'Reorganizaci√≥n del v√≠nculo',
      descripcion:`Proceso mediante el cual el v√≠nculo pasa de estar anclado a la presencia externa o a la ausencia dolorosa, a convertirse en una presencia interna integrada, flexible y reguladora.`
    },
    {
      nombre:'V√≠nculo adaptativo vs. desadaptativo',
      descripcion:`Un v√≠nculo es adaptativo cuando permite continuidad, sentido y regulaci√≥n emocional sin bloquear la vida actual; es desadaptativo cuando se asocia a b√∫squeda compulsiva, evitaci√≥n extrema, culpa intensa o congelaci√≥n identitaria.`
    }
  ],

  // =========================================================
  // PROCEDIMIENTOS ‚Äî CONTINUING BONDS (DESARROLLADOS)
  // =========================================================
  procedimientos:[
    {
      nombre:'Exploraci√≥n del v√≠nculo actual',
      codigo:'p_cb_exploracion_vinculo',
      procesos:['ED_vinculoContinuo'],
      texto:`Procedimiento cl√≠nico destinado a explorar c√≥mo se mantiene actualmente el v√≠nculo con la persona perdida. El terapeuta indaga si el v√≠nculo se expresa a trav√©s de recuerdos, objetos, rituales, pensamientos recurrentes, di√°logo interno o evitaci√≥n del recuerdo.

El objetivo es comprender la forma y funci√≥n del v√≠nculo, diferenciando entre presencia interna integrada y fijaci√≥n a la ausencia externa. Esta exploraci√≥n permite detectar bloqueos del duelo relacionados con b√∫squeda compulsiva, congelaci√≥n emocional o ruptura defensiva del v√≠nculo.`
    },

    {
      nombre:'Construcci√≥n de v√≠nculo simb√≥lico',
      codigo:'p_cb_vinculo_simbolico',
      procesos:['ED_vinculoContinuo'],
      texto:`Procedimiento orientado a facilitar la transici√≥n del v√≠nculo hacia una forma simb√≥lica e interna. Incluye la elaboraci√≥n de rituales, objetos simb√≥licos, cartas, conversaciones imaginadas o actos conmemorativos que permiten mantener la relaci√≥n sin depender de la presencia externa.

El trabajo no busca crear fantas√≠a ni negar la muerte, sino ofrecer un contenedor simb√≥lico que permita sostener el v√≠nculo de forma regulada y compatible con la vida actual.`
    },

    {
      nombre:'Diferenciaci√≥n entre recordar y quedar atrapado',
      codigo:'p_cb_diferenciar_recuerdo',
      procesos:['ED_vinculoContinuo'],
      texto:`Procedimiento cl√≠nico que ayuda a diferenciar entre recordar de forma integrada y quedar atrapado en la ausencia. Se exploran se√±ales de regulaci√≥n versus se√±ales de colapso, rumiaci√≥n o bloqueo vital asociadas al recuerdo.

Esta diferenciaci√≥n permite legitimar el recuerdo sin miedo a ‚Äúno salir‚Äù, reduciendo evitaci√≥n defensiva y favoreciendo una relaci√≥n m√°s flexible con la memoria.`
    },

    {
      nombre:'Integraci√≥n del legado relacional',
      codigo:'p_cb_legado',
      procesos:['ED_identidadReinversion'],
      texto:`Procedimiento destinado a explorar qu√© valores, aprendizajes, actitudes o formas de relaci√≥n permanecen como legado de la persona perdida. El v√≠nculo se integra as√≠ en la identidad actual, no como mandato r√≠gido, sino como fuente de continuidad y sentido.

Este trabajo facilita la reinversi√≥n vital al permitir que el pasado nutra el presente sin gobernarlo.`
    }
  ],

  // =========================================================
  // MICROINTERVENCIONES ‚Äî CONTINUING BONDS (DESARROLLADAS)
  // =========================================================
  micros:[
    {
      nombre:'Validar el v√≠nculo continuo',
      codigo:'m_cb_validar_vinculo',
      procesos:['ED_vinculoContinuo'],
      texto:`Intervenci√≥n breve que normaliza la existencia de un v√≠nculo interno con la persona perdida, reduciendo culpa y temor a estar ‚Äúduelando mal‚Äù.`
    },

    {
      nombre:'Detectar b√∫squeda externa',
      codigo:'m_cb_busqueda',
      procesos:['ED_vinculoContinuo'],
      texto:`Se√±alamiento cl√≠nico de conductas de b√∫squeda compulsiva (objetos, lugares, se√±ales) que indican fijaci√≥n a la ausencia externa y bloqueo del proceso de reorganizaci√≥n del v√≠nculo.`
    },

    {
      nombre:'Autorizar recuerdo regulado',
      codigo:'m_cb_recuerdo_regulado',
      procesos:['ED_vinculoContinuo'],
      texto:`Microintervenci√≥n que legitima el recuerdo cuando este cumple una funci√≥n reguladora y no desorganizante, reduciendo evitaci√≥n del recuerdo por miedo a desbordarse.`
    },

    {
      nombre:'Desacoplar lealtad de sufrimiento',
      codigo:'m_cb_lealtad',
      procesos:['ED_identidadReinversion'],
      texto:`Intervenci√≥n destinada a diferenciar la lealtad al v√≠nculo de la obligaci√≥n de sufrir. Ayuda a liberar la reinversi√≥n vital de mandatos impl√≠citos de dolor perpetuo.`
    }
  ],

  refs:[
    'Klass, D., Silverman, P. R., & Nickman, S. (1996). Continuing Bonds: New Understandings of Grief.',
    'Klass, D. (2014). Continuing bonds in the resolution of grief.'
  ]
},
{
  id:'k_neimeyer_meaning',
  grupo:'Constructivista',
  label:'Meaning Reconstruction in Grief',
  year:'2001',
  autores:'Robert A. Neimeyer',
  descripcion:`El modelo de Reconstrucci√≥n de Significado concibe el duelo como una crisis profunda del sistema de significados personales que organiza la identidad, la narrativa vital y la relaci√≥n con el mundo. La p√©rdida no solo genera dolor emocional, sino que puede desestabilizar supuestos b√°sicos sobre qui√©n soy, c√≥mo funciona el mundo, qu√© puedo esperar de los dem√°s y qu√© sentido tiene seguir viviendo. Desde esta perspectiva, el sufrimiento persistente no se explica √∫nicamente por la intensidad del apego o del afecto, sino por la dificultad para integrar la p√©rdida en una narrativa coherente que permita continuidad biogr√°fica. El trabajo terap√©utico se orienta a acompa√±ar la reconstrucci√≥n de significado e identidad de forma gradual, situada y no prescriptiva, evitando tanto el vac√≠o de sentido prolongado como la imposici√≥n prematura de narrativas tranquilizadoras.`,

  // =========================================================
  // MAPEO MJPS
  // =========================================================
  mjps:['ED','N','I'],

  subprocesos:[
    'ED_identidadReinversion',
    'ED_vinculoContinuo',
    'N_construccionSignificado',
    'I_continuidadIdentitaria'
  ],

  // =========================================================
  // CONCEPTOS CLAVE DEL MODELO (DESARROLLADOS)
  // =========================================================
  conceptos:[
    {
      nombre:'Crisis de significado',
      descripcion:`La crisis de significado se refiere a la ruptura de los marcos interpretativos que daban coherencia a la experiencia antes de la p√©rdida. La persona puede sentir que las explicaciones previas sobre justicia, control, previsibilidad o identidad dejan de funcionar, generando desorientaci√≥n, vac√≠o o sensaci√≥n de irrealidad. Esta crisis no es un fallo del duelo, sino una consecuencia natural de p√©rdidas que desaf√≠an supuestos centrales. El riesgo cl√≠nico aparece cuando esta ruptura queda silenciada o se intenta cerrar prematuramente, impidiendo la elaboraci√≥n aut√©ntica del impacto existencial de la p√©rdida.`
    },
    {
      nombre:'Reconstrucci√≥n narrativa',
      descripcion:`La reconstrucci√≥n narrativa es el proceso mediante el cual la persona reorganiza su historia vital para integrar la p√©rdida sin borrar el pasado ni quedar fijada a √©l. Implica revisar la narrativa del v√≠nculo perdido, del self y del futuro posible, articulando continuidades y transformaciones. No se trata de ‚Äúcontar una historia positiva‚Äù, sino de construir una narrativa habitable, capaz de sostener ambivalencia, dolor y cambio. La narrativa se vuelve terap√©uticamente relevante cuando permite pasar del colapso del sentido a una comprensi√≥n m√°s compleja y vivible de la propia trayectoria.`
    },
    {
      nombre:'Continuidad identitaria',
      descripcion:`La continuidad identitaria hace referencia a la capacidad de mantener un sentido de identidad relativamente coherente a lo largo del tiempo, incluso tras una p√©rdida que transforma profundamente la vida. En el duelo, esta continuidad suele verse amenazada por la sensaci√≥n de que ‚Äúya no soy quien era‚Äù o de que el futuro queda cancelado. El trabajo cl√≠nico no busca restaurar la identidad previa, sino facilitar una integraci√≥n que conecte qui√©n se era antes, qui√©n se es ahora y qui√©n se puede llegar a ser, permitiendo una identidad transformada pero reconocible.`
    }
  ],

  // =========================================================
  // PROCEDIMIENTOS ‚Äî MEANING RECONSTRUCTION (DESARROLLADOS)
  // =========================================================
  procedimientos:[
    {
      nombre:'Exploraci√≥n de la ruptura de sentido',
      codigo:'p_nei_ruptura_sentido',
      procesos:['N_construccionSignificado'],
      texto:`Procedimiento cl√≠nico orientado a explorar c√≥mo la p√©rdida ha invalidado o puesto en crisis los supuestos fundamentales del paciente sobre el mundo y sobre s√≠ mismo. El terapeuta invita a identificar qu√© creencias, expectativas o narrativas previas han quedado da√±adas ‚Äîpor ejemplo, ideas de justicia, control, previsibilidad, identidad o prop√≥sito‚Äî, legitimando la experiencia de desconcierto. El objetivo no es ofrecer respuestas tranquilizadoras ni reinterpretaciones positivas, sino dar espacio a la desorientaci√≥n como parte necesaria del proceso de reconstrucci√≥n de significado.`
    },

    {
      nombre:'Reconstrucci√≥n narrativa del self',
      codigo:'p_nei_narrativa_self',
      procesos:['ED_identidadReinversion'],
      texto:`Procedimiento destinado a reorganizar la narrativa personal tras la p√©rdida, integrando los cambios identitarios que esta ha provocado. Se explora c√≥mo la persona se define ahora, qu√© aspectos de su identidad se han visto amenazados o transformados y cu√°les permanecen. El terapeuta acompa√±a la construcci√≥n de una narrativa flexible que conecte pasado, presente y futuro posible, evitando tanto la fijaci√≥n nost√°lgica al self previo como la reinvenci√≥n forzada que desconoce el impacto real de la p√©rdida.`
    },

    {
      nombre:'Di√°logo narrativo con la p√©rdida',
      codigo:'p_nei_dialogo_perdida',
      procesos:['ED_vinculoContinuo','N_construccionSignificado'],
      texto:`Procedimiento que facilita un di√°logo simb√≥lico con la experiencia de la p√©rdida o con la figura perdida para explorar su significado en la historia vital. A trav√©s de cartas, relatos o preguntas guiadas, se examina qu√© representa la p√©rdida, qu√© ha cambiado de forma irreversible y qu√© elementos del v√≠nculo pueden mantenerse de forma transformada. Este di√°logo no busca consuelo inmediato, sino profundizar en la comprensi√≥n del impacto existencial de la p√©rdida y su lugar en la narrativa personal.`
    },

    {
      nombre:'Exploraci√≥n de significado emergente',
      codigo:'p_nei_significado_emergente',
      procesos:['N_construccionSignificado','ED_identidadReinversion'],
      texto:`Procedimiento orientado a identificar significados que emergen progresivamente del proceso de duelo, sin imponer narrativas de crecimiento ni lecturas positivas obligatorias. Se exploran cambios sutiles en valores, prioridades, sensibilidad o direcci√≥n vital que aparecen de forma no planificada. El terapeuta ayuda a poner palabras a estos significados cuando surgen espont√°neamente, cuidando de no convertir el sentido en una exigencia defensiva frente al dolor.`
    }
  ],

  // =========================================================
  // MICROINTERVENCIONES ‚Äî MEANING RECONSTRUCTION (DESARROLLADAS)
  // =========================================================
  micros:[
    {
      nombre:'Validar la p√©rdida de sentido',
      codigo:'m_nei_validar_sinsentido',
      procesos:['N_construccionSignificado'],
      texto:`Microintervenci√≥n que legitima expl√≠citamente la experiencia de vac√≠o, confusi√≥n o sinsentido como una respuesta esperable ante p√©rdidas que desorganizan los marcos vitales. Reduce la presi√≥n interna y externa por encontrar explicaciones r√°pidas y protege el proceso de cierres prematuros.`
    },

    {
      nombre:'Preguntas narrativas abiertas',
      codigo:'m_nei_preguntas_narrativas',
      procesos:['N_construccionSignificado'],
      texto:`Uso de preguntas amplias y no directivas que invitan a explorar c√≥mo la p√©rdida ha alterado la forma de verse a s√≠ mismo y al mundo. Estas preguntas abren espacio a la reflexi√≥n sin imponer direcciones interpretativas ni soluciones.`
    },

    {
      nombre:'Diferenciar sentido de consuelo',
      codigo:'m_nei_diferenciar',
      procesos:['N_construccionSignificado'],
      texto:`Intervenci√≥n breve destinada a distinguir entre explicaciones que tranquilizan emocionalmente y significados aut√©nticos que integran el impacto real de la p√©rdida. Previene que el sentido funcione como defensa o evitaci√≥n del dolor.`
    },

    {
      nombre:'Anclar continuidad identitaria',
      codigo:'m_nei_continuidad',
      procesos:['ED_identidadReinversion'],
      texto:`Microintervenci√≥n que ayuda a conectar aspectos del self previo a la p√©rdida con el self actual, facilitando una sensaci√≥n de continuidad biogr√°fica a pesar de la transformaci√≥n.`
    },

    {
      nombre:'Autorizar significados ambivalentes',
      codigo:'m_nei_ambivalencia_sentido',
      procesos:['N_construccionSignificado'],
      texto:`Intervenci√≥n que legitima la coexistencia de significados contradictorios ‚Äîdolor persistente junto a nuevas direcciones vitales‚Äî evitando simplificaciones narrativas que empobrecen la elaboraci√≥n del duelo.`
    }
  ],

  refs:[
    'Neimeyer, R. A. (2001). Meaning Reconstruction and the Experience of Loss.',
    'Neimeyer, R. A. (2016). Techniques of Grief Therapy.',
    'Neimeyer, R. A. (2019). Meaning reconstruction in bereavement.'
  ]
},
{
  id:'k_rubin_two_track',
  grupo:'Integrativo',
  label:'Two-Track Model of Bereavement',
  year:'1981',
  autores:'Simon Shimshon Rubin',
  descripcion:`El Two-Track Model de Rubin propone que el duelo debe evaluarse y abordarse simult√°neamente en dos planos relativamente independientes pero interrelacionados: el funcionamiento biopsicosocial general de la persona (Track I) y la relaci√≥n continua con la persona fallecida (Track II). Frente a modelos que colapsan el duelo en un √∫nico eje, Rubin muestra que una persona puede funcionar adecuadamente en la vida cotidiana mientras mantiene un v√≠nculo interno profundamente perturbador, o viceversa. El modelo aporta una matriz cl√≠nica clara para evitar reduccionismos, permitiendo discriminar d√≥nde est√° el bloqueo real del proceso y ajustar la intervenci√≥n sin confundir adaptaci√≥n externa con elaboraci√≥n interna del v√≠nculo.`,

  // =========================================================
  // MAPEO MJPS
  // =========================================================
  mjps:['ED'],

  // Nota de revisi√≥n:
  // - Mantengo estos subprocesos porque encajan con Track I (ajuste/funcionamiento)
  //   y Track II (v√≠nculo) y el puente identitario (reinversi√≥n).
  // - Si quieres afinar m√°s, Track I tambi√©n puede rozar ED_oscilacionTolerancia,
  //   pero no es imprescindible para el modelo base.
  subprocesos:[
    'ED_ajusteMundoPerdidasSec',
    'ED_vinculoContinuo',
    'ED_identidadReinversion'
  ],

  // =========================================================
  // CONCEPTOS CLAVE DEL MODELO (DESARROLLADOS)
  // =========================================================
  conceptos:[
    {
      nombre:'Track I ‚Äî Funcionamiento biopsicosocial',
      codigo:'c_rubin_track1', // normalizado para referencias internas
      descripcion:`El Track I se refiere al nivel de funcionamiento general de la persona en √°reas como salud f√≠sica, estado emocional, desempe√±o laboral o acad√©mico, relaciones sociales, rutinas cotidianas y capacidad de autorregulaci√≥n. Este plano eval√∫a c√≥mo la persona est√° viviendo y funcionando en el mundo tras la p√©rdida, sin asumir que un buen funcionamiento externo implique necesariamente una elaboraci√≥n saludable del duelo. Cl√≠nicamente, el Track I permite detectar desorganizaci√≥n funcional significativa, pero tambi√©n previene interpretar la funcionalidad como ‚Äúresoluci√≥n‚Äù del duelo.`
    },
    {
      nombre:'Track II ‚Äî Relaci√≥n con el fallecido',
      codigo:'c_rubin_track2', // normalizado para referencias internas
      descripcion:`El Track II se centra en la relaci√≥n psicol√≥gica continua con la persona fallecida, incluyendo recuerdos, emociones, representaciones internas, di√°logos imaginarios, idealizaci√≥n, culpa, rabia o evitaci√≥n del recuerdo. Este plano eval√∫a la calidad, flexibilidad e integraci√≥n del v√≠nculo interno, independientemente del funcionamiento externo. Rubin subraya que muchos duelos problem√°ticos se sostienen en alteraciones del Track II que pasan desapercibidas si solo se observa la adaptaci√≥n conductual o social.`
    },
    {
      nombre:'Evaluaci√≥n en dos ejes',
      codigo:'c_rubin_2tracks', // normalizado para referencias internas
      descripcion:`El valor cl√≠nico central del modelo reside en la evaluaci√≥n simult√°nea e independiente de ambos tracks. Esta evaluaci√≥n bidimensional evita diagn√≥sticos simplistas y permite identificar perfiles diferenciados de duelo: buen funcionamiento con v√≠nculo perturbador, v√≠nculo integrado con deterioro funcional, dificultades en ambos planos o adaptaci√≥n saludable en los dos. Esta matriz orienta decisiones cl√≠nicas precisas y previene intervenciones desajustadas.`
    }
  ],

  // =========================================================
  // PROCEDIMIENTOS ‚Äî TWO-TRACK MODEL (DESARROLLADOS)
  // =========================================================
  procedimientos:[
    {
      nombre:'Evaluaci√≥n diferenciada de los dos tracks',
      codigo:'p_rubin_eval_tracks', // acortado/normalizado; evita nombres demasiado largos
      procesos:['ED_ajusteMundoPerdidasSec','ED_vinculoContinuo'],
      texto:`Procedimiento cl√≠nico que consiste en evaluar de forma expl√≠cita y separada el funcionamiento cotidiano (Track I) y la relaci√≥n con el fallecido (Track II). El terapeuta explora indicadores funcionales ‚Äîrutinas, relaciones, autocuidado, rendimiento‚Äî junto con indicadores vinculares ‚Äîrecuerdos, emociones, di√°logo interno, evitaci√≥n o b√∫squeda‚Äî, evitando inferencias autom√°ticas entre ambos planos. Esta evaluaci√≥n clarifica el foco real de la intervenci√≥n y previene errores cl√≠nicos basados en la apariencia de adaptaci√≥n.`
    },

    {
      nombre:'Intervenci√≥n focalizada por track',
      codigo:'p_rubin_track_focal',
      procesos:['ED_ajusteMundoPerdidasSec','ED_vinculoContinuo'],
      texto:`Procedimiento que ajusta la intervenci√≥n al track prioritario identificado. Cuando el bloqueo principal est√° en el Track I, se priorizan apoyos pr√°cticos, regulaci√≥n y reorganizaci√≥n vital; cuando est√° en el Track II, se trabaja la relaci√≥n interna con el fallecido. El modelo evita forzar intervenciones emocionales profundas cuando el problema principal es funcional, o centrarse solo en lo pr√°ctico cuando el v√≠nculo interno permanece desorganizado.`
    },

    {
      nombre:'Integraci√≥n progresiva de ambos tracks',
      codigo:'p_rubin_track_integracion',
      procesos:['ED_identidadReinversion'],
      texto:`Procedimiento orientado a facilitar la integraci√≥n gradual entre funcionamiento y v√≠nculo, de modo que la vida cotidiana y la relaci√≥n interna con el fallecido puedan coexistir sin interferirse mutuamente. Se acompa√±a la construcci√≥n de una identidad que incluya tanto la continuidad del v√≠nculo como la capacidad de vivir, decidir y comprometerse en el presente.`
    }
  ],

  // =========================================================
  // MICROINTERVENCIONES ‚Äî TWO-TRACK MODEL (DESARROLLADAS)
  // =========================================================
  micros:[
    {
      nombre:'Diferenciar funcionamiento de elaboraci√≥n',
      codigo:'m_rubin_func_vs_elab',
      procesos:['ED_ajusteMundoPerdidasSec'],
      texto:`Microintervenci√≥n que ayuda a distinguir expl√≠citamente entre ‚Äúfuncionar‚Äù y ‚Äúhaber elaborado‚Äù, evitando interpretaciones err√≥neas del progreso terap√©utico basadas √∫nicamente en el desempe√±o externo.`
    },

    {
      nombre:'Detectar disociaci√≥n entre tracks',
      codigo:'m_rubin_track_gap',
      procesos:['ED_vinculoContinuo'],
      texto:`Se√±alamiento cl√≠nico de discrepancias significativas entre el Track I y el Track II, introducido como observaci√≥n descriptiva que orienta el foco del trabajo terap√©utico.`
    },

    {
      nombre:'Validar adaptaci√≥n parcial',
      codigo:'m_rubin_adapt_parcial',
      procesos:['ED_identidadReinversion'],
      texto:`Intervenci√≥n que legitima que una persona pueda estar adapt√°ndose en un plano mientras sigue en proceso en otro, reduciendo autoexigencia y lecturas dicot√≥micas de √©xito/fracaso.`
    }
  ],

  refs:[
    'Rubin, S. S. (1981). A two-track model of bereavement.',
    'Rubin, S. S. (1999). The two-track model of bereavement.',
    'Rubin, S. S., Malkinson, R., & Witztum, E. (2011). Working with the bereaved.'
  ]
},

{
  id:'k_rando_r_processes',
  grupo:'Integrativo',
  label:'Procesos del duelo (R Processes)',
  year:'1984',
  autores:'Therese A. Rando',
  descripcion:`El modelo de los ‚ÄúR Processes‚Äù de Therese Rando concibe el duelo como un conjunto de procesos psicol√≥gicos interrelacionados que la persona necesita atravesar para integrar una p√©rdida significativa. A diferencia de modelos por etapas, Rando describe funciones cl√≠nicas que pueden activarse, bloquearse o reactivarse a lo largo del tiempo. Su enfoque es especialmente √∫til para el trabajo terap√©utico porque permite identificar con precisi√≥n qu√© aspecto del duelo est√° comprometido ‚Äîreconocimiento, reacci√≥n emocional, recuerdo, renuncia, reajuste o reinversi√≥n‚Äî sin imponer una secuencia fija. El modelo destaca que el duelo problem√°tico suele deberse a bloqueos espec√≠ficos en alguno de estos procesos m√°s que a una ‚Äúmala evoluci√≥n global‚Äù.`,

  // =========================================================
  // MAPEO MJPS
  // =========================================================
  mjps:['ED'],

  subprocesos:[
    'ED_reconocimiento',
    'ED_oscilacionTolerancia',
    'ED_expresionVinculada',
    'ED_ajusteMundoPerdidasSec',
    'ED_vinculoContinuo',
    'ED_identidadReinversion'
  ],

  // =========================================================
  // PROCESOS R ‚Äî (C√ìDIGOS NORMALIZADOS PARA ASIGNACIONES)
  // Prefijo "r_rando_" para diferenciar de p_/m_ y evitar colisiones
  // =========================================================
  procesosR:[
    {
      nombre:'Reconocer la p√©rdida',
      codigo:'r_rando_recognize',
      ed:['ED_reconocimiento'],
      descripcion:`Proceso mediante el cual la persona llega a reconocer plenamente la realidad, irreversibilidad y significado de la p√©rdida. Incluye tanto el reconocimiento cognitivo como el impacto emocional, y se ve obstaculizado por negaci√≥n persistente, minimizaci√≥n, intelectualizaci√≥n o fantas√≠as de reversi√≥n. Rando subraya que sin este reconocimiento, los procesos posteriores quedan debilitados o se convierten en pseudoelaboraciones.`
    },
    {
      nombre:'Reaccionar a la p√©rdida',
      codigo:'r_rando_react',
      ed:['ED_oscilacionTolerancia','ED_expresionVinculada'],
      descripcion:`Proceso que implica experimentar y expresar las respuestas emocionales, cognitivas y f√≠sicas a la p√©rdida. Incluye tristeza, rabia, culpa, alivio, ansiedad y desorganizaci√≥n som√°tica. La reacci√≥n saludable no se define por intensidad, sino por la capacidad de oscilar entre contacto y regulaci√≥n. La inhibici√≥n cr√≥nica o la inundaci√≥n emocional prolongada indican bloqueos en este proceso.`
    },
    {
      nombre:'Recordar y reexperimentar',
      codigo:'r_rando_recollect',
      ed:['ED_vinculoContinuo'],
      descripcion:`Proceso mediante el cual la persona puede recordar y reexperimentar la relaci√≥n con lo perdido de forma integrada, sin evitaci√≥n ni fijaci√≥n traum√°tica. Incluye recuerdos positivos y negativos, momentos compartidos y representaciones internas. El objetivo no es borrar recuerdos, sino permitir que se integren como parte de la historia vital sin desorganizar el presente.`
    },
    {
      nombre:'Renunciar a viejos apegos y asunciones',
      codigo:'r_rando_relinquish',
      ed:['ED_ajusteMundoPerdidasSec','ED_identidadReinversion'],
      descripcion:`Proceso que implica soltar expectativas, roles, proyectos y supuestos vitales que ya no pueden sostenerse tras la p√©rdida. Esta renuncia no es olvido ni traici√≥n, sino un reajuste necesario para vivir en un mundo transformado. Los bloqueos aparecen cuando la persona se aferra r√≠gidamente a c√≥mo ‚Äúdeber√≠a haber sido‚Äù la vida.`
    },
    {
      nombre:'Reajustarse a un mundo sin lo perdido',
      codigo:'r_rando_readjust',
      ed:['ED_ajusteMundoPerdidasSec'],
      descripcion:`Proceso centrado en la adaptaci√≥n pr√°ctica, relacional y psicol√≥gica a la vida cotidiana tras la p√©rdida. Incluye asumir nuevos roles, reorganizar rutinas, redefinir relaciones y reconstruir sensaci√≥n de competencia. Rando subraya que este reajuste es un proceso activo que requiere apoyo y no debe confundirse con evitaci√≥n emocional.`
    },
    {
      nombre:'Reinvertir en la vida',
      codigo:'r_rando_reinvest',
      ed:['ED_identidadReinversion'],
      descripcion:`Proceso mediante el cual la persona vuelve a invertir energ√≠a emocional en v√≠nculos, proyectos y actividades significativas, sin borrar la relaci√≥n con lo perdido. La reinversi√≥n saludable implica autorizar el deseo y el compromiso vital sin culpa ni vivencias de deslealtad, integrando pasado y presente en una identidad renovada.`
    }
  ],

  // =========================================================
  // PROCEDIMIENTOS ‚Äî RANDO
  // =========================================================
  procedimientos:[
    {
      nombre:'Evaluaci√≥n de bloqueos por proceso',
      codigo:'p_rando_evaluacion',
      procesos:['ED'],
      texto:`Procedimiento cl√≠nico que consiste en evaluar de forma sistem√°tica en qu√© procesos del duelo (reconocer, reaccionar, recordar, renunciar, reajustar, reinvertir) existen bloqueos, evitaciones o rigideces. Esta evaluaci√≥n permite formular el caso de manera precisa y orientar la intervenci√≥n sin asumir que todo el duelo est√° detenido.`
    },
    {
      nombre:'Facilitaci√≥n secuencial flexible',
      codigo:'p_rando_facilitacion',
      procesos:['ED'],
      texto:`Procedimiento que acompa√±a el despliegue de los procesos del duelo de forma flexible, respetando el orden funcional pero no imponiendo una secuencia r√≠gida. El terapeuta prioriza el proceso bloqueado sabiendo que otros pueden reactivarse posteriormente.`
    }
  ],

  // =========================================================
  // MICROINTERVENCIONES ‚Äî RANDO
  // =========================================================
  micros:[
    {
      nombre:'Detectar pseudoelaboraci√≥n',
      codigo:'m_rando_pseudo',
      procesos:['ED_reconocimiento'],
      texto:`Intervenci√≥n destinada a identificar aparentes avances del duelo que en realidad encubren negaci√≥n, evitaci√≥n o resignaci√≥n defensiva.`
    },
    {
      nombre:'Normalizar reacciones complejas',
      codigo:'m_rando_normalizar',
      procesos:['ED_expresionVinculada'],
      texto:`Microintervenci√≥n que valida la coexistencia de reacciones emocionales contradictorias sin jerarquizarlas ni moralizarlas.`
    },
    {
      nombre:'Autorizar renuncia sin traici√≥n',
      codigo:'m_rando_renuncia',
      procesos:['ED_identidadReinversion'],
      texto:`Intervenci√≥n breve que legitima soltar expectativas y proyectos imposibles sin vivirse como abandono del v√≠nculo perdido.`
    }
  ],

  refs:[
    'Rando, T. A. (1984). Grieving: How to Go On Living When Someone You Love Dies.',
    'Rando, T. A. (1993). Treatment of Complicated Mourning.',
    'Rando, T. A. (2018). Grief and Mourning: Accommodating to Loss.'
  ]
},
,
{
  id:'k_shear_cgt',
  grupo:'Integrativo',
  label:'Complicated Grief Treatment (CGT)',
  year:'2005',
  autores:'Katherine Shear',
  descripcion:`El modelo de Complicated Grief Treatment (CGT) conceptualiza el duelo prolongado como una alteraci√≥n espec√≠fica del proceso natural de elaboraci√≥n de la p√©rdida, caracterizada por bloqueos persistentes en la integraci√≥n de la irreversibilidad, una activaci√≥n sostenida del sistema de apego y patrones de evitaci√≥n experiencial que impiden la reorganizaci√≥n del v√≠nculo y la reinversi√≥n vital. A diferencia de enfoques generales del duelo, CGT ofrece un protocolo cl√≠nico estructurado y basado en evidencia para intervenir cuando el duelo no progresa de forma espont√°nea.

Desde la perspectiva del MJPS, CGT no introduce un proceso nuevo, sino que describe una **desviaci√≥n cl√≠nica del macroproceso ED**, en la que varios subprocesos quedan cr√≥nicamente bloqueados. El objetivo del tratamiento es desbloquear estos subprocesos mediante intervenciones activas, dosificadas y sostenidas, respetando la ventana de tolerancia y evitando tanto la evitaci√≥n cr√≥nica como la exposici√≥n desorganizante.`,

  // =========================================================
  // MAPEO MJPS
  // =========================================================
  mjps:['ED'],

  subprocesos:[
    'ED_reconocimiento',
    'ED_oscilacionTolerancia',
    'ED_expresionVinculada',
    'ED_vinculoContinuo',
    'ED_identidadReinversion'
  ],

  // =========================================================
  // CONCEPTOS CLAVE DEL MODELO (NORMALIZADOS)
  // =========================================================
  conceptos:[
    {
      nombre:'Duelo prolongado',
      codigo:'c_cgt_dueloProlongado',
      descripcion:`Condici√≥n cl√≠nica en la que el dolor por la p√©rdida permanece intenso, dominante y poco modulable a lo largo del tiempo, interfiriendo de forma significativa en el funcionamiento vital y la identidad. Se caracteriza por a√±oranza persistente, dificultad para aceptar la irreversibilidad, evitaci√≥n del recuerdo, culpa intensa, aislamiento y bloqueo de la reinversi√≥n vital. CGT entiende este cuadro como un fallo en la integraci√≥n del duelo, no como debilidad personal ni falta de motivaci√≥n.`
    },
    {
      nombre:'Bloqueo del sistema de apego',
      codigo:'c_cgt_apegoBloqueado',
      descripcion:`Activaci√≥n persistente del sistema de apego orientada a la figura perdida, que se manifiesta en b√∫squeda mental constante, rumiaci√≥n, protesta emocional o evitaci√≥n extrema del recuerdo. Este bloqueo impide que el v√≠nculo se reorganice de forma interna y flexible, manteniendo a la persona atrapada entre anhelo intenso y evitaci√≥n defensiva.`
    },
    {
      nombre:'Evitaci√≥n experiencial',
      codigo:'c_cgt_evitacion',
      descripcion:`Conjunto de estrategias cognitivas, emocionales y conductuales destinadas a evitar el contacto con el dolor de la p√©rdida. Aunque reducen el malestar a corto plazo, mantienen el duelo prolongado al impedir el reconocimiento emocional de la irreversibilidad y la integraci√≥n progresiva del v√≠nculo.`
    }
  ],

  // =========================================================
  // PROCEDIMIENTOS ‚Äî CGT (C√ìDIGOS NORMALIZADOS)
  // =========================================================
  procedimientos:[
    {
      nombre:'Psicoeducaci√≥n sobre duelo prolongado',
      codigo:'p_cgt_psicoeducacion',
      procesos:['ED'],
      texto:`Procedimiento inicial que explica el duelo prolongado como un bloqueo del proceso natural de elaboraci√≥n, normalizando la experiencia del paciente y reduciendo culpa, verg√ºenza y autoacusaci√≥n. Se clarifica que el tratamiento no busca olvidar ni ‚Äúsuperar‚Äù la p√©rdida, sino integrar la realidad de la muerte y reorganizar la vida sin perder el v√≠nculo interno.`
    },

    {
      nombre:'Exposici√≥n imaginada a la p√©rdida',
      codigo:'p_cgt_exposicion_imaginada',
      procesos:['ED_reconocimiento','ED_oscilacionTolerancia'],
      texto:`Procedimiento central de CGT que gu√≠a al paciente a revivir de forma imaginada y dosificada el momento de la muerte o el impacto de la p√©rdida. Facilita el reconocimiento emocional de la irreversibilidad y reduce la evitaci√≥n, siempre dentro de una alianza s√≥lida y cuidando la ventana de tolerancia.`
    },

    {
      nombre:'Exposici√≥n situacional',
      codigo:'p_cgt_exposicion_situacional',
      procesos:['ED_oscilacionTolerancia'],
      texto:`Procedimiento dirigido a abordar la evitaci√≥n de lugares, objetos o actividades asociadas a la persona fallecida. La exposici√≥n progresiva permite recuperar espacios vitales sin desorganizaci√≥n emocional y restablecer la capacidad de oscilar entre contacto con la p√©rdida y restauraci√≥n.`
    },

    {
      nombre:'Trabajo con el v√≠nculo persistente',
      codigo:'p_cgt_vinculo',
      procesos:['ED_vinculoContinuo','ED_expresionVinculada'],
      texto:`Procedimiento destinado a transformar la relaci√≥n con la persona fallecida de una presencia externa anhelada a un v√≠nculo interno integrado. Incluye di√°logos imaginarios, cartas y elaboraci√≥n de emociones no resueltas, facilitando la reorganizaci√≥n del v√≠nculo sin ruptura abrupta.`
    },

    {
      nombre:'Restauraci√≥n de objetivos vitales',
      codigo:'p_cgt_reinversion',
      procesos:['ED_identidadReinversion'],
      texto:`Procedimiento orientado a reactivar proyectos, relaciones y compromisos vitales que quedaron congelados tras la p√©rdida. Se trabaja expl√≠citamente la culpa asociada al bienestar y la vivencia de traici√≥n, promoviendo una reinversi√≥n gradual, coherente y no forzada.`
    }
  ],

  // =========================================================
  // MICROINTERVENCIONES ‚Äî CGT
  // =========================================================
  micros:[
    {
      nombre:'Nombrar el bloqueo del duelo',
      codigo:'m_cgt_bloqueo',
      procesos:['ED_reconocimiento'],
      texto:`Microintervenci√≥n que ayuda a conceptualizar el duelo prolongado como un proceso bloqueado y no como una incapacidad personal, reduciendo verg√ºenza y aumentando disposici√≥n al trabajo terap√©utico.`
    },

    {
      nombre:'Reducir evitaci√≥n protectora',
      codigo:'m_cgt_evitacion',
      procesos:['ED_oscilacionTolerancia'],
      texto:`Intervenci√≥n breve que se√±ala c√≥mo la evitaci√≥n, aunque protectora a corto plazo, mantiene el dolor a largo plazo, facilitando una apertura gradual al contacto emocional.`
    },

    {
      nombre:'Validar v√≠nculo sin presencia',
      codigo:'m_cgt_validar_vinculo',
      procesos:['ED_vinculoContinuo'],
      texto:`Microintervenci√≥n que legitima la continuidad del v√≠nculo sin necesidad de presencia externa, reduciendo miedo a olvidar o a traicionar a la persona perdida.`
    },

    {
      nombre:'Autorizar vida con duelo',
      codigo:'m_cgt_autorizar_vida',
      procesos:['ED_identidadReinversion'],
      texto:`Intervenci√≥n que legitima una vida significativa que incluye recuerdo y dolor, pero no queda definida exclusivamente por ellos.`
    }
  ],

  refs:[
    'Shear, K. et al. (2005). Treatment of Complicated Grief.',
    'Shear, K. (2012). Grief and mourning gone awry.',
    'Shear, K. (2021). Complicated Grief Treatment.'
  ]
},
{
  id:'k_kublerross69',
  grupo:'Transversal',
  label:'Modelo de K√ºbler-Ross (estados frecuentes ante la p√©rdida)',
  year:'1969',
  autores:'Elisabeth K√ºbler-Ross',
  descripcion:`El modelo de K√ºbler-Ross describe un conjunto de respuestas emocionales frecuentes ante la experiencia de p√©rdida ‚Äînegaci√≥n, ira, negociaci√≥n, tristeza/depresi√≥n y aceptaci√≥n‚Äî originalmente observadas en pacientes terminales y luego aplicadas al duelo en general. No est√° concebido como una secuencia r√≠gida ni como un mapa de progreso obligatorio: las reacciones pueden aparecer, solaparse o volver a surgir en cualquier orden. Su valor cl√≠nico est√° en aportar lenguaje, normalizaci√≥n y contexto humanizador al dolor y a la adaptaci√≥n emocional ante p√©rdidas significativas.`,
 "isMarco": true,
 // =========================================================
  // ALIANZA TERAP√âUTICA EN K√úBLER-ROSS
  // =========================================================
  alianzaModelo:{
    ALI_vinculo:`
El v√≠nculo terap√©utico se fortalece cuando la psicoeducaci√≥n se usa para validar experiencias emocionales y situarlas como respuestas humanas comprensibles, evitando moralizaciones. El modelo act√∫a como puente comunicativo entre experiencia y significado.`,  
    ALI_objetivos:`
Los objetivos se centran en aumentar la conciencia emocional, validar la amplitud de reacciones y normalizar la variabilidad individual del duelo. Se evita utilizar el modelo como meta de ‚Äúavance‚Äù obligatorio.`,  
    ALI_tareas:`
Se utilizan exploraciones guiadas de cada estado emocional para facilitar la identificaci√≥n de experiencias internas, sin exigir que ‚Äúse pasen‚Äù etapas. El trabajo se orienta a integrar el lenguaje con la experiencia vivida.`,  
    ALI_colaboracion:`
Se colabora en mapear reacciones, identificando disparadores y patrones, y en el uso compartido de t√©rminos para hablar de experiencias dolorosas con menos confusi√≥n.`,  
    ALI_sintonia:`
La sinton√≠a se expresa ajustando la psicoeducaci√≥n al ritmo del paciente: a veces solo se puede nombrar el estado sin profundizar emocionalmente, lo cual se respeta.`,  
    ALI_rupturaReparacion:`
Si surge frustraci√≥n por ‚Äúno avanzar de etapa‚Äù, se reformula enseguida la no linealidad del modelo y se reanuda el di√°logo cl√≠nico centrado en procesos subyacentes.`,  
    ALI_monitorizacion:`
Se monitoriza la aparici√≥n de estados y rigideces (p. ej., fijaci√≥n en ira o negaci√≥n), para decidir posteriormente intervenciones m√°s profundas alineadas con procesos ED.`,  
    ALI_contexto:`
Se reconoce c√≥mo factores culturales y relacionales (normas sobre llorar, expresar rabia o hablar de la muerte) influyen en qu√© estados aparecen y c√≥mo se expresan.`
  },

  neimeyer:{
    epistemologico:`El modelo ofrece categor√≠as descriptivas para estados de experiencia emocional ante p√©rdida, sin pretender explicar mecanismos de cambio.`,  
    teoriaFormal:`No propone una teor√≠a formal del self; su foco es la humanizaci√≥n de experiencias extremas.`,  
    teoriaClinica:`Conceptualiza el caso describiendo qu√© experiencias emocionales aparecen, sin secuencias fijas. El duelo se eval√∫a en t√©rminos de flexibilidad y regulaci√≥n emocional.`  
  },

  influencias:[
    'Tanatolog√≠a y cuidados paliativos',
    'Psicoeducaci√≥n emocional',
    'Humanismo cl√≠nico'
  ],

  procesos:[
    'Nombrar y normalizar reacciones emocionales',
    'Exploraci√≥n psicoeducativa de estados',
    'Flexibilizaci√≥n de la respuesta emocional',
    'Comunicaci√≥n de experiencias internas'
  ],

  mjps:['ED','RE','N','I'],

  refs:[
    'K√ºbler-Ross, E. (1969). On Death and Dying.',
    'K√ºbler-Ross, E. & Kessler, D. (2005). On Grief and Grieving.',
    'K√ºbler-Ross, E. (s/f). Sobre el duelo y el dolor.'
  ],

  // =========================================================
  // PROCEDIMIENTOS (K√úBLER-ROSS, PSICOEDUCATIVOS)
  // =========================================================
  procedimientos:[
    {
      nombre:'Psicoeducaci√≥n de las respuestas emocionales',
      codigo:'p_kr_psicoeducacion',
      procesos:['ED_oscilacionTolerancia','RE_modulacion','N_metacognicion'],
      texto:`Introducir el modelo de estados emocionales como vocabulario cl√≠nico para identificar y nombrar reacciones de negaci√≥n, ira, negociaci√≥n, tristeza y aceptaci√≥n, aclarando que no se trata de ‚Äúfases‚Äù obligatorias ni lineales, sino de respuestas posibles que pueden aparecer, coexistir o repetirse. Esto normaliza la experiencia y reduce autojuicio.`,  
    },
    {
      nombre:'Mapeo de experiencias emocionales',
      codigo:'p_kr_mapeo',
      procesos:['N_metacognicion','ED_oscilacionTolerancia'],
      texto:`Explorar con el paciente qu√© respuestas emocionales ha experimentado, con qu√© intensidad y en qu√© contextos, diferenciando experiencias que regulan (p. ej., negaci√≥n temporal) de aquellas que bloquean (p. ej., negaci√≥n persistente). Este mapeo ayuda a detectar rigideces y planificar intervenciones en procesos ED subyacentes.`,  
    },
    {
      nombre:'Uso de met√°foras curativas',
      codigo:'p_kr_metaforas',
      procesos:['N_construccionSignificado','RE_modulacion'],
      texto:`Utilizar met√°foras extra√≠das de los escritos y talleres de K√ºbler-Ross (p. ej., ‚Äúel duelo como viaje‚Äù, ‚Äúel dolor como s√≠mbolo del amor‚Äù), para facilitar un entendimiento m√°s rico del dolor emocional que reduzca miedo y aumente sentido compartido.`,  
    },
    {
      nombre:'Trabajo con narrativas biogr√°ficas',
      codigo:'p_kr_narrativa',
      procesos:['N_construccionSignificado','ED_reconocimiento'],
      texto:`Guiar al paciente en la reconstrucci√≥n de su propia historia de p√©rdida vinculando experiencias emocionales con su trayectoria de vida, apoy√°ndose en reflexiones propuestas en ‚ÄúSobre el duelo y el dolor‚Äù para integrar el significado personal de la p√©rdida.`,  
    },
    {
      nombre:'Activaci√≥n expresiva a trav√©s de simbolizaciones',
      codigo:'p_kr_simbolizacion',
      procesos:['ED_expresionVinculada','RE_expansionAfectiva'],
      texto:`Incorporar actividades descritas en los talleres de K√ºbler-Ross (dibujos, relatos, objetos simb√≥licos) para permitir la expresi√≥n emocional no verbal y facilitar la toma de conciencia de im√°genes mentales vinculadas al dolor, al miedo y al amor. :contentReference[oaicite:1]{index=1}`,  
    }
  ],

  // =========================================================
  // MICROINTERVENCIONES (K√úBLER-ROSS)
  // =========================================================
  micros:[
    {
      nombre:'Normalizar negaci√≥n protectora',
      codigo:'m_kr_normalizar_negacion',
      procesos:['ED_reconocimiento'],
      texto:`Validar temporalmente el uso de negaci√≥n como amortiguador del impacto, explicando su funci√≥n reguladora sin reforzarla como soluci√≥n permanente.`,  
    },
    {
      nombre:'Apertura a la ira',
      codigo:'m_kr_apertura_ira',
      procesos:['ED_expresionVinculada','RE_modulacion'],
      texto:`Facilitar la expresi√≥n segura de rabia o protesta ante la p√©rdida, validando que no es ‚Äúirresponsable‚Äù ni patol√≥gico, sino una respuesta humana a la injusticia y al dolor profundo.`,  
    },
    {
      nombre:'Explorar acuerdos/internalizaciones de negociaci√≥n',
      codigo:'m_kr_negociacion',
      procesos:['N_metacognicion','ED_reconocimiento'],
      texto:`Detectar y explorar expresiones de negociaci√≥n (‚Äúsi hubiera‚Ä¶‚Äù, ‚Äúsi tan solo‚Ä¶‚Äù) para clarificar qu√© significan y qu√© funci√≥n cumplen en la regulaci√≥n del dolor, sin reforzar ilusiones de reversi√≥n.`,  
    },
    {
      nombre:'Acompa√±ar tristeza profunda',
      codigo:'m_kr_acompanar_tristeza',
      procesos:['ED_oscilacionTolerancia','RE_modulacion'],
      texto:`Ofrecer presencia validante en momentos de tristeza profunda, normalizando el llanto y la retirada energ√©tica como parte leg√≠tima del contacto con la p√©rdida.`,  
    },
    {
      nombre:'Reencuadre de aceptaci√≥n',
      codigo:'m_kr_reencuadrar_aceptacion',
      procesos:['ED_reconocimiento','N_construccionSignificado'],
      texto:`Aclarar que aceptaci√≥n no es ausencia de dolor ni cierre definitivo, sino una forma de convivir con la irreversibilidad de la p√©rdida que coexiste con a√±oranza y sentido biogr√°fico.`,  
    }
  ]
},







     







];
// =========================================================
// 2B) DATOS: GitHub + compatibilidad con datos locales
// =========================================================
// =========================
// MINI MAP (est√©tica Mapamundi)
// =========================
const MINI_WORLD = { loaded:false, countries:null };

async function miniLoadWorld(){
  if (MINI_WORLD.loaded) return MINI_WORLD.countries;

  const world = await fetch('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-50m.json')
    .then(r => r.json()); // igual que Mapamundi

  MINI_WORLD.countries = topojson.feature(world, world.objects.countries);
  MINI_WORLD.loaded = true;
  return MINI_WORLD.countries;
}

function miniSize(svgEl){
  const r = svgEl.getBoundingClientRect();
  return { w: Math.max(10, r.width), h: Math.max(10, r.height) };
}

function miniEnsureDefs(svg){
  // defs + dotGlow (igual que Mapamundi)
  let defs = svg.select('defs');
  if (!defs.node()) defs = svg.append('defs');

  if (!defs.select('#dotGlow').node()){
    const fDot = defs.append('filter')
      .attr('id', 'dotGlow')
      .attr('x', '-80%')
      .attr('y', '-80%')
      .attr('width', '260%')
      .attr('height', '260%');

    fDot.append('feDropShadow')
      .attr('dx', 0)
      .attr('dy', 0)
      .attr('stdDeviation', 2.2)
      .attr('flood-color', 'var(--dotGlow)');
  }
}

async function miniRender(svgEl, m){
  if (!svgEl) return;

  const svg = d3.select(svgEl);
  const { w, h } = miniSize(svgEl);
  svg.attr('viewBox', `0 0 ${w} ${h}`);

  // Si no hay coords, limpia el svg y sal
  const hasCoords = Number.isFinite(m?.lat) && Number.isFinite(m?.lon);
  if (!hasCoords){
    svg.selectAll('*').remove();
    return;
  }

  // Root/layers (mismo orden conceptual que Mapamundi)
  let root = svg.select('g.mini-root');
  if (!root.node()){
    svg.selectAll('*').remove(); // render limpio
    miniEnsureDefs(svg);

    root = svg.append('g').attr('class','mini-root');
    root.append('g').attr('class','graticule');
    root.append('g').attr('class','land');
    root.append('g').attr('class','dots');
    root.append('g').attr('class','halos');
  }

// ‚úÖ Zoom + centrado en el nodo (misma ‚Äúventana‚Äù, menos superficie visible)
const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

// Mercator ‚Äúpeta‚Äù cerca de los polos: clamp suave
const lat = clamp(+m.lat, -80, 80);
const lon = ((+m.lon + 540) % 360) - 180; // normaliza a [-180, 180]

const zoom = (w < 420 ? 2.1 : 2.8);
const base = Math.min(w, h) * 0.30;

// ‚úÖ Ajuste: levantar nodo (y por tanto el centro del mapa)
const yLift = Math.round(h * 0.22);   // sube un 12% de la altura del SVG

const projection = d3.geoMercator()
  .center([lon, lat])
  .translate([w/2, (h/2) - yLift])
  .scale(base * zoom);


  const path = d3.geoPath(projection);

  // Graticule (igual que Mapamundi)
  const graticule = d3.geoGraticule10();
  const gGrat = root.select('g.graticule');
  const gratPath = gGrat.selectAll('path').data([graticule]);
  gratPath.enter().append('path')
    .merge(gratPath)
    .attr('d', path);

  // Land (countries TopoJSON)
  const countries = await miniLoadWorld();
  const gLand = root.select('g.land');
  const landSel = gLand.selectAll('path').data(countries.features, d => d.id);

  landSel.enter().append('path')
    .merge(landSel)
    .attr('d', path);

  landSel.exit().remove();

  // Punto (dot) + halo (misma ‚Äúsensaci√≥n‚Äù Mapamundi)
  const [x, y] = projection([m.lon, m.lat]);

  const col = (typeof groupColor !== 'undefined' ? (groupColor.get(m.grupo) || '#aaa') : '#aaa');

  const gDots = root.select('g.dots');
  const dot = gDots.selectAll('circle.mini-dot').data([1]);
  dot.enter().append('circle')
    .attr('class','mini-dot')
    .merge(dot)
    .attr('cx', x).attr('cy', y)
    .attr('r', 5.2)
    .attr('fill', col)
    .attr('filter', 'url(#dotGlow)');

  const gHalos = root.select('g.halos');
  const halo = gHalos.selectAll('circle.mini-halo').data([1]);
  halo.enter().append('circle')
    .attr('class','mini-halo')
    .merge(halo)
    .attr('cx', x).attr('cy', y)
    .attr('r', 7.2)
    .attr('stroke', col)
    .attr('filter', 'url(#dotGlow)'); // evita ‚Äúcuadrados‚Äù (Mapamundi usa dotGlow para halos)
}

// ‚¨áÔ∏è Usa GitHub Pages (m√°s fiable que raw en embeds tipo Teachable)
const GH_BASE = 'https://josepmunta-design.github.io/tmps-data/data';

async function fetchJson(url){
  const res = await fetch(url, { cache: 'no-store' });
  if(!res.ok) throw new Error(`HTTP ${res.status} al cargar ${url}`);
  return await res.json();
}
function gh(path){ return `${GH_BASE}/${path}`; }

// ‚úÖ El resto de tu c√≥digo seguir√° usando MODELS
let MODELS = LOCAL_MODELS.slice();

// Escuelas disponibles en GitHub (solo para poblar el selector)
let GH_SCHOOLS = []; // array de {id,label,color,order...} o lo que tengas

// Cache de escuelas/modelos cargados desde GitHub
const GH_SCHOOL_LOADED = new Set();   // slugs (ej: "humanista")
const GH_MODEL_CACHE   = new Map();   // id -> modelo completo

function slugify(s){
  return String(s)
    .toLowerCase()
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'') // quita acentos
    .replace(/\s+/g,'')                             // quita espacios
    .trim();
}

// ¬øYa tienes modelos locales para esa escuela?
function hasLocalSchoolModels(label){
  return LOCAL_MODELS.some(m => m.grupo === label);
}

// Carga index de escuelas de GitHub (si falla, no pasa nada)
async function loadGhSchoolsIndex(){
  try{
    // Ajusta ruta si tu repo lo tiene en otro sitio
    // En tu captura se ve: data/Core/escuelas/index.json
    GH_SCHOOLS = await fetchJson(gh('Core/escuelas/index.json'));
  }catch(e){
    console.warn('No se pudo cargar index de escuelas desde GitHub:', e);
    GH_SCHOOLS = [];
  }
}

// ‚úÖ promesas en vuelo por escuela (evita carreras)
const GH_SCHOOL_PENDING = new Map(); // id -> Promise

// Carga una escuela desde GitHub y a√±ade sus modelos a MODELS (solo si no existe local)
// Carga una escuela desde GitHub y a√±ade sus modelos a MODELS (solo si no existe local)
async function ensureSchoolFromGitHub(schoolLabel){

  // ‚úÖ mapa de promesas "en vuelo" SIN declarar globals (evita carreras y redeclare)
  ensureSchoolFromGitHub._pending = ensureSchoolFromGitHub._pending || new Map();
  const PENDING = ensureSchoolFromGitHub._pending;

  // Busca la escuela en el index de GitHub
  const entry = (GH_SCHOOLS || []).find(
    s => s.label === schoolLabel || s.id === slugify(schoolLabel)
  );

  if(!entry){
    console.warn('Escuela no encontrada en GH_SCHOOLS:', schoolLabel);
    return;
  }

  // Ya cargada
  if (GH_SCHOOL_LOADED.has(entry.id)) return;

  // ‚úÖ Si ya se est√° cargando, espera a esa misma carga
  if (PENDING.has(entry.id)){
    return PENDING.get(entry.id);
  }

  // ‚úÖ Single-flight real
  const promise = (async () => {

    // usa entry.file
    const school = await fetchJson(gh(`Core/${entry.file}`));

    const summaries = (school.modelos || []).map(m => ({
      ...m,
      grupo: school.label || schoolLabel
    }));

    // A√±ade a MODELS sin duplicar
    const existingIds = new Set(MODELS.map(m => String(m.id)));
    for (const m of summaries){
      const mid = String(m.id);
      if (!existingIds.has(mid)){
        MODELS.push(m);
        existingIds.add(mid);
      }
    }

    GH_SCHOOL_LOADED.add(entry.id);

    // ‚úÖ Asegura visibilidad antes de devolver (micro-wait)
    // (esto hace que openModel encuentre a la primera incluso si hay render justo en medio)
    await Promise.resolve();

  })();

  PENDING.set(entry.id, promise);

  try{
    return await promise;
  }finally{
    PENDING.delete(entry.id);
  }
}



// Si un modelo es ‚Äúresumen‚Äù (viene de GitHub) lo expandimos a ficha completa
async function ensureModelFull(m){
  if(!m) return m;

  // ‚úÖ ya es "full" si tiene campos extensos t√≠picos
  const isFull = (obj) =>
    !!obj &&
    (typeof obj.descripcion === 'string' && obj.descripcion.trim().length > 0) &&
    (Array.isArray(obj.procedimientos) || Array.isArray(obj.micros) || Array.isArray(obj.influencias));

  if (isFull(m)) return m;

  // ‚úÖ single-flight + cache SIN declarar globals
  ensureModelFull._pending = ensureModelFull._pending || new Map(); // id -> Promise
  const PENDING = ensureModelFull._pending;

  const id = String(m.id ?? '').trim();
  if (!id) return m;

  // cache ya cargado
  if (typeof GH_MODEL_CACHE !== 'undefined' && GH_MODEL_CACHE.has(id)){
    const cached = GH_MODEL_CACHE.get(id);
    return isFull(cached) ? cached : cached; // si por lo que sea cache√≥ incompleto, seguir√° intentando abajo
  }

  // si ya hay una carga en vuelo, espera
  if (PENDING.has(id)){
    return PENDING.get(id);
  }

  const p = (async () => {
    // si no hay file, no se puede cargar nada
    if (!m.file){
      console.warn('‚ö†Ô∏è Modelo sin "file":', m);
      return m;
    }

    const url = gh(`Core/${m.file}`);

    // ‚úÖ reintentos con backoff (esto es lo que te elimina el ‚Äúsegundo clic‚Äù)
    const delays = [0, 250, 700, 1500]; // ms
    let lastErr = null;

    for (let i = 0; i < delays.length; i++){
      if (delays[i]) await new Promise(r => setTimeout(r, delays[i]));
      try{
        const full = await fetchJson(url);

        // mezcla segura: full gana, pero mantenemos grupo/label si vinieran mejor en resumen
        const merged = { ...m, ...full };
        if (!merged.grupo) merged.grupo = m.grupo;
        if (!merged.label) merged.label = m.label;

        // guarda en cache
        if (typeof GH_MODEL_CACHE !== 'undefined') GH_MODEL_CACHE.set(id, merged);

        return merged;
      }catch(e){
        lastErr = e;
      }
    }

    console.error('‚ùå No se pudo cargar JSON del modelo (tras reintentos):', { id, url, file: m.file }, lastErr);
    return m; // no rompemos UI
  })();

  PENDING.set(id, p);
  try{
    return await p;
  }finally{
    PENDING.delete(id);
  }
}



    // =========================================================
    // 3) UI: selector de escuela + lista de modelos
    // =========================================================
    const schoolSelect = document.getElementById('schoolSelect');
    const modelsListEl = document.getElementById('modelsList');
    const countLine = document.getElementById('countLine');
    const modelInfoEl = document.getElementById('modelInfo');
// ================= MODO LECTURA PANEL DERECHO (SUAVE) =================

const leftPanel  = document.querySelector('.panel.left');
const rightPanel = document.querySelector('.panel.right');
// ===== FULLSCREEN del panel de info (panel derecho) =====
(function setupInfoFullscreen(){
  const modelInfoEl = document.getElementById('modelInfo');
  if (!modelInfoEl) return;

  // Evita duplicados
  if (document.getElementById('btnInfoFull')) return;

  const btn = document.createElement('button');
  btn.id = 'btnInfoFull';
  btn.className = 'mp-fullBtn';
  btn.type = 'button';
  btn.setAttribute('aria-label', 'Pantalla completa');

  const iconExpand = `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M9 4H4v5M15 4h5v5M9 20H4v-5M15 20h5v-5"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>`;
  const iconClose = `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M6 6l12 12M18 6L6 18"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>`;

  function syncIcon(){
    const on = document.body.classList.contains('infoFull');
    btn.innerHTML = on ? iconClose : iconExpand;
    btn.setAttribute('aria-label', on ? 'Cerrar' : 'Pantalla completa');
  }

btn.addEventListener('click', () => {
  document.body.classList.toggle('infoFull');

  // Opcional: al abrir, arranca arriba del panel
  if (document.body.classList.contains('infoFull')){
    const rp = document.querySelector('.panel.right');
    if (rp) rp.scrollTop = 0;

    // al entrar en fullscreen: recalcula observadores
    if (window.__SMH) window.__SMH.rescan();
  }else{
    // al salir: oculta header

  }

  syncIcon();
});


  // ESC para cerrar (√∫til en desktop)
  window.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && document.body.classList.contains('infoFull')){
  document.body.classList.remove('infoFull');
  if (window.__SMH) window.__SMH.hide();
  syncIcon();
}

  });

const host = document.querySelector('.panel.right');
if (!host) return;
// ===== Sticky header (solo en fullscreen y cuando no se ve mp-title/mp-author) =====
let __smh = document.getElementById('stickyModelHeader');
if (!__smh){
  __smh = document.createElement('div');
  __smh.id = 'stickyModelHeader';
__smh.innerHTML = `
  <div class="smh-overlay">
    <span class="smh-dot"></span>
    <div class="smh-text">
      <div class="smh-title" id="smhTitle">‚Äî</div>
      <div class="smh-author" id="smhAuthor"></div>
    </div>
  </div>
`;


  host.insertBefore(__smh, host.firstChild);
}

let __io = null;

function setupStickyHeaderObservers(){
  if (__io){ try{ __io.disconnect(); }catch(e){} __io = null; }

  const titleEl  = document.querySelector('#modelInfo .mp-title');
  const authorEl = document.querySelector('#modelInfo .mp-author');

// ‚úÖ Si estamos en vista ESCUELA, el sticky NO debe existir nunca
const mi = document.getElementById('modelInfo');
if (mi && mi.classList.contains('school-view')){
  __smh.classList.remove('is-on');
  if (__io){ try{ __io.disconnect(); }catch(e){} __io = null; }
  return;
}

// ‚úÖ Si a√∫n no hay mp-title/mp-author (render en curso), no fuerces reintentos
if (!titleEl || !authorEl){
  __smh.classList.remove('is-on');
  if (__io){ try{ __io.disconnect(); }catch(e){} __io = null; }
  return;
}




  let titleVisible = true;
  let authorVisible = true;

const update = () => {
  const mi = document.getElementById('modelInfo');

  // ‚úÖ Nunca muestres sticky en escuela
  if (mi && mi.classList.contains('school-view')){
    __smh.classList.remove('is-on');
    return;
  }

  const show = (!titleVisible && !authorVisible);
  __smh.classList.toggle('is-on', show);
};


  __io = new IntersectionObserver((entries) => {
    for (const en of entries){
      if (en.target === titleEl)  titleVisible  = en.isIntersecting;
      if (en.target === authorEl) authorVisible = en.isIntersecting;
    }
    update();
  }, { root: host, threshold: 0.01 });

  __io.observe(titleEl);
  __io.observe(authorEl);

  // estado inicial
  update();
}

// Exponemos una mini API para que el render del modelo actualice el texto
window.__SMH = {
  setTitle: (txt) => {
    const t = document.getElementById('smhTitle');
    if (t) t.textContent = txt || '‚Äî';
  },
  setAuthor: (txt) => {
  const a = document.getElementById('smhAuthor');
  if (!a) return;
  const t = (txt || '').trim();
  a.textContent = t;
  a.style.display = t ? 'block' : 'none';
},

  rescan: () => setupStickyHeaderObservers(),
 hide: () => { __smh.classList.remove('is-on'); }

};

// ‚úÖ 1) El bot√≥n vive fuera del panel (para que "fixed" sea de verdad)
document.body.appendChild(btn);

// ‚úÖ 2) Lo anclamos visualmente a la esquina sup. derecha del panel
function placeBtn(){
  // si no hay panel, no hacemos nada
  const rp = document.querySelector('.panel.right');
  if (!rp) return;

  const r = rp.getBoundingClientRect();
  const pad = 12;  // mismo padding visual que quieres
  const size = 34; // mismo tama√±o del bot√≥n

  // colocaci√≥n en viewport
  btn.style.top  = `${Math.round(r.top + pad)}px`;
  btn.style.left = `${Math.round(r.right - pad - size)}px`;
}

placeBtn();
window.addEventListener('resize', placeBtn, { passive:true });
window.addEventListener('scroll', placeBtn, { passive:true }); // por si el contenedor externo se desplaza

// cuando haces toggle a fullscreen cambia el rect: recolocamos
const _oldSync = syncIcon;
syncIcon = function(){
  _oldSync();
  placeBtn();
};

syncIcon();


})();

/* ===== DETECTAR STICKY PEGADO ARRIBA ===== */
if (leftPanel){
  leftPanel.addEventListener('scroll', () => {
    const sticky = leftPanel.querySelector('.schoolSticky');
    if (!sticky) return;

    const r = sticky.getBoundingClientRect();
    const p = leftPanel.getBoundingClientRect();

    // Si ya est√° pegado arriba
    const stuck = Math.abs(r.top - p.top) < 2;

    sticky.classList.toggle('stuck', stuck);
  }, { passive:true });
}

// ================= FIN MODO LECTURA (SUAVE) =================


    let currentSchool = null;
    let currentModelId = null;

    function uniq(arr){ return [...new Set(arr.filter(Boolean))]; }
function showLanding(){
  const ov = document.getElementById('landingOverlay');
  if (!ov) return;

  ov.classList.add('is-on');
  document.body.classList.add('landing-on');

  ov.setAttribute('aria-hidden', 'false');

  // bot√≥n "Entrar" (por si alguien quiere cerrar sin elegir)
  const close = document.getElementById('landingClose');
  if (close && !close.__bound){
    close.__bound = true;
    close.addEventListener('click', () => hideLanding(), { passive:true });
  }
}

function hideLanding(){
  const ov = document.getElementById('landingOverlay');
  if (!ov) return;
  ov.classList.remove('is-on');
  document.body.classList.remove('landing-on');

  ov.setAttribute('aria-hidden', 'true');
}
function normSchoolName(s){
  return String(s ?? '')
    .trim()
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g,'')  // quita acentos
    .toLowerCase();
}

// Cachea conteos para no refetchear
const LANDING_COUNT_CACHE = new Map(); // key: school id/label normalizado -> number

async function landingCountForSchool(label){
  const target = normSchoolName(label);

  // 0) Si ya lo tengo cacheado
  if (LANDING_COUNT_CACHE.has(target)) return LANDING_COUNT_CACHE.get(target);

  // 1) Fallback inmediato: locales (sirve mientras carga GH)
  const localN = (LOCAL_MODELS || []).filter(m => normSchoolName(m.grupo) === target).length;

  // 2) Intento GitHub: buscar la entrada del √≠ndice (solo trae file)
  const entry = (GH_SCHOOLS || []).find(s => {
    const name = s.label ?? s.id ?? '';
    return normSchoolName(name) === target;
  });

  if (!entry || !entry.file){
    LANDING_COUNT_CACHE.set(target, localN);
    return localN;
  }

  try{
    // Carga el archivo real de la escuela y cuenta sus modelos
    const school = await fetchJson(gh(`Core/${entry.file}`));
    const ghN = Array.isArray(school?.modelos) ? school.modelos.length : 0;

    const n = ghN || localN;
    LANDING_COUNT_CACHE.set(target, n);
    return n;
  }catch(e){
    console.warn('No se pudo contar modelos GH para', label, e);
    LANDING_COUNT_CACHE.set(target, localN);
    return localN;
  }
}


function buildLandingSchools(){
  const grid = document.getElementById('landingGrid');
  if (!grid) return;

  // Sacamos escuelas del propio <select> (as√≠ coincide 100% con lo disponible)
  const opts = Array.from(schoolSelect?.options || []);
  const schools = opts.map(o => o.value).filter(Boolean);

 grid.innerHTML = schools.map(label => {
  const col = groupColor.get(label) || '#D9AA3F';

  // Pinta placeholder; luego lo rellenamos async
return `
  <div class="landingSchool" data-school="${escapeHtml(label)}" style="--schoolColor:${col}">
    <div class="landingSchoolName">${escapeHtml(label)}</div>

    <div class="landingSchoolMeta">
      <span class="landingCount" data-count-for="${escapeHtml(label)}">‚Ä¶</span>
      <span class="landingCountLabel">modelos</span>
    </div>
  </div>
`;

}).join('');

// Relleno async de conteos (GitHub real)
(async () => {
  for (const label of schools){
    const n = await landingCountForSchool(label);
    const el = grid.querySelector(`.landingCount[data-count-for="${CSS.escape(label)}"]`);
   if (el){
  const nn = Number(n) || 0;
  el.textContent = String(nn);

  const lab = el.closest('.landingSchool')?.querySelector('.landingCountLabel');
  if (lab) lab.textContent = (nn === 1) ? 'modelo' : 'modelos';
}

  }
})();


  if (!grid.__bound){
    grid.__bound = true;
    grid.addEventListener('click', async (evt) => {
      const card = evt.target.closest('.landingSchool');
      if (!card) return;

      const label = card.getAttribute('data-school');
      if (!label) return;

      // 1) seleccionar en el desplegable
      schoolSelect.value = label;

      // 2) disparar el flujo normal
      schoolSelect.dispatchEvent(new Event('change', { bubbles:true }));

      // 3) ocultar landing
      hideLanding();
    });
  }
}

 function buildSchoolOptions(){
  const localSchools = uniq(LOCAL_MODELS.map(m => m.grupo));
  const ghSchools = (GH_SCHOOLS || []).map(s => s.label || s.id).filter(Boolean);

  // uni√≥n sin duplicados
  const set = new Set([...localSchools, ...ghSchools]);
 const schoolOrder = [
  'Psicoan√°lisis',
  'Conductismo',
  'Humanista',
  'Cognitivo',
  'Sist√©mico',
  'Constructivista',
  'Integrativo',
  'Transversal',
  'Otros'
];

const orderMap = new Map(schoolOrder.map((s,i)=>[s,i]));

const schools = [...set].sort((a,b)=>{
  const ia = orderMap.has(a) ? orderMap.get(a) : 999;
  const ib = orderMap.has(b) ? orderMap.get(b) : 999;
  return (ia - ib) || a.localeCompare(b,'es');
});


  schoolSelect.innerHTML = schools
    .map(g => `<option value="${escapeHtml(g)}">${escapeHtml(g)}</option>`)
    .join('');

  currentSchool = schools[0] ?? null;
  schoolSelect.value = currentSchool ?? '';
}


    function filteredModelsBySchool(grupo){
      return MODELS
        .filter(m => m.grupo === grupo)
        .sort((a,b) => (+a.year||0) - (+b.year||0) || String(a.label).localeCompare(String(b.label)));
    }

 function renderModelsList(){

  const list = filteredModelsBySchool(currentSchool);

  modelsList.style.setProperty('--schoolColor', groupColor.get(currentSchool) || '#D9AA3F');

  countLine.innerHTML = `
    <span class="count-n">${list.length}</span>
    <span class="count-txt">modelos/marcos en</span>
    <span class="count-school">‚Äú${escapeHtml(currentSchool)}‚Äù</span>
  `;

  if(!list.length){
    modelsListEl.innerHTML =
      `<div class="subtitle" style="margin:10px 0 0 0">No hay modelos en esta escuela todav√≠a.</div>`;
    return;
  }

  // 1) Render lista
  modelsListEl.innerHTML = list.map(m => {
    const active = (String(m.id) === String(currentModelId)) ? 'active' : '';
    const safeId = encodeURIComponent(String(m.id ?? '').trim());

const marcoClass = m && m.isMarco ? 'is-marco' : '';
const marcoTag = (m && m.isMarco)
 ? `<div class="mi-marcoTag" aria-label="Marco">
       <span class="mi-marcoTxt">MARCO</span>
     </div>`

  : '';

return `
  <div class="mi-item ${active} ${marcoClass}" data-id="${safeId}">
    <div class="mi-top">
      <div class="mi-title">${escapeHtml(m.label ?? '‚Äî')}</div>
      <div class="mi-year">${escapeHtml(m.year ?? '‚Äî')}</div>
    </div>
    <div class="mi-sub">${escapeHtml(m.autores ?? '‚Äî')}</div>

    ${marcoTag}
  </div>
`;

  }).join('');

  // 2) Delegaci√≥n de eventos (se engancha una sola vez)
  if(!modelsListEl.__boundClick){
    modelsListEl.__boundClick = true;

    modelsListEl.addEventListener('click', async (evt) => {
      const item = evt.target.closest('.mi-item');
      if(!item) return;

      const raw = item.getAttribute('data-id') || '';
      const id = decodeURIComponent(raw);

      // evita doble clic accidental mientras carga
      if (modelsListEl.__loading) return;
      modelsListEl.__loading = true;

      try{
        await openModel(id);
      }catch(err){
        console.error('openModel fall√≥:', id, err);
      }finally{
        modelsListEl.__loading = false;
      }
    });
  }
}

// ================== Fotos de autores ==================
function getAuthorPhoto(authorName){
  const name = String(authorName ?? '').trim().toLowerCase();

  // ‚úÖ aqu√≠ solo empezamos con Pavlov
  if (name === 'iv√°n p√°vlov' || name === 'ivan pavlov' || name.includes('pavlov')){
    // üëá PON AQU√ç la URL EXACTA a la imagen en GitHub (raw)
    return 'PEGA_AQUI_TU_URL_RAW_DE_PAVLOV';
  }

  return null;
}

function renderSchoolInfo(grupo){
  if(!grupo){
    renderModelInfo(null);
    return;
  }

  const col = groupColor.get(grupo) || '#ffffff';
const info = SCHOOL_INFO[grupo] || {};
const subtitle = info.subtitle || '‚Äî';
const desc = info.desc || 'A√∫n no has definido la descripci√≥n de esta escuela.';
const keys = info.keys || [];

  // Tinte del panel derecho como ya haces con modelos
  const rightPanel = document.querySelector('.panel.right');
  if (rightPanel){
    rightPanel.style.setProperty('--panelGlow', hexToRgba(col, 0.18));
  }

  // Datos din√°micos desde tus MODELS
  const list = filteredModelsBySchool(grupo);
  const n = list.length;

  const first = list
    .filter(m => m && m.year)
    .sort((a,b)=> (+a.year||0) - (+b.year||0))[0];

  const firstLine = first
    ? `${escapeHtml(first.year)} ¬∑ ${escapeHtml(first.label ?? '‚Äî')} (${escapeHtml(first.autores ?? '‚Äî')})`
    : '‚Äî';
modelInfoEl.classList.add('school-view');
modelInfoEl.style.setProperty('--schoolColor', col);
// ‚úÖ IMPORTANTE: actualizar variables globales (si no, se hereda el color del √∫ltimo modelo)
document.documentElement.style.setProperty('--schoolColor', col);
document.documentElement.style.setProperty('--panelGlow', hexToRgba(col, 0.16));

// ‚úÖ IMPORTANTE: en vista ‚Äúescuela‚Äù NO queremos sticky con el t√≠tulo del √∫ltimo modelo
if (window.__SMH){
  window.__SMH.setTitle('');
  window.__SMH.setAuthor('');
  window.__SMH.hide?.();        // si existe
  const el = document.getElementById('stickyModelHeader');
  if (el) el.classList.remove('is-on');
}

  modelInfoEl.innerHTML = `
    <span class="mp-tag" style="color:${col};border-color:${col}">
      ${escapeHtml(grupo)}
    </span>

    <div class="school-header">
  <div class="school-eyebrow">Escuela psicoterap√©utica</div>
  <div class="school-title">${escapeHtml(grupo)}</div>
  
</div>


    <div class="mp-meta">
      <span class="mp-pill">${n} modelo(s)</span>
      <span class="mp-pill">Primer modelo: ${firstLine}</span>
    </div>

  <div class="mp-desc">
  <div style="font-weight:700;margin-bottom:6px;">${escapeHtml(subtitle)}</div>
  <div>${escapeHtml(desc)}</div>
</div>

${keys.length ? `
  <div class="mp-meta" style="margin-top:10px;gap:8px;flex-wrap:wrap;">
    ${keys.map(k => `<span class="mp-pill">${escapeHtml(k)}</span>`).join('')}
  </div>
` : ''}


   <div class="mp-hint" style="margin-top:12px">
   Elige un modelo en la lista para abrir su ficha.
</div>

  `;
}

    // =========================================================
    // 4) Render ficha de modelo (sin procesos/mjps)
    // =========================================================
    function renderModelInfo(m){
  // üõ°Ô∏è BLINDAJE: si no hay modelo (init o reset), muestra mensaje y sal
   // üõ°Ô∏è BLINDAJE REAL: si no hay modelo, NO toques el panel
  if(!m || !m.id){
    return;
  }
  if(!m){
   modelInfoEl.innerHTML = `
  <div class="mp-hero">
    <div class="mp-hero-eyebrow">Biblioteca viva</div>
    <div class="mp-hero-title">Modelos psicoterap√©uticos</div>
    <div class="mp-hero-text">
      Explora c√≥mo distintas escuelas entienden el cambio, el sufrimiento y la intervenci√≥n cl√≠nica.
    </div>

    <div class="mp-hero-steps">
      <div class="mp-step"><span class="mp-step-dot"></span>1) Elige una escuela</div>
      <div class="mp-step"><span class="mp-step-dot"></span>2) Haz clic en un modelo</div>
      <div class="mp-step"><span class="mp-step-dot"></span>3) Lee influencias, procedimientos y micros</div>
    </div>
  </div>

  <div class="mp-hint">Selecciona una escuela y luego un modelo para ver toda su informaci√≥n.</div>
`;
 
  }
try{
  // (deja esto solo mientras depuras)
  console.log('OPEN MODEL', m.label, m.id);
}catch(e){}

  const col = groupColor.get(m.grupo) || '#ffffff';
      modelInfoEl.classList.remove('school-view');
modelInfoEl.style.removeProperty('--schoolColor');

  // ‚úÖ aplica ‚Äútinte‚Äù del grupo al panel derecho (glass glow)
  const rightPanel = document.querySelector('.panel.right');
  if (rightPanel){
    rightPanel.style.setProperty('--panelGlow', hexToRgba(col, 0.22));
  }

  const pills = [
    m.year ? `<span class="mp-pill">${escapeHtml(m.year)}</span>` : '',
    m.universidad ? `<span class="mp-pill">${escapeHtml(m.universidad)}</span>` : '',
    (m.ciudad || m.pais) ? `<span class="mp-pill">${escapeHtml((m.ciudad ?? '') + (m.pais ? ' ¬∑ ' + m.pais : ''))}</span>` : ''
  ].filter(Boolean).join('');

  // contadores
const nInflu = Array.isArray(m.influencias) ? m.influencias.filter(Boolean).length : 0;
const nRefs  = Array.isArray(m.refs) ? m.refs.filter(Boolean).length : 0;
const nProc  = Array.isArray(m.procedimientos) ? m.procedimientos.filter(Boolean).length : 0;
const nMicro = Array.isArray(m.micros) ? m.micros.filter(Boolean).length : 0;
const nSeq   = Array.isArray(m.secuencias) ? m.secuencias.filter(Boolean).length : 0;
const nIdeas = Array.isArray(m.ideasPrincipales) ? m.ideasPrincipales.filter(Boolean).length : 0;

  // alianza/neimeyer
  const nAli = (m.alianzaModelo && typeof m.alianzaModelo === 'object')
    ? Object.entries(m.alianzaModelo).filter(([k,v]) => v && String(v).trim()).length
    : 0;

  const nNei = (m.neimeyer && typeof m.neimeyer === 'object')
    ? Object.entries(m.neimeyer).filter(([k,v]) => v && String(v).trim()).length
    : 0;
  // ===== Autor con foto =====
// ===== Autor con foto (versi√≥n con depuraci√≥n para ver qu√© falla) =====
// ===== Autor con foto (foto.json) =====
const fullAutores = String(m.autores ?? '').trim();

// Para la FOTO: usa el 1¬∫ autor (lo normal en √≠ndices)
const autorFoto = (fullAutores.split(';')[0] || '').trim() || '‚Äî';
const autorFotoKey = autorFoto.split(',')[0].trim(); // por si viene "Apellido, Nombre"

// Para MOSTRAR: todos los autores
const autoresDisplay = fullAutores
  ? fullAutores.split(';').map(s => s.trim()).filter(Boolean).join(' ¬∑ ')
  : '‚Äî';

let fotoUrl = null;

const IDX = window.AUTHOR_PHOTO_INDEX || { authors:{}, models:{} };

// Busca por autor (con la MISMA normalizaci√≥n que usas en el index)
const authorKey = normAuthorKey(autorFotoKey);
if (IDX.authors?.[authorKey]) {
  fotoUrl = 'https://josepmunta-design.github.io/tmps-data/data/Core/fotos/' + IDX.authors[authorKey];
}

// Fallback por modelo
if (!fotoUrl) {
  const modelKey = String(m.id ?? '').trim();
  if (IDX.models?.[modelKey]) {
    fotoUrl = 'https://josepmunta-design.github.io/tmps-data/data/Core/fotos/' + IDX.models[modelKey];
  }
}

const authorHTML =
  '<div class="mp-author mp-author-wrap">' +

    (fotoUrl
      ? '<img class="mp-author-photo" src="' + fotoUrl + '" alt="' + escapeHtml(autoresDisplay) + '" loading="lazy" decoding="async">'
      : '<div class="mp-author-photo" aria-hidden="true"></div>'
    ) +
    '<div class="mp-author-text">' +
      '<div class="mp-author-name">' + escapeHtml(autoresDisplay) + '</div>' +
      // üëá Quitamos el a√±o aqu√≠ para NO duplicarlo (ya est√° en pills)
      '<div class="mp-author-meta"></div>' +
    '</div>' +
  '</div>';


  modelInfoEl.innerHTML = `
  <div class="mp-mapbg" aria-hidden="true">
  <svg id="miniMapSvgBg"></svg>
</div>

    <span class="mp-tag" style="color:${col};border-color:${col}">
      ${escapeHtml(m.grupo)}
    </span>

    <div class="mp-title">${escapeHtml(m.label)}</div>
   ${authorHTML}


    <div class="mp-meta">${pills || `<span class="mp-pill">‚Äî</span>`}</div>

    <div class="mp-desc">${escapeHtml(m.descripcion ?? '‚Äî')}</div>

    <div class="mp-acc">
      ${acc('Influencias', nInflu, sectionListInner(m.influencias, {asList:false}), true)}
      ${nIdeas ? acc('Ideas principales', nIdeas, sectionIdeasInner(m.ideasPrincipales), false) : ''}

${nNei ? acc('Niveles', nNei, sectionNeimeyerInner(m.neimeyer), false) : ''}

     ${nProc ? acc('Procedimientos', nProc, sectionProceduresInner(m.procedimientos), false) : ''}

     ${nSeq ? acc('Secuencias', nSeq, sectionSequencesInner(m.secuencias), false) : ''}

     ${nMicro ? acc('Microintervenciones', nMicro, sectionProceduresInner(m.micros), false) : ''}

${nRefs ? acc('Referencias', nRefs, sectionListInner(m.refs, {asList:true}), false) : ''}


      ${nAli ? acc('Alianza terap√©utica', nAli, sectionAliInner(m.alianzaModelo), false) : ''}

      
    </div>
  `;
      // ‚úÖ Variables globales para todo el panel derecho (sticky incluido)
document.documentElement.style.setProperty('--schoolColor', col);
document.documentElement.style.setProperty('--panelGlow', hexToRgba(col, 0.16));
if (window.__SMH){
  window.__SMH.setTitle(m.label);
  window.__SMH.setAuthor(m.autores || '');
  window.__SMH.rescan();
}


      // === Mini map de fondo (misma est√©tica Mapamundi) ===
try{
const bgSvg = document.getElementById('miniMapSvgBg');
requestAnimationFrame(() => miniRender(bgSvg, m));

}catch(e){
  console.warn('miniRender bg failed', e);
}

}

function acc(title, count, bodyHtml, open=false){
  return `
    <details ${open ? 'open' : ''}>
      <summary>
        <span>${escapeHtml(title)}</span>
        <span class="sumRight">
          <span class="sumCount">${count}</span>
          <span class="chev">‚ñæ</span>
        </span>
      </summary>
      <div class="body">${bodyHtml}</div>
    </details>
  `;
}

function sectionListInner(arr, opts={}){
  const a = Array.isArray(arr) ? arr.filter(Boolean) : [];
  const asList = !!opts.asList;

  if(!a.length) return `<div>‚Äî</div>`;

  if(asList){
    return `<ul class="mp-list">${a.map(x => `<li>${escapeHtml(x)}</li>`).join('')}</ul>`;
  }
  return `<div>${a.map(x => escapeHtml(x)).join(', ')}</div>`;
}

function sectionProceduresInner(arr){
  const a = Array.isArray(arr) ? arr : [];

  // ‚úÖ filtra entradas realmente √∫tiles (evita huecos)
  const clean = a
    .filter(Boolean)
    .filter(p => {
      const hasName = (p.nombre && String(p.nombre).trim().length);
      const hasText = (p.texto && String(p.texto).trim().length);
      const hasCode = (p.codigo && String(p.codigo).trim().length);
      return hasName || hasText || hasCode;
    });

  if(!clean.length) return `<div>‚Äî</div>`;

  return `
    <div class="mp-sub">
      ${clean.map(p => {
        const title = escapeHtml(p.nombre && String(p.nombre).trim() ? p.nombre : 'Sin t√≠tulo');
        const code  = (p.codigo && String(p.codigo).trim())
          ? `<span class="mp-code">${escapeHtml(p.codigo)}</span>` : '';
        const bodyText = (p.texto && String(p.texto).trim()) ? p.texto : '‚Äî';

      const dataCodeAttr = (p.codigo && String(p.codigo).trim())
  ? ` data-code="${escapeHtml(p.codigo)}"`
  : '';

return `
  <details${dataCodeAttr}>

            <summary>
              <span class="subLeft">
                <span class="subTitle">${title}</span>
              </span>
              <span class="subRight">
                ${code}
                <span class="chev">‚ñæ</span>
              </span>
            </summary>
            <div class="subBody">${escapeHtml(bodyText)}</div>
          </details>
        `;
      }).join('')}
    </div>
  `;
}

function sectionSequencesInner(arr){
  const a = Array.isArray(arr) ? arr : [];
  const clean = a.filter(Boolean).filter(s => {
    const hasName = (s.nombre && String(s.nombre).trim().length);
    const hasDesc = (s.descripcion && String(s.descripcion).trim().length);
    const hasSteps = Array.isArray(s.pasos) && s.pasos.length;
    return hasName || hasDesc || hasSteps;
  });

  if (!clean.length) return `<div>‚Äî</div>`;

  // Visual: cajas + flecha (sin SVG, pero queda claro y estable)
  return `
    <div class="mp-seqs">
      ${clean.map(seq => {
        const title = escapeHtml(seq.nombre && String(seq.nombre).trim() ? seq.nombre : 'Sin t√≠tulo');
        const desc  = escapeHtml(seq.descripcion && String(seq.descripcion).trim() ? seq.descripcion : '‚Äî');

        const steps = Array.isArray(seq.pasos) ? seq.pasos : [];
        const stepsSorted = steps.slice().sort((x,y) => (x?.orden ?? 0) - (y?.orden ?? 0));

        const stepsHtml = stepsSorted.map((st, i) => {
          const ord = (st && st.orden != null) ? st.orden : (i+1);
          const accTxt = escapeHtml(st?.accion ? String(st.accion) : '‚Äî');
          const procs = Array.isArray(st?.procesos) ? st.procesos : [];
          const procsTxt = procs.length ? procs.map(p => `<span class="mp-chip">${escapeHtml(p)}</span>`).join('') : `<span class="mp-chip mp-chip-empty">‚Äî</span>`;

const expTxt = escapeHtml(st?.explicacion ? String(st.explicacion) : '');

return `
  <div class="mp-flowItem" style="${String(seq.tipo||'') === 'protocolo_ciclico' ? `--ang:${(360 / Math.max(stepsSorted.length,1) * i).toFixed(4)}deg;` : ''}">

    <div class="mp-flowDot">${ord}</div>

    <details class="mp-flowBox mp-step" ${expTxt ? '' : 'data-noexp="1"'}>
      <summary class="mp-stepSum">
        <div class="mp-flowAction">${accTxt}</div>
        <div class="mp-stepChev">‚ñæ</div>
      </summary>

      ${expTxt ? `<div class="mp-stepBody">${expTxt}</div>` : ``}
    </details>
  </div>
`;


        }).join('');

        return `
          <details class="mp-seq">
            <summary>
              <span class="subLeft"><span class="subTitle">${title}</span></span>
              <span class="subRight"><span class="chev">‚ñæ</span></span>
            </summary>
            <div class="subBody">
              <div class="mp-seqDesc">${desc}</div>
<div class="mp-flow ${String(seq.tipo||'') === 'protocolo_ciclico' ? 'mp-flow-loop' : ''}">
  ${stepsHtml || '‚Äî'}
</div>


            </div>
          </details>
        `;
      }).join('')}
    </div>
  `;
}


function sectionAliInner(obj){
  if(!obj || typeof obj !== 'object') return `<div>‚Äî</div>`;
  const entries = Object.entries(obj).filter(([k,v]) => v && String(v).trim());
  if(!entries.length) return `<div>‚Äî</div>`;

  const nice = (k) => k
    .replace(/^ALI_/, '')
    .replace(/([A-Z])/g, ' $1')
    .replace(/_/g,' ')
    .trim();

  return entries.map(([k,v]) => `
    <div style="margin:10px 0 0 0">
      <div style="font-weight:900; color:#fff; font-size:12px">${escapeHtml(nice(k))}</div>
      <div style="margin-top:6px; white-space:pre-wrap;">${escapeHtml(v)}</div>
    </div>
  `).join('');
}

function sectionNeimeyerInner(obj){
  if(!obj || typeof obj !== 'object') return `<div>‚Äî</div>`;

  const keys = ['epistemologico','teoriaFormal','teoriaClinica'];
  const labels = {
    epistemologico: 'Epistemol√≥gico',
    teoriaFormal: 'Teor√≠a formal',
    teoriaClinica: 'Teor√≠a cl√≠nica'
  };

  const blocks = keys
    .map(k => [k, obj[k]])
    .filter(([k,v]) => v && String(v).trim());

  if(!blocks.length) return `<div>‚Äî</div>`;

  return blocks.map(([k,v]) => `
    <div style="margin:10px 0 0 0">
      <div style="font-weight:900; color:#fff; font-size:12px">${escapeHtml(labels[k] ?? k)}</div>
      <div style="margin-top:6px; white-space:pre-wrap;">${escapeHtml(v)}</div>
    </div>
  `).join('');
}

    function sectionList(title, arr, opts={}){
      const a = Array.isArray(arr) ? arr.filter(Boolean) : [];
      const asList = !!opts.asList;

      return `
        <div class="mp-section">
          <h4>${escapeHtml(title)}</h4>
          ${
            a.length
              ? (asList
                  ? `<ul class="mp-list">${a.map(x => `<li>${escapeHtml(x)}</li>`).join('')}</ul>`
                  : `<div>${a.map(x => escapeHtml(x)).join(', ')}</div>`)
              : `<div>‚Äî</div>`
          }
        </div>
      `;
    }
function sectionIdeasInner(ideas){
  const list = Array.isArray(ideas) ? ideas.filter(Boolean) : [];
  if(!list.length) return `<div class="mp-empty">‚Äî</div>`;

  return `
    <div class="mp-ideas">
      ${list.map(it => {
        const title = (it?.titulo ?? it?.title ?? '').toString().trim();
        const body  = (it?.desarrollo ?? it?.texto ?? it?.descripcion ?? '').toString().trim();

        return `
          <details class="mp-idea">
            <summary class="mp-idea-title">${escapeHtml(title || 'Idea')}</summary>
            <div class="mp-idea-body">${escapeHtml(body || '‚Äî')}</div>
          </details>
        `;
      }).join('')}
    </div>
  `;
}

    function sectionProcedures(title, arr){
      const a = Array.isArray(arr) ? arr.filter(Boolean) : [];
      if(!a.length){
        return `
          <div class="mp-section">
            <h4>${escapeHtml(title)}</h4>
            <div>‚Äî</div>
          </div>
        `;
      }

      return `
        <div class="mp-section">
          <h4>${escapeHtml(title)}</h4>
          <ul class="mp-list">
            ${a.map(p => `
              <li>
                <b>${escapeHtml(p.nombre ?? '‚Äî')}</b>
                ${p.codigo ? `<span class="mp-code">${escapeHtml(p.codigo)}</span>` : ''}
                ${p.texto ? `<div style="margin-top:6px; color:#e3ebf6; white-space:pre-wrap;">${escapeHtml(p.texto)}</div>` : ''}
              </li>
            `).join('')}
          </ul>
        </div>
      `;
    }

    function sectionAli(title, obj){
      if(!obj || typeof obj !== 'object'){
        return `
          <div class="mp-section">
            <h4>${escapeHtml(title)}</h4>
            <div>‚Äî</div>
          </div>
        `;
      }
      const entries = Object.entries(obj).filter(([k,v]) => v && String(v).trim());
      if(!entries.length){
        return `
          <div class="mp-section">
            <h4>${escapeHtml(title)}</h4>
            <div>‚Äî</div>
          </div>
        `;
      }

      const nice = (k) => k
        .replace(/^ALI_/, '')
        .replace(/([A-Z])/g, ' $1')
        .replace(/_/g,' ')
        .trim();

      return `
        <div class="mp-section">
          <h4>${escapeHtml(title)}</h4>
          ${entries.map(([k,v]) => `
            <div style="margin:10px 0 0 0">
              <div style="font-weight:900; color:#fff; font-size:12px">${escapeHtml(nice(k))}</div>
              <div style="margin-top:6px; white-space:pre-wrap; color:#e3ebf6">${escapeHtml(v)}</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function sectionNeimeyer(title, obj){
      if(!obj || typeof obj !== 'object'){
        return `
          <div class="mp-section">
            <h4>${escapeHtml(title)}</h4>
            <div>‚Äî</div>
          </div>
        `;
      }
      const keys = ['epistemologico','teoriaFormal','teoriaClinica'];
      const labels = {
        epistemologico: 'Epistemol√≥gico',
        teoriaFormal: 'Teor√≠a formal',
        teoriaClinica: 'Teor√≠a cl√≠nica'
      };
      const blocks = keys
        .map(k => [k, obj[k]])
        .filter(([k,v]) => v && String(v).trim());

      if(!blocks.length){
        return `
          <div class="mp-section">
            <h4>${escapeHtml(title)}</h4>
            <div>‚Äî</div>
          </div>
        `;
      }

      return `
        <div class="mp-section">
          <h4>${escapeHtml(title)}</h4>
          ${blocks.map(([k,v]) => `
            <div style="margin:10px 0 0 0">
              <div style="font-weight:900; color:#fff; font-size:12px">${escapeHtml(labels[k] ?? k)}</div>
              <div style="margin-top:6px; white-space:pre-wrap; color:#e3ebf6">${escapeHtml(v)}</div>
            </div>
          `).join('')}
        </div>
      `;
    }

    // =========================================================
    // 5) Interacci√≥n
    // =========================================================
async function openModel(id){
  const target = String(id ?? '').trim();

  // üîç busca el modelo
  let m = MODELS.find(x => String(x?.id ?? '').trim() === target);

  if(!m){
    // üõü Reintento escuela (si tu c√≥digo ya lo tiene, d√©jalo; aqu√≠ va completo)
    try{
      await ensureSchoolFromGitHub(currentSchool);
    }catch(e){}

    m = MODELS.find(x => String(x?.id ?? '').trim() === target);

    if(!m){
      console.warn('‚ùå Modelo no encontrado en MODELS:', target);
      modelInfoEl.innerHTML = `
        <div class="mp-hint">
          <b>Modelo no encontrado.</b><br>
          ID: <code>${escapeHtml(target)}</code>
        </div>
      `;
      return;
    }
  }
  // ‚úÖ A√ëADE ESTO
  currentModelId = target;
  renderModelsList();
   try {
  // Carga √≠ndice de fotos, pero SI falla ‚Üí continua sin fotos (no rompe el modelo)
  try {
    await loadAuthorPhotoIndex();
  } catch (fotoErr) {
    console.warn('‚ö†Ô∏è No se pudo cargar foto.json, continuando sin fotos:', fotoErr);
  }


  m = await ensureModelFull(m);
  renderModelInfo(m);
  resetRightPanelToTop();
} catch (err) {
  console.error('‚ùå Error abriendo modelo', target, err);
  modelInfoEl.innerHTML = `
    <div class="mp-hint">
      <b>No se pudo cargar la ficha del modelo.</b><br>
      ID: <code>${escapeHtml(target)}</code>
    </div>
  `;
}
}
function resetRightPanelToTop(){
  const rp = document.querySelector('.panel.right');
  if (!rp) return;

  // 1) corte inmediato
  rp.scrollTop = 0;

  // 2) refuerzo en el siguiente frame (evita anchoring/inercia)
  requestAnimationFrame(() => { rp.scrollTop = 0; });
}

function scrollLeftPanelToStickyPoint(){
  const panel = document.querySelector('.panel.left');
  const title = panel?.querySelector('.title');
  if (!panel) return;

  let offset = 0;

  if (title){
    const r = title.getBoundingClientRect();
    offset = r.height;

    const st = getComputedStyle(title);
    offset += parseFloat(st.marginBottom) || 0;
  }

  const FUDGE = -10; // ‚úÖ micro-ajuste para que el sticky ya est√© ‚Äúclavado‚Äù
  panel.scrollTop = Math.max(0, offset - FUDGE);
}




schoolSelect.addEventListener('change', async () => {
  try{
    currentSchool = schoolSelect.value;
    currentModelId = null;

    // üëá si es escuela nueva (sin modelos locales), la trae de GitHub
    await ensureSchoolFromGitHub(currentSchool);

    renderModelsList();

    // ‚úÖ mantiene el selector arriba fijo y la primera tarjeta justo debajo (sin baile)
    requestAnimationFrame(() => {
      scrollLeftPanelToStickyPoint();
    });

 renderSchoolInfo(currentSchool);
resetRightPanelToTop();

  }catch(err){
    console.error(err);
  }
});




    // =========================================================
    // 6) Helpers
    // =========================================================
    function escapeHtml(s){
      return String(s ?? '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }
function hexToRgba(hex, a = 0.2){
  const h = String(hex || '').trim();
  if (!h.startsWith('#')) return `rgba(255,255,255,${a})`;

  let r=255,g=255,b=255;

  if (h.length === 4){
    r = parseInt(h[1]+h[1], 16);
    g = parseInt(h[2]+h[2], 16);
    b = parseInt(h[3]+h[3], 16);
  } else if (h.length === 7){
    r = parseInt(h.slice(1,3), 16);
    g = parseInt(h.slice(3,5), 16);
    b = parseInt(h.slice(5,7), 16);
  }

  return `rgba(${r},${g},${b},${a})`;
}

  // init (local + GitHub)
(async function init(){
  try{
    // 1) carga √≠ndice de escuelas desde GitHub (si falla, no rompe)
    await loadGhSchoolsIndex();

    // 2) construye selector combinando locales + GitHub
buildSchoolOptions();
buildLandingSchools();
showLanding();



    // 3) si la escuela inicial no es local, tr√°ela de GitHub
    if(currentSchool){
      await ensureSchoolFromGitHub(currentSchool);
    }

    // 4) render inicial
// Carga global de fotos (solo una vez)
let FOTOS = null;

async function loadFotos() {
  if (FOTOS) return FOTOS;
  try {
    const res = await fetch('https://raw.githubusercontent.com/josepmunta-design/tmps-data/main/data/Core/fotos/foto.json');
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    FOTOS = await res.json();
    console.log('FOTOS cargado:', FOTOS); // ‚Üê para depurar
    return FOTOS;
  } catch (err) {
    console.error('Error cargando foto.json:', err);
    FOTOS = { authors: {}, models: {} };
    return FOTOS;
  }
}

// 4) render inicial
await loadAuthorPhotoIndex(); // ‚úÖ Espera al √≠ndice global de fotos

renderModelsList();
renderSchoolInfo(currentSchool);
    


    // 5) marca como cargado
    requestAnimationFrame(() => {
      document.body.classList.add('loaded');
    });
  }catch(err){
    console.error(err);
  }
})();

});

  
  </script>
  

<!-- ================== LANDING (pantalla inicio) ================== -->
<div id="landingOverlay" class="landingOverlay" aria-hidden="true">

  <div class="landingBlobs" aria-hidden="true"></div>

  <div class="landingShell">

    <div class="landingHero">
      <div class="landingKicker">Biblioteca ¬∑ Tu Mentor</div>
      <h1 class="landingH1">Modelos Psicoterap√©uticos</h1>
      <p class="landingLead">Explora enfoques cl√≠nicos organizados por escuelas, con rigor y claridad.</p>
    </div>

    <div id="landingGrid" class="landingGrid"></div>

    <div class="landingFooter"></div>
  </div>
</div>
<!-- ================== /LANDING ================== -->


<div class="nav-speed" aria-label="Navegaci√≥n entre apps">
  <div class="nav-menu" role="menu" aria-label="Abrir otras apps">

    <a class="nav-fab" role="menuitem"
       href="https://www.tumentorpsicologia.com/p/procesosnou"
       title="Procesos psicoterap√©uticos"
       aria-label="Procesos">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M7 4V20M7 4H13.2C16.8 4 17.8 6.2 17.8 8C17.8 9.8 16.8 12 13.2 12H7"
          stroke="currentColor" stroke-width="2.4"
          stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </a>

    <a class="nav-fab" role="menuitem"
       href="https://www.tumentorpsicologia.com/p/diagramatemporal"
       title="Diagrama temporal"
       aria-label="Temporal">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <circle cx="12" cy="5" r="2.2" stroke="currentColor" stroke-width="1.8"/>
        <circle cx="8" cy="12" r="2.2" stroke="currentColor" stroke-width="1.8"/>
        <circle cx="16" cy="12" r="2.2" stroke="currentColor" stroke-width="1.8"/>
        <circle cx="12" cy="19" r="2.2" stroke="currentColor" stroke-width="1.8"/>
        <path d="M12 7.4V9.2" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        <path d="M12 9.2C10.5 9.9 9.2 10.9 8 12" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        <path d="M12 9.2C13.5 9.9 14.8 10.9 16 12" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        <path d="M8 14.3C9.1 15.7 10.4 16.9 12 17.6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        <path d="M16 14.3C14.9 15.7 13.6 16.9 12 17.6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
      </svg>
    </a>

    <a class="nav-fab" role="menuitem"
       href="https://www.tumentorpsicologia.com/p/untitled-17"
       title="Mapamundi"
       aria-label="Mapamundi">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.8"/>
        <path d="M3.5 12h17" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        <path d="M12 3c2.8 2.6 4.5 5.9 4.5 9s-1.7 6.4-4.5 9c-2.8-2.6-4.5-5.9-4.5-9S9.2 5.6 12 3z"
          stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
      </svg>
    </a>

  </div>

  <button class="nav-fab nav-fab-main" type="button"
          aria-label="Abrir navegaci√≥n" aria-expanded="false">
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M12 5v14M5 12h14"
        stroke="currentColor" stroke-width="2.4" stroke-linecap="round"/>
    </svg>
  </button>
</div>

<script>
(function setupSpeedDialNav(){
  const nav = document.querySelector('.nav-speed');
  if (!nav) return;

  const btn  = nav.querySelector('.nav-fab-main');
  const menu = nav.querySelector('.nav-menu');
  if (!btn || !menu) return;

  const setOpen = (on) => {
    nav.classList.toggle('open', on);
    btn.setAttribute('aria-expanded', on ? 'true' : 'false');
  };

  btn.addEventListener('click', (e) => {
    e.preventDefault();
    e.stopPropagation();
    setOpen(!nav.classList.contains('open'));
  });

  document.addEventListener('click', (e) => {
    if (!nav.classList.contains('open')) return;
    if (nav.contains(e.target)) return;
    setOpen(false);
  });

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') setOpen(false);
  });

  menu.addEventListener('click', () => setOpen(false));

  setOpen(false);
})();
</script>

</body>
</html>
